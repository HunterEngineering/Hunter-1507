"use strict";define("Run/Extensions",["require","exports","react","VSS/Legacy/Legacy","VSSUI/Card","VSS/Platform/Fetch","Build/Shared/Components/Timeline/index","VSS/Core/Observable","VSS/Platform/Context"],(function(e,t,n,a,s,r,o,i,c){var d,l,u,m;d=t.Resources={},t.Resources.TabName="Extensions",t[m="ComponentsLegacySection"]={},t[m].LegacySection=function(e){const t=[],[r,o]=n.useState([]);n.useEffect((()=>{o(e.contributions)}),[e.contributions]),n.useEffect((()=>{t.forEach((t=>t(e.build)))}),[e.build]);const i=e=>{console.error("Not supported")},c=n=>{t.push(n),n(e.build)};return n.createElement("div",null,r.map((e=>{const t={onBuildChanged:c,onViewDisplayed:i,selectTab:i,setSectionVisibility:i};return n.createElement(s.Card,{key:e.id,className:"build-ext-card"},n.createElement("div",null,n.createElement("h3",{className:"body-xl"},e.name),n.createElement(a.LegacyComponent,{modules:["Build/Scripts/LoadSecuredKnockout","VSSPreview/Providers/ContentHost"],wrappedType:"vssLegacyContributionContentHost",wrappedProps:{className:"content body-m",context:t,contribution:e.id},expectRegisteredInstance:!0})))})))},function(e){function o(e){const t=e.trim().toLowerCase();return!/^(vbscript|javascript|file|data):/.test(t)}l=t[e]={},t[e].validateLinkProtocol=o;const i={breaks:!0,html:!0,validateLink:o};t[e].MarkdownCard=function(e){const[t,o]=n.useState([]);return n.useEffect((()=>{const t=[],n=[];(e.data||[]).forEach((e=>{e.name=e.name.replace(".md","");const a=e._links.self;a&&a.href&&(t.push((0,r.issueRequest)(a.href).then((async e=>{const t=await e.arrayBuffer();let n=new Uint8Array(t);n.length>=3&&239===n[0]&&187===n[1]&&191===n[2]&&(n=n.slice(3,n.length-1));return(new TextDecoder).decode(n)}),(e=>(console.error(e),"")))),n.push(e.name))})),Promise.all(t).then((e=>{o(e.map(((e,t)=>({name:n[t],content:e}))))}))}),[e.data]),n.createElement(n.Fragment,null,t.sort(((e,t)=>e.name.localeCompare(t.name))).map(((e,t)=>n.createElement(s.Card,{key:e.name+t,className:"build-ext-card"},n.createElement("div",null,n.createElement("div",{"aria-level":2,className:"body-xl",role:"heading"},e.name),n.createElement(a.LegacyComponent,{modules:["DistributedTaskControls/Components/MarkdownRenderer"],wrappedType:"dtMarkdownRenderer",wrappedProps:{cssClass:"content body-m",markdownRendererOptions:i,markdown:e.content}}))))))}}("ComponentsMarkdownCard"),function(e){u=t.ComponentsTimeline={};const a=o.Timeline;t.ComponentsTimeline.Region="buildSummaryTimeline",t.ComponentsTimeline.RunTimeline=function(e){return n.createElement(a,{resource:e.build,className:"flex",projectId:e.projectId,regionForSnapshots:t.ComponentsTimeline.Region,showAllContributedItemsAtOnce:!0})}}(),function(e){t.RunTabService={};class a extends c.VssService{constructor(){super(...arguments),this._tabs=new i.ObservableArray,this._tab={id:"ms.vss-build-web.run-extensions-tab",name:d.TabName,order:100},this._fetch=async()=>{if(this._data){const e=this._data.runId.value,t=this._data.projectId.value,a=this.pageContext.getRestClient("IBuildRestClient"),s=await a.getBuild(t,e),r=await a.getAttachments(t,e,"DistributedTask.Core.Summary")||[],o=await a.getAttachments(t,e,"Distributedtask.Core.Summary")||[],i=r.concat(o),c=this.pageContext.getService("IVssLayoutManager").getComponentsForRegion(u.Region);(i.length>0||c.length>0)&&(this._tab.render=()=>n.createElement(n.Fragment,null,n.createElement(u.RunTimeline,{build:s,projectId:t}),n.createElement(l.MarkdownCard,{data:i})),0==this._tabs.length&&this._tabs.push(this._tab))}}}getTabs(e,t){return this._data=t,this._data&&(this._fetch(),this._data.status.subscribe(this._fetch)),this._tabs}_serviceEnd(e){this._data&&this._data.status.unsubscribe(this._fetch)}}t.RunTabService.RunTabService=a,c.Services.add("run-ext-tab-service",{serviceFactory:a})}()}),["Resources","Components/LegacySection","Components/MarkdownCard","Components/Timeline","RunTabService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.run-extensions"}}));