"use strict";define("Build/Shared",["require","exports","react","VSSUI/Button","VSSUI/Util","VSS/Platform/Components/FPSLink","VSSUI/FocusZone","VSSUI/TooltipEx","VSS/Platform/Layout","VSSUI/Icon","VSSUI/Status","VSS/Platform/Context","VSS/Platform/Location"],(function(e,t,s,i,n,o,r,a,l,c,m,p,h){var d,u,y,g,I;d=t.Resources={},t.Resources.NewBuildDefinition="New build pipeline",t.Resources.NewPipeline="New pipeline",t.Resources.NewReleaseDefinition="New release pipeline",function(e){u=t[e]={};class o extends s.PureComponent{constructor(e){super(e),this._onToggleExpand=()=>{this.setState({isExpanded:!this.state.isExpanded})},this.state={isExpanded:e.isExpandedByDefault||!1}}render(){const e=this.props.sectionKey+"-details",t=this.props.sectionKey+"-header",o=this._getHeader();let r=!0;return this.props.chevronProps&&(r=!this.props.chevronProps.hide),s.createElement("div",{className:(0,n.css)("build-shared-details-section","flex","flex-column","flex-grow ",this.props.className),role:"tabpanel"},s.createElement("div",{className:"summary-primary-section flex"},o&&s.cloneElement(o,Object.assign(Object.assign({},o.props),{id:t})),r&&s.createElement(i.Button,Object.assign({subtle:!0,iconProps:{iconName:this.state.isExpanded?"ChevronUp":"ChevronDown",style:{fontSize:"12px"}},className:"chevron-area","aria-controls":e},this.props.chevronProps?{ariaLabel:this.props.chevronProps.ariaLabel}:{},{"aria-expanded":this.state.isExpanded,onClick:this._onToggleExpand}))),this._getSubHeader(),s.createElement("div",{className:(0,n.css)("details-section",!this.state.isExpanded&&"details-hidden"),id:e,"aria-labelledby":t},this._getContent()))}componentWillReceiveProps(e){this.props.isExpandedByDefault!==e.isExpandedByDefault&&this.setState({isExpanded:!!e.isExpandedByDefault})}_getHeader(){let e=null;return s.Children.map(this.props.children,(t=>{"object"==typeof t&&null!=t&&t.type===a&&(e=t)})),e}_getSubHeader(){let e=null;return s.Children.map(this.props.children,(t=>{"object"==typeof t&&null!=t&&t.type===l&&(e=t)})),e}_getContent(){let e=null;return s.Children.map(this.props.children,(t=>{"object"==typeof t&&null!=t&&t.type===r&&(e=t)})),e}}t[e].DetailsSection=o;class r extends s.Component{render(){return s.createElement("div",{className:"content"},s.Children.only(this.props.children))}}t[e].DetailsSectionContent=r;class a extends s.Component{render(){return this.props.renderAsHeading?s.createElement("h3",{className:"header-text ci-hover-behavior",id:this.props.id},s.Children.only(this.props.children)):s.createElement("div",{id:this.props.id},">",s.Children.only(this.props.children))}}t[e].DetailsSectionHeader=a;class l extends s.Component{render(){return s.createElement("div",{className:"summary-secondary-text"},s.Children.only(this.props.children))}}t[e].DetailsSectionSecondaryHeader=l}("ComponentsDetailsSectionDetailsSection"),t[I="ComponentsDetailsSectionindex"]={},__exportStar(u,t[I]),function(e){var i;y=t[e]={},function(e){e.Success="succeeded",e.Failure="failure",e.Warning="warning",e.Running="running",e.Unknown="unknown"}(i=t[e].HistogramStates||(t[e].HistogramStates={})),t[e].TelemetryContext=s.createContext("build-histogram");var l;!function(e){const t=90,s=0;e.getOffsetValueInPixels=function(e,i,n){let o=100/(i.max||100)*(e=e||100);return o=function(e){return e=(e=(e=100-e)>t?t:e)<s?s:e}(o),o*=n/100,o},e.getRange=function(e){return{min:Math.min(...e),max:Math.max(...e)}}}(l||(l={}));class c extends s.Component{constructor(e){super(e),this.state={hoveredItem:null}}render(){if(0==this.props.items.length)return null;{let e=this.props.items.slice()||[];const t=this.props.width||22,i=this.props.height||80;if(this.props.minimumLength&&e.length<this.props.minimumLength){const t=[];for(let s=0;s<this.props.minimumLength-e.length;++s){const e={id:"_histogram_placeholder_"+s,value:0,noHoverStyles:!0,state:p};t.push(e)}e=t.concat(e)}const o=e.map((e=>e.value||0)),a=l.getRange(o);let h=s.createElement("ul",{className:"histogram-items-list flex flex-row","aria-label":this.props.ariaLabelForList},e.map(((o,r)=>{let h=1;this.props.selectRightMost&&r!=e.length-1&&(h=.5),null===this.state.hoveredItem||o.noHoverStyles||e[this.state.hoveredItem].state===p||(h=r!==this.state.hoveredItem?.5:1);const d=l.getOffsetValueInPixels(o.value,a,i);return s.createElement("li",{"aria-hidden":o.noHoverStyles,key:o.id,className:(0,n.css)("histogram-items-list-item","padded-item relative",!!o.noHoverStyles&&c.s_noHoverStylesClassName),onMouseOver:()=>this.setState({hoveredItem:r}),onMouseOut:()=>this.setState({hoveredItem:null})},s.createElement(m,{item:o,excludeTabStop:this.props.excludeTabStopOnItems,renderTooltip:o.state!==p&&this.props.renderTooltip?()=>this.props.renderTooltip(o):void 0,styles:{paddingTop:o.state===p?"0px":d+"px",width:t,height:i-(o.state===p?0:d),opacity:h}}))})));return this.props.noFocusZone||(h=s.createElement(r.FocusZone,Object.assign({direction:1,circularNavigation:!0},this.props.focusZoneProps),h)),s.createElement("div",{className:(0,n.css)("build-common-histogram",this.props.className)},h,!this.props.noBorderElement&&s.createElement("div",{className:"border-element"}))}}}t[e].Histogram=c,c.s_noHoverStylesClassName="no-hover-style";class m extends s.PureComponent{constructor(){super(...arguments),this._onPlaceholderClick=e=>{e.preventDefault()}}render(){const i=this.props.item,l={paddingTop:this.props.styles.paddingTop};return s.createElement(a.Tooltip,{renderContent:this.props.renderTooltip,text:this.props.renderTooltip?void 0:i.tooltip},s.createElement("span",null,s.createElement("div",{className:"histogram-item-container",style:l},i.href&&s.createElement(r.FocusZoneContext.Consumer,null,(r=>s.createElement(t[e].TelemetryContext.Consumer,null,(e=>s.createElement(o.FPSLinkComponent,{tabIndex:this.props.excludeTabStop?-1:0,"aria-label":i.tooltip,href:i.href,className:(0,n.css)(m.s_itemClassName,...this._getClassNameInputs(),this.props.className),"data-is-focusable":!0,"data-focuszone":r.focuszoneId,style:this._getStyles(),telemetrySource:e}))))),!i.href&&i.state!==p&&s.createElement("div",{className:(0,n.css)(m.s_itemClassName,...this._getClassNameInputs(),this.props.className),"data-is-focusable":!0,style:this._getStyles()}),!i.href&&i.state===p&&s.createElement("div",{className:(0,n.css)(m.s_itemClassName,...this._getClassNameInputs(),this.props.className),"data-is-focusable":!0,style:this._getStyles(),onClick:this._onPlaceholderClick}))))}_getClassNameInputs(){const e=this.props.item.state||i.Unknown;return[e===i.Success&&"histogram-success-color",e===i.Failure&&"histogram-failure-color",e===i.Warning&&"histogram-warning-color",e===i.Running&&"histogram-running-color",e===i.Unknown&&"histogram-unknown-color",e===p&&"histogram-placeholder-color",!!this.props.isSelected&&"histogram-selected-item"]}_getStyles(){const e={},t=this.props.styles;return t&&(e.width=t.width,e.height=t.height,e.opacity=t.opacity),e}}m.s_itemClassName="histogram-item";const p="placeholder"}("ComponentsHistogramHistogram"),function(e){t[e]={},__exportStar(y,t[e])}("ComponentsHistogramindex"),function(e){g=t[e]={};class i extends l.VssComponent{constructor(e){super(e),this._itemKeyToInitializedState={},this._itemKeyToMarker={},this._markerToItemKeys={},this._contributedItemKeyToElement={},this._lazyItemKeyToElement={},this._mounted=!1,this._itemsPendingInitialization={},this._lazyItems=[],this._contributedItems=new Set,this._currentContributedItems=new Set,this._initializeContributedItem=e=>{this._initializeLazyItem(e,!0)},this._initializeLazyItem=(e,t)=>{const s=e&&e.props,i=s&&s.snapshotKey;i&&(t?(this._contributedItemKeyToElement[i]=e,this._currentContributedItems.add(i),this._currentContributedItems.size===this._contributedItems.size&&this.setState({contributedItemsAvailable:!0})):this._lazyItemKeyToElement[i]=e,this._initializeItem(this.props.resource,e))},this.state={orderedItemKeys:[],contributedItemsAvailable:!e.showAllContributedItemsAtOnce}}render(){return s.createElement("div",{className:`build-shared-timeline flex ${this.props.className||""}`},s.createElement("div",{className:"contributed-snapshot-mounter hidden"},this._getContributedChildren(),this._getLazyItems()),this._getItemsInOrder(this.state.orderedItemKeys))}componentDidMount(){super.componentDidMount(),this._mounted=!0,this._initializeItems(this.props.resource,this.props.children),this.setTimeout((()=>{this.state.contributedItemsAvailable||this.setState({contributedItemsAvailable:!0})}),1e3)}UNSAFE_componentWillReceiveProps(e){let t=!0;if(this.props.resource===e.resource&&s.Children.count(this.props.children)===s.Children.count(e.children)){t=!1;const i=s.Children.toArray(this.props.children),n=s.Children.toArray(e.children);for(let e=0;e<i.length;e++){const s=i[e];if(s&&s.props){const i=n[e];if(!i||!i.props){t=!0;break}if(s.props.snapshotKey!==i.props.snapshotKey){t=!0;break}}}}t&&(this._clearInitialization(),this._initializeItems(e.resource,e.children)),Object.keys(this._itemsPendingInitialization).forEach((t=>{this._initializeItem(e.resource,this._itemsPendingInitialization[t])}))}componentWillUnmount(){super.componentWillUnmount(),this._mounted=!1,this._clearInitialization()}_getItemsInOrder(e){const t=[],i={},n=[];return s.Children.map(this.props.children,((e,t)=>{const s=e;n.push(s)})),Object.keys(this._lazyItemKeyToElement).forEach((e=>{n.push(this._lazyItemKeyToElement[e])})),this.state.contributedItemsAvailable&&Object.keys(this._contributedItemKeyToElement).forEach((e=>{n.push(this._contributedItemKeyToElement[e])})),n.forEach(((e,t)=>{const n=e&&e.props,r=n&&n.snapshotKey;if(r){const t=o,n=s.createElement(t,Object.assign({key:e.props.snapshotKey},e.props),e.props.children);i[r]=n}})),e.forEach((e=>{const s=i[e];s&&t.push(s)})),t}_getContributedChildren(){const e=[];if(this.props.regionForSnapshots){this.context.pageContext.getService("IVssLayoutManager").getComponentsForRegion(this.props.regionForSnapshots).value.map(((t,i)=>{const n=t.componentProperties,o={snapshotRef:this._initializeContributedItem,projectId:this.props.projectId};n.snapshotKey&&(this._contributedItems.add(n.snapshotKey),e.push(s.createElement(l.WrappedComponent,Object.assign({key:i,wrappedType:t.componentType},n,o))))}))}return e}_getLazyItems(){const e=[];return this._lazyItems.forEach((t=>{const i=Object.assign(Object.assign({},t.props),{snapshotRef:this._initializeLazyItem});e.push(s.cloneElement(t,i))})),e}_initializeItems(e,t){s.Children.map(t,((t,s)=>{const i=t;this._initializeItem(e,i)})),Object.keys(this._contributedItemKeyToElement).forEach((t=>{this._initializeItem(e,this._contributedItemKeyToElement[t])})),Object.keys(this._lazyItemKeyToElement).forEach((t=>{this._initializeItem(e,this._lazyItemKeyToElement[t])}))}_initializeItem(e,t){const s=t&&t.props,i=s&&s.snapshotKey;if(i)!this._itemKeyToInitializedState[i]&&s.initializeSnapshot&&(console.info("Timeline Shared Component: Initializing component "+i),s.initializeSnapshot(e,(e=>{if(e&&e instanceof Date){this._itemKeyToMarker[i]=e;const t=e.toString();this._markerToItemKeys[t]=this._markerToItemKeys[t]||[],this._markerToItemKeys[t].push(i),this._updateItemKeys(),this._itemKeyToInitializedState[i]=!0,this._itemsPendingInitialization[i]&&delete this._itemsPendingInitialization[i],console.info("Timeline Shared Component: Initialized component "+i+" with marker",e)}else this._itemsPendingInitialization[i]=t,console.warn("Timeline Shared Component: Marker is not of type Date from component with snapshot key: "+i+"...this won't show up")}),(()=>{this.forceUpdate()})));else{const e=s;e&&e.snapshotRef?this._lazyItems.push(t):console.warn("Timeline Shared Component: snapshotKey is not given for one of the child, that element won't render.")}}_updateItemKeys(){const e=Object.keys(this._markerToItemKeys).sort(((e,t)=>new Date(t).getTime()-new Date(e).getTime()));let t=[];e.forEach((e=>{t=t.concat(this._markerToItemKeys[e])})),this._setState(t)}_setState(e){if(this._mounted){const t=e.filter(((e,t,s)=>s.indexOf(e)===t));this.setState({orderedItemKeys:t})}}_clearInitialization(){this._itemKeyToInitializedState={}}}t[e].Timeline=i;class o extends s.Component{render(){const e=this.props.statusIconProps,t=isNaN(e)?void 0:e,i=this.props.statusIconProps,o=void 0!==t,r=!o&&i;return s.createElement("div",{className:(0,n.css)("snapshot",this.props.className)},s.createElement("div",{className:"marker-col flex flex-grow flex-center"},s.createElement("div",{className:"marker-icon relative flex flex-center justify-center"},this.props.onRenderIcon?this.props.onRenderIcon():this.props.iconProps&&s.createElement(c.Icon,{iconName:this.props.iconProps.name,className:(0,n.css)("content",this.props.iconProps.className)}),o&&s.createElement("span",{className:"marker-status-icon absolute"},s.createElement("span",{className:"counter-status fontWeightHeavy"},s.createElement("span",{className:"counter-value"},t))),r&&i.iconName&&s.createElement("span",{className:"marker-status-icon absolute"},s.createElement(c.Icon,{iconName:i.iconName,className:i.className})),r&&i.statusProps&&s.createElement("span",{className:"marker-status-icon absolute"},s.createElement(m.Status,Object.assign({},i.statusProps,{size:"24"})))),s.createElement("div",{className:"beam"})),s.createElement("div",{className:"content-col"},this.props.children))}}t[e].TimelineSnapshot=o,l.Components.add("shared-timeline",i)}("ComponentsTimelineTimeline"),function(e){t[e]={},__exportStar(g,t[e])}("ComponentsTimelineindex"),function(e){t.CreateMenuProvider={};const s="CICDActionMenu";var i;!function(e){e.BuildNamespaceId="33344d9c-fc72-4d6f-aba5-fa317101a7e9",e.EditBuildDefinitionPermission=2048}(i||(i={}));class n extends p.VssService{constructor(){super(...arguments),this.menuItems=[]}_serviceStart(e){super._serviceStart(e);const t=this.pageContext.getService("ITfsPageService").getData();if(t&&t.project){const e=this.pageContext.getService("IVssSecurityService").hasPermission(i.BuildNamespaceId,t.project.id,i.EditBuildDefinitionPermission),n={};n.project=t.project.name,n.source=s,e&&this.menuItems.push({id:"newBuildDefinition",groupKey:"app-actions",href:(0,h.routeUrl)(this.pageContext,"ms.vss-ciworkflow.ci-editor-route",{project:t.project.name,source:s}),iconProps:{iconName:"Build"},rank:100,text:d.NewPipeline})}}getMenuItems(e){return"ms.vss-tfs-web.vertical-header-create-menu"===e?this.menuItems:null}}p.Services.add("build-release-create-menu-provider",{serviceFactory:n})}()}),["Resources","Components/DetailsSection/DetailsSection","Components/DetailsSection/index","Components/Histogram/Histogram","Components/Histogram/index","Components/Timeline/Timeline","Components/Timeline/index","CreateMenuProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.shared"}}));