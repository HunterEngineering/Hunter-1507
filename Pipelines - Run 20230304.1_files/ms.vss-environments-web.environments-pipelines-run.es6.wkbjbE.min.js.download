"use strict";define("Environments/Pipelines/Run",["require","exports","react","Environments/EnvironmentsCommon/Link","Environments/RunsCommon/Indicator","Environments/RunsCommon/Linking","Environments/RunsCommon/Utils","VSS/Core/Observable","VSS/Features/PlatformUI/FPSLink","VSS/Platform/FPS","VSS/Platform/Layout","VSSUI/Card","VSSUI/Duration","VSSUI/Icon","VSSUI/Status","VSSUI/Table","VSSUI/TooltipEx","Environments/EnvironmentsCommon/Telemetry","VSS/Platform/Context","VSSUI/Observer"],(function(e,n,t,r,s,o,i,a,l,m,c,u,d,v,b,p,h,C,S,R){var E,_;E=n.Resources={},n.Resources.DurationColumnName="Duration",n.Resources.EnvironmentsTabText="Environments",n.Resources.EnvironmentDetailsSubheader="View environment",n.Resources.JobsColmnName="Jobs",n.Resources.ResourceColumnName="Resource",function(e){_=n[e]={};class S extends c.VssComponent{constructor(e,n){super(e,n);const t=this.context.pageContext.getService("IVssHistoryService").getState()[o.RouteParameters.BuildId];(0,C.publishTelemetry)(n.pageContext,i.Area,i.FeatureNames.PipelineRunsView,{Action:i.Action.EnvironmentTabNavigation,BuildId:t})}render(){const e=this.props.environmentsRuns.map(((e,n)=>t.createElement(R,{key:"env-pipeline-card-"+n,environmentRun:e})));return t.createElement(t.Fragment,null,...e)}}n[e].EnvironmentsTabComponent=S;class R extends c.VssComponent{constructor(){super(...arguments),this._renderNameCell=(e,n,r,o)=>{const i=(0,s.getJobStatusIndicatorData)(o.result);return t.createElement(p.SimpleTableCell,{columnIndex:n,tableColumn:r,key:"col-"+n,contentClassName:"fontWeightSemiBold fontSizeM scroll-hidden"},t.createElement(h.Tooltip,{text:i.label},t.createElement("span",{className:"flex-row"},t.createElement(b.Status,Object.assign({},i.statusProps,{className:"envs-icon-margin",size:"16"})))),t.createElement("div",{className:"flex-row scroll-hidden"},t.createElement(h.Tooltip,{overflowOnly:!0,text:o.jobName},t.createElement("span",{className:"text-ellipsis"},o.jobName))))},this._renderResourceCell=(e,n,r,s)=>t.createElement(p.SimpleTableCell,{columnIndex:n,tableColumn:r,key:"col-"+n,contentClassName:"bolt-table-cell-content-with-inline-link no-v-padding fontSizeM"},this._getResourceCellContent(s)),this._renderDurationCell=(e,n,r,s)=>s.startTime?t.createElement(p.SimpleTableCell,{columnIndex:n,tableColumn:r,key:"col-"+n,contentClassName:"fontSizeM scroll-hidden secondary-text"},t.createElement(v.Icon,{iconName:"Clock",className:"icon-margin"}),t.createElement(d.Duration,{startDate:s.startTime,endDate:s.finishTime})):t.createElement(p.SimpleTableCell,{columnIndex:n,tableColumn:r,key:"col-"+n,contentClassName:"fontSizeM scroll-hidden"}),this._onJobClick=(e,n)=>{if(n.data){const t=this.context.pageContext.getService("IVssHistoryService").getState()[o.RouteParameters.BuildId],r=this.context.pageContext;let s={};s[o.NavConstants.job]=n.data.jobId;const i=(0,o.getBuildUrl)(r,Number(t),s);e.preventDefault(),(0,m.onClickFPS)(r,i,!0,void 0)}},this._commandBarItems=[{important:!0,id:"viewEnvironment"+this.props.environmentRun.environmentReference.id,text:E.EnvironmentDetailsSubheader,onActivate:()=>{(0,m.onClickFPS)(this.context.pageContext,(0,r.getEnvironmentPageUrl)(this.context.pageContext,this.props.environmentRun.environmentReference.id),!0)}}],this._jobsTableColumns=[{id:"name",width:264,name:E.JobsColmnName,renderCell:this._renderNameCell,columnStyle:2},{id:"resource",width:264,name:E.ResourceColumnName,renderCell:this._renderResourceCell},{id:"duration",width:-100,name:E.DurationColumnName,renderCell:this._renderDurationCell}]}render(){return t.createElement(u.Card,{className:"bolt-table-card card-spacer",titleProps:{text:this.props.environmentRun.environmentReference.name},headerCommandBarItems:this._commandBarItems,key:"pipeline-environment-"+this.props.environmentRun.environmentReference.id,contentProps:{contentPadding:!1}},this._jobsTable())}_jobsTable(){const e=new a.ObservableArray(this.props.environmentRun.jobs);return t.createElement(p.Table,{itemProvider:e,columns:this._jobsTableColumns,onActivate:this._onJobClick,ariaLabel:this.props.environmentRun.environmentReference.name})}_getResourceCellContent(e){if(e.resourceReference){const n=e.resourceReference.name,s=(0,r.getResourceRoute)(e.resourceReference.type),o=(0,r.getResourcePageUrl)(this.context.pageContext,this.props.environmentRun.environmentReference.id,e.resourceReference.id,s);return t.createElement(h.Tooltip,{overflowOnly:!0,text:n},t.createElement(l.FPSLink,{className:"text-ellipsis bolt-table-link bolt-table-inline-link",excludeTabStop:!0,href:o},n))}}}}("EnvironmentsRunTabContent"),function(e){n.EnvironmentsRunTabService={};class r extends S.VssService{constructor(){super(...arguments),this._updateEnvironmentsTab=async()=>{const e=this.pageContext.getService("IVssContributionService"),n=await e.getDataAsync(this._dataProviderId,void 0,!0);n&&n.environmentRunObjects&&n.environmentRunObjects.length>0&&(this._environmentsRunData.value=n.environmentRunObjects,0===this._tabs.length&&this._tabs.push(this._tab))},this._renderEnvironments=()=>t.createElement(R.Observer,{data:this._environmentsRunData},(e=>t.createElement(_.EnvironmentsTabComponent,{environmentsRuns:e.data}))),this._tab={id:"environments",name:E.EnvironmentsTabText,order:3,render:this._renderEnvironments},this._tabs=new a.ObservableArray,this._environmentsRunData=new a.ObservableArray,this._dataProviderId="ms.vss-environments-web.environments-run-view-data-provider"}getTabs(e,n){const t=this.pageContext.getService("IVssContributionService");if(n&&n.notifyUpdated){this._contextualData=n;const e=t.getData(this._dataProviderId);e?e.environmentRunObjects&&e.environmentRunObjects.length>0&&(this._environmentsRunData.value=e.environmentRunObjects,this._tabs.push(this._tab)):this._updateEnvironmentsTab(),this._contextualData.notifyUpdated.subscribe(this._updateEnvironmentsTab)}return this._tabs}_serviceEnd(e){this._contextualData&&this._contextualData.notifyUpdated&&this._contextualData.notifyUpdated.unsubscribe(this._updateEnvironmentsTab),super._serviceEnd(e)}}S.Services.add("pipelines-environments-tab-provider-service",{serviceFactory:r})}()}),["Resources","EnvironmentsRunTabContent","EnvironmentsRunTabService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-environments-web.environments-pipelines-run"}}));