"use strict";define("Build/Run",["require","exports","react","VSS/Features/PlatformUI/FPSLink","VSS/Platform/Location","VSS/Platform/Layout","VSSUI/Icon","VSS/Core/Util/String","VSSUI/Button","VSSUI/Observer","VSSUI/MessageCard","VSS/Core/Observable","VSSUI/Link","VSSUI/Panel","VSSUI/Table","Build/Common/Library/Constants","VSS/Platform/FPS","Build/Common/Library/Indicator","VSS/Platform/Feature","VSSUI/Card","VSSUI/Status","VSSUI/Surface","VSSUI/Tabs","VSSUI/TooltipEx","VSSUI/Util","VSSUI/Duration","VSS/Core/Util/Promise","VSS/Platform/Util/Array","VSS/Platform/Context","Tfs/Platform/Page","Test/Client/RestClient/TestResults","Test/common-util/TestSummaryReport.Utils","Test/common-util/Common.Utils","Build/Common/Library/Components/CommandComponent","VSSUI/FocusGroup","VSSUI/FocusZone","VSSUI/Utilities/Date","VSSUI/Utilities/ScreenSize","VSSUI/Page","VSSUI/List","VSSUI/Utilities/Provider","Build/Common/Library/Identity","VSS/Platform/Identity","Build/Common/Library/Components/BuildPersona","VSSUI/Ago","Build/SourceProviders/Common","VSSUI/Spinner","Build/Common/Library/Components/BranchLink","Build/Common/Library/Components/CommitLink","Build/Common/Library/Components/RepoLink","Build/SourceProviders/Resources","VSSUI/Image","VSSUI/Pill","VSSUI/ResponsiveViewport","VSSUI/Dialog","VSSUI/TagPicker","Build/Common/Library/SignalRHubProxies","DistributedTask/Common/SignalR/SignalRHubProxies","VSS/Features/SignalR/Hub","Build/Client/RestClient/Approval","Build/Client/RestClient/PipelinePermissions","Build/Common/Library/ErrorHandler","Build/Common/Library/Security","Build/Common/Library/Stores/Permissions","VSS/Core/TimerManagement","Build/Common/Library/Components/RetentionPanel","Build/Common/Library/Navigation","Build/Common/Library/PipelineRunNameFormatter","Build/Common/Library/StateHandler","VSS/Features/PlatformUI/ContributedMenu","VSS/Features/PlatformUI/ContributedTab","VSSUI/Header","VSSUI/HeaderCommandBar","VSSUI/PillGroup","VSS/Features/PlatformUI/ContributedIcon","Build/Flux/Sources/Contribution","VSS/Features/PlatformUI/ContributedItemUtil","DistributedTask/Client/RestClient/TaskAgent","PipelinesUI/Utilities/Parser","VSS/Platform/Fetch","PipelinesUI/LogViewer","VSS/Core/Util/Accessibility","VSSUI/MasterDetails","VSSUI/TextField","VSSUI/TreeEx","VSSUI/Utilities/TreeItemProvider"],(function(e,t,s,a,i,r,n,o,l,c,u,d,h,m,p,g,_,v,b,C,f,S,y,R,k,w,I,T,x,N,D,E,P,M,A,L,V,B,j,F,O,U,H,z,W,J,G,q,Y,Q,K,$,X,Z,ee,te,se,ae,ie,re,ne,oe,le,ce,ue,de,he,me,pe,ge,_e,ve,be,Ce,fe,Se,ye,Re,ke,we,Ie,Te,xe,Ne,De,Ee){var Pe,Me,Ae,Le,Ve,Be,je,Fe,Oe,Ue,He,ze,We,Je,Ge,qe,Ye,Qe,Ke,$e,Xe,Ze,et,tt,st,at,it,rt,nt,ot,lt,ct,ut,dt,ht,mt,pt;Pe=t.Resources={},t.Resources.AboutHostedImage="About hosted agent image",t.Resources.AboutTask="About this task",t.Resources.AddTags="Add tags",t.Resources.AddTagsDialogTitle="Tags of the run",t.Resources.Analysis="View analysis",t.Resources.ApprovalReassigned="Approval reassigned",t.Resources.AriaDownloadLog="View raw log",t.Resources.ArtifactCount="{0} artifact",t.Resources.ArtifactsCount="{0} artifacts",t.Resources.ArtifactsCountFormat="{0} produced",t.Resources.ArtifactsHeader="Artifacts:",t.Resources.ArtifactsView_Header="Artifacts",t.Resources.ArtifactsFormat="{0} published; {1} consumed",t.Resources.ArtifactsPublishedFormat="{0} published",t.Resources.ArtifactsConsumedFormat="{0} consumed",t.Resources.AssociatedChanges="Associated changes",t.Resources.AttemptNumber="Attempt #{0}",t.Resources.AuthoredFormat="{0} authored",t.Resources.AuthorizedResourcesButtonText="Resources authorized",t.Resources.AuthorizeResourcesButtonText="Authorize resources",t.Resources.AuthorizeResourcesErrorMessage="An error occurred while auto-authorizing resources",t.Resources.AuthorizeResourcesSuccessMessage="Resources were successfully authorized",t.Resources.AzureContainerRepository="Azure Container Repository",t.Resources.By="by",t.Resources.ByFormat="{0} by {1}",t.Resources.Cancel="Cancel",t.Resources.CancelBuild="Cancel",t.Resources.Cancelling="Cancelling",t.Resources.Canceled="Canceled",t.Resources.CancelingBuild="Canceling",t.Resources.CancelStage="Cancel Stage",t.Resources.ChangesFormat="{0} commits",t.Resources.ChangesHeader="Changes:",t.Resources.ChecksCard_Message_ChecksNeedReviewStage="{0} checks need review before this run can continue to {1}",t.Resources.ChecksCard_Message_CheckWithSingleManualValidationNeedReviewStage="1 check and 1 manual validation need review before this run can continue to {0}",t.Resources.ChecksCard_Message_ChecksWithSingleManualValidationNeedReviewStage="{0} checks and 1 manual validation need review before this run can continue to {1}",t.Resources.ChecksCard_Message_CheckWithManualValidationsNeedReviewStage="1 check and {0} manual validations need review before this run can continue to {1}",t.Resources.ChecksCard_Message_ChecksWithManualValidationsNeedReviewStage="{0} checks and {1} manual validations need review before this run can continue to {2}",t.Resources.ChecksCard_Message_ChecksNeedReview="{0} checks need review before this run can continue",t.Resources.ChecksCard_Message_CheckWithSingleManualValidationNeedReview="1 check and 1 manual validation need review before this run can continue",t.Resources.ChecksCard_Message_ChecksWithSingleManualValidationNeedReview="{0} checks and 1 manual validation need review before this run can continue",t.Resources.ChecksCard_Message_CheckWithManualValidationsNeedReview="1 check and {0} manual validations need review before this run can continue",t.Resources.ChecksCard_Message_ChecksWithManualValidationsNeedReview="{0} checks and {1} manual validations need review before this run can continue",t.Resources.ChecksCard_Message_NeedReview="{0} checks need to pass before this run can continue",t.Resources.ChecksCard_Message_ApprovalNeedReview="{0} approvals need review before this run can continue",t.Resources.ChecksCard_Message_ManualValidationsNeedReview="{0} manual validations need review before this run can continue",t.Resources.ChecksCard_Message_NeedReviewStage="{0} checks need to pass before this run can continue to {1}",t.Resources.ChecksCard_Message_ApprovalNeedReviewStage="{0} approvals need review before this run can continue to {1}",t.Resources.ChecksCard_Message_ManualValidationsNeedReviewStage="{0} manual validations need review before this run can continue to {1}",t.Resources.ChecksCard_Message_NeedYourReview="{0} checks need your review before this run can continue",t.Resources.ChecksCard_Message_CheckWithSingleManualValidationNeedYourReview="1 check and 1 manual validation need your review before this run can continue",t.Resources.ChecksCard_Message_CheckWithManualValidationNeedYourReview="1 check and {0} manual validations need your review before this run can continue",t.Resources.ChecksCard_Message_ChecksWithSingleManualValidationNeedYourReview="{0} checks and 1 manual validation need your review before this run can continue",t.Resources.ChecksCard_Message_ChecksWithManualValidationNeedYourReview="{0} checks and {1} manual validations need your review before this run can continue",t.Resources.ChecksCard_Message_ApprovalNeedYourReview="{0} approvals need your review before this run can continue",t.Resources.ChecksCard_Message_ManualValidationNeedYourReview="{0} manual validations need your review before this run can continue",t.Resources.ChecksCard_Message_NeedYourReviewStage="{0} checks need your review before this run can continue to {1}",t.Resources.ChecksCard_Message_CheckWithSingleManualValidationNeedYourReviewStage="1 check and 1 manual validation need your review before this run can continue to {0}",t.Resources.ChecksCard_Message_CheckWithManualValidationNeedYourReviewStage="1 check and {0} manual validations need your review before this run can continue to {1}",t.Resources.ChecksCard_Message_ChecksWithSingleManualValidationNeedYourReviewStage="{0} checks and 1 manual validation need your review before this run can continue to {1}",t.Resources.ChecksCard_Message_ChecksWithManualValidationNeedYourReviewStage="{0} checks and {1} manual validations need your review before this run can continue to {2}",t.Resources.ChecksCard_Message_ApprovalNeedYourReviewStage="{0} approvals need your review before this run can continue to {1}",t.Resources.ChecksCard_Message_ManualValidationNeedYourReviewStage="{0} manual validations need your review before this run can continue to {1}",t.Resources.ChecksCard_Message_SingleNeedReview="1 check need to pass review before this run can continue",t.Resources.ChecksCard_Message_SingleApprovalNeedReview="1 approval needs review before this run can continue",t.Resources.ChecksCard_Message_SingleManualValidationNeedReview="1 manual validation needs review before this run can continue",t.Resources.ChecksCard_Message_SingleNeedReviewStage="1 check need to pass before this run can continue to {0}",t.Resources.ChecksCard_Message_SingleApprovalNeedReviewStage="1 approval needs review before this run can continue to {0}",t.Resources.ChecksCard_Message_SingleManualValidationNeedReviewStage="1 manual validation needs review before this run can continue to {0}",t.Resources.ChecksCard_Message_SingleNeedYourReview="1 check needs your review before this run can continue",t.Resources.ChecksCard_Message_SingleApprovalNeedYourReview="1 approval needs your review before this run can continue",t.Resources.ChecksCard_Message_SingleManualValidationNeedYourReview="1 manual validation needs your review before this run can continue",t.Resources.ChecksCard_Message_SingleNeedYourReviewStage="1 check needs your review before this run can continue to {0}",t.Resources.ChecksCard_Message_SingleApprovalNeedYourReviewStage="1 approval needs your review before this run can continue to {0}",t.Resources.ChecksCard_Message_SingleManualValidationNeedYourReviewStage="1 manual validation needs your review before this run can continue to {0}",t.Resources.ChecksCard_Message_SomeNeedYourReview="{0} of {1} checks need your review before this run can continue",t.Resources.ChecksCard_Message_SomeCheckWithSingleManualValidationNeedYourReview="1 check and 1 manual validation need your review before this run can continue",t.Resources.ChecksCard_Message_SomeChecksWithSingleManualValidationNeedYourReview="{0} of {1} checks and 1 manual validation need your review before this run can continue",t.Resources.ChecksCard_Message_SomeCheckWithManualValidationsNeedYourReview="1 check and {0} manual validations need your review before this run can continue",t.Resources.ChecksCard_Message_SomeChecksWithManualValidationsNeedYourReview="{0} of {1} checks and {2} manual validations need your review before this run can continue",t.Resources.ChecksCard_Message_SomeApprovalsNeedYourReview="{0} of {1} approvals need your review before this run can continue",t.Resources.ChecksCard_Message_SomeManualValidationsNeedYourReview="{0} of {1} manual validations need your review before this run can continue",t.Resources.ChecksCard_Message_SomeNeedYourReviewStage="{0} of {1} checks need your review before this run can continue to {2}",t.Resources.ChecksCard_Message_SomeCheckWithSingleManualValidationNeedYourReviewStage="1 check and 1 manual validation need your review before this run can continue to {0}",t.Resources.ChecksCard_Message_SomeChecksWithSingleManualValidationNeedYourReviewStage="{0} of {1} checks and 1 manual validation need your review before this run can continue to {2}",t.Resources.ChecksCard_Message_SomeCheckWithManualValidationsNeedYourReviewStage="1 check and {0} manual validations need your review before this run can continue to {1}",t.Resources.ChecksCard_Message_SomeChecksWithManualValidationsNeedYourReviewStage="{0} of {1} checks and {2} manual validations need your review before this run can continue to {3}",t.Resources.ChecksCard_Message_SomeApprovalsNeedYourReviewStage="{0} of {1} approvals need your review before this run can continue to {2}",t.Resources.ChecksCard_Message_SomeManualValidationsNeedYourReviewStage="{0} of {1} manual validations need your review before this run can continue to {2}",t.Resources.ChecksCard_Message_SinglePermissionNeedYourReview="This pipeline needs permission to access a resource before this run can continue",t.Resources.ChecksCard_Message_SinglePermissionNeedYourReviewStage="This pipeline needs permission to access a resource before this run can continue to {0}",t.Resources.ChecksCard_Message_PermissionNeedYourReview="This pipeline needs permission to access {0} resources before this run can continue",t.Resources.ChecksCard_Message_PermissionNeedYourReviewStage="This pipeline needs permission to access {0} resources before this run can continue to {1}",t.Resources.ChecksCard_Review="Review",t.Resources.ChecksCard_View="View",t.Resources.ChecksFailedInfo="{0} checks failed",t.Resources.ChecksStatusRejected="{0} checks rejected",t.Resources.CheckStatusRejected="{0} check rejected",t.Resources.ChecksStatusInfo="{0} checks passed",t.Resources.ChecksCard_ApproveStage="Approve {0}",t.Resources.ChecksCard_RejectStage="Reject {0}",t.Resources.CollapseStage="Collapse stage",t.Resources.CommitsFormat="{0} commit(s)",t.Resources.ConfirmCancelBuild="Are you sure you want to cancel '{0}'?",t.Resources.ConfirmCancelStage="Are you sure you want to cancel '{0}' stage?",t.Resources.ConfirmDeleteRun="Are you sure you want to delete everything in run '{0}', including its logs, artifacts, test results, symbols, and label?",t.Resources.ConfirmRetryStage="Are you sure you want to retry '{0}' stage?",t.Resources.ConfirmRetryStageFailedJobs="Are you sure you want to retry failed jobs in the '{0}' stage?",t.Resources.ConfirmRetryPipeline="Are you sure you want to retry the pipeline's failed jobs?",t.Resources.CopyLogsLocation="Copy logs location",t.Resources.CoverageFormat="{0}% covered",t.Resources.DeleteRun="Delete Run",t.Resources.DeleteRunActionName="Delete",t.Resources.DownloadAllLogs="Download logs",t.Resources.DurationColumnName="Duration",t.Resources.DurationHeader="Duration:",t.Resources.EditPipeline="Edit pipeline",t.Resources.EditTags="Edit tags",t.Resources.EmptyTestTabText="--",t.Resources.Errors="Errors",t.Resources.ErrorAnalysis="Error analysis",t.Resources.ExpandStage="Expand stage",t.Resources.Failed="Failed",t.Resources.GetStarted="Get started",t.Resources.GotoEnd="Scroll to the end",t.Resources.GotoRun="Go to #{0}",t.Resources.GotoTop="Scroll to the top",t.Resources.HelfpulLinks="Helpful links",t.Resources.ImageView_Header="Image",t.Resources.RunNext="Run next",t.Resources.RunNextTooltip="Bump this job to the top of the queue",t.Resources.Issues="Issues",t.Resources.IssuesMessage='<b>{0}:</b> "{1}"',t.Resources.Jenkins="Jenkins",t.Resources.JobColumnName="Name",t.Resources.JobDidNotRun="Job did not run.",t.Resources.JobHasNotStarted="Job has not started.",t.Resources.JobInformation="Job information",t.Resources.JobInfoAgent="Agent: {0}",t.Resources.JobInfoDuration="Duration: {0}",t.Resources.JobInfoImage="Image: {0}",t.Resources.JobInfoPool="Pool: {0}",t.Resources.JobInfoQueued="Queued: {0} [{1}]",t.Resources.JobInfoQueuedOnPrem="Queued: {0}",t.Resources.JobLiveData="Job live console data:",t.Resources.JobInfoStart="Started: {0}",t.Resources.JobsInRun="Jobs in run #{0}",t.Resources.JobsTitle="Jobs",t.Resources.JobsNameMobileFormat="{0}: {1}",t.Resources.Loading="Loading",t.Resources.ManualValidationsFailedInfo="{0} manual validations failed",t.Resources.ManualValidationsStatusInfo="{0} manual validations passed",t.Resources.ManyChecksFailed="{0} checks failed",t.Resources.MultipleJobsCompleted="{0} jobs completed",t.Resources.NoLogs="Job is pending...",t.Resources.NoLogsToastMessage="No logs available for this run",t.Resources.NoMessageForIssue="No message found for this issue",t.Resources.None="None",t.Resources.NotStarted="Not started",t.Resources.NoBuildData="Build not found.",t.Resources.NoTask="Task not found.",t.Resources.OldJobAttempt="This job didn't run in this attempt. Logs shown are from a previous attempt",t.Resources.OneChange="1 commit",t.Resources.OneCheckFailed="1 check failed",t.Resources.OneCheckPassed="1 check passed",t.Resources.OneManualValidationFailed="1 manual validation failed",t.Resources.OneManualValidationPassed="1 manual validation passed",t.Resources.QueueTimeVariableGroup="{0} queue time variable used",t.Resources.QueueTimeVariablesGroup="{0} queue time variables used",t.Resources.ParallelJobsLinkText="manage parallel jobs",t.Resources.PercentComplete="{0}%",t.Resources.PermissionGranted="Permission granted",t.Resources.PermissionNeeded="Permission needed",t.Resources.Pipeline="Pipeline",t.Resources.PipelinePaused="This pipeline is currently paused. All runs will begin executing once the pipeline is unpaused.",t.Resources.PipelineTabName="Summary",t.Resources.PrepareJob="Job preparation parameters",t.Resources.RuntimeParameterGroup="Parent pipeline used these runtime parameters",t.Resources.Property="Property",t.Resources.ReasonBatchedCI="Rolling build triggered",t.Resources.ReasonBuildCompletion="Build completion triggered",t.Resources.ReasonCheckInShelveset="Check-in shelveset",t.Resources.ReasonCI="Triggered",t.Resources.ReasonManual="Manually run",t.Resources.ReasonAutomaticTrigger="Automatically triggered",t.Resources.ReasonPullRequest="Pull request",t.Resources.ReasonScheduled="Scheduled",t.Resources.ReasonValidate="Validate shelveset",t.Resources.RelatedHeader="Related",t.Resources.RepositoryVersionHeader="Repository and version",t.Resources.RepositoriesHeader="Repositories",t.Resources.ResourceAuthIssue="There was a resource authorization issue",t.Resources.RetainBuild="Retain",t.Resources.Retained="Retained",t.Resources.RetainedByLease="Retained by one or more leases",t.Resources.RetainedByLeaseBegin_Exact="This run has been retained for",t.Resources.RetainedByLeaseBegin_MoreThan="This run has been retained for more than",t.Resources.RetainedByLeaseEnd=" by {0} ({1}).",t.Resources.RetainedByLeaseForDays=" {0} days",t.Resources.RetainedByLeaseForMonths=" {0} months",t.Resources.RetainedByLeaseForYears=" {0} years",t.Resources.RetainedByLeaseForOneMonth=" 1 month",t.Resources.RetainedByLeaseForOneDay=" 1 day",t.Resources.RetainedByLeaseForOneYear=" 1 year",t.Resources.RetainedByLeaseForever="This run has been retained forever by {0} ({1})",t.Resources.RetainedByProtectBranchRecentRuns="This run is being retained as one of {0} recent runs by {1} (Branch).",t.Resources.RetainedByPipelineRecentRuns="This run is being retained as one of {0} recent runs by pipeline.",t.Resources.RetainedByNobody="This run will be cleaned up after {0} based on your project settings.",t.Resources.RetainedByNobodyNextRun="This run is scheduled to be cleaned up the next time the cleanup job executes.",t.Resources.RetryAll="Rerun all jobs",t.Resources.RetryFromFailed="Rerun failed jobs",t.Resources.RetrySucceeded="Rerun stage",t.Resources.RetryPipeline="Retry Pipeline",t.Resources.RetryStage="Retry Stage",t.Resources.Review="Review",t.Resources.RunDetailsSubtitle="on {0}",t.Resources.RunPipeline="Run new",t.Resources.RunQueued="{0} queued",t.Resources.RunTimeDetails="Run-time details",t.Resources.Save="Save",t.Resources.SearchLabel="Find",t.Resources.SearchMatch="{0} of {1}",t.Resources.SearchNext="Next",t.Resources.SearchNone="No results",t.Resources.SearchPrev="Previous",t.Resources.SearchClose="Close",t.Resources.SetupCoverage="Setup code coverage",t.Resources.ShowAdditionalIssues="Show {0} additional {1}",t.Resources.ShowMoreErrors="Show more errors",t.Resources.ShowMoreWarnings="Show more warnings",t.Resources.ShowPreviousAttempts="Show Previous Attempts",t.Resources.SingleJobCompleted="1 job completed",t.Resources.Skipped="Skipped",t.Resources.SkippedJobLogs="The job was skipped.",t.Resources.SourceCardTitle="Sources",t.Resources.SourceCardChangesColumnTitle="Changes",t.Resources.SourceCardRelatedColumnTitle="Related",t.Resources.SourceCardRepositoryColumnTitle="Repository",t.Resources.SourceCardVersionColumnTitle="Version",t.Resources.SourceCardNoneLabel="None",t.Resources.SourceCardLink="See Sources card for details",t.Resources.SourceCardCommitLabel="1 commit",t.Resources.SourceCardCommitsLabel="{0} commits",t.Resources.SourceCardBranchColumnTitle="Branch / tag",t.Resources.StageDescription="{0}, {1}, {2}",t.Resources.StageDescriptionWithStartTime="{0}, {1}, {2}, {3}",t.Resources.StageColumnName="Stage",t.Resources.StageInProgress="{0}/{1} completed",t.Resources.StagesTitle="Stages",t.Resources.StatusColumnName="Status",t.Resources.StopRetainingBuild="Stop retaining run",t.Resources.SummaryTitle="Summary",t.Resources.TagsDialogPlaceholder="Add tag",t.Resources.TaskName="{0} task",t.Resources.TestsHeader="Tests and coverage",t.Resources.TestResultsFormat="{0}% passed",t.Resources.TestResultTestsFormat="{0}% tests",t.Resources.TestResultPassedFormat="{0} passed",t.Resources.TimeElapsedHeader="Time started and elapsed",t.Resources.TitleSummary="Pipelines - Run {0}",t.Resources.TitleLogs="Pipelines - Run {0} logs",t.Resources.ToggleTimestamps="Toggle timestamps",t.Resources.Troubleshoot="Troubleshooting failed runs",t.Resources.UnnamedStage="Stage",t.Resources.Value="Value",t.Resources.ViewAgent="View agent",t.Resources.ViewChange="View change",t.Resources.ViewChanges="View {0} changes",t.Resources.ViewLog="View log",t.Resources.ViewLogForMoreErrors="View the log to see the remaining {0} errors for this task",t.Resources.ViewLogForMoreWarnings="View the log to see the remaining {0} warnings for this task",t.Resources.ViewPipeline="View pipeline",t.Resources.ViewRetentionLeasesMenuItem="View retention leases",t.Resources.Warnings="Warnings",t.Resources.WaitingForApproval="Waiting",t.Resources.WebHook="WebHook",t.Resources.WorkItemsFormat="{0} work items",t.Resources.WorkItemsMoreThanThresholdFormat="{0}+ linked",t.Resources.WorkItemsHeader="Work items:",function(e){Me=t[e]={};class o extends r.VssComponent{constructor(e,t){super(e,t)}render(){const e={};this._initializeRouteValues(this.context.pageContext,e);let t=(0,i.routeUrl)(this.context.pageContext,this.props.routeId,e);return s.createElement(a.FPSLink,{supportsFPS:!0,telemetryProperties:this.props.telemetryProperties||{},telemetrySource:"RunSummary",ariaDescribedBy:this.props.linkDescribedBy,className:this.props.linkClassName,href:t,subtle:this.props.subtle},s.createElement("span",{className:"text-ellipsis"},s.createElement(n.Icon,{iconName:this.props.iconName,className:"pipelines-icon-right-margin"}),this.props.urlDisplayText))}_initializeRouteValues(e,t){let s="";const a=e.getService("ITfsPageService").getData();a&&!s&&a.project&&(s=a.project.name),s&&(t.project=s),this.props.currentRunId&&(t.currentRunId=this.props.currentRunId.toString())}}t[e].RunSummaryBaseLinkComponent=o}("ComponentsRunSummaryBaseLinkComponent"),function(e){Ae=t[e]={};class a extends r.VssComponent{constructor(e,t){super(e,t)}render(){const e={};return this._initializeRouteValues(this.context.pageContext,e),s.createElement(c.Observer,{traceabilityChangesCount:this.props.traceabilityChangesCount},(t=>{const a=t.traceabilityChangesCount,r="text-ellipsis flex-row flex-baseline";let n=(0,i.routeUrl)(this.context.pageContext,"ms.vss-traceability-web.traceability-run-changes-hub-default-route",e);if(a&&a>0){const e=1==a?Pe.ViewChange:(0,o.localeFormat)(Pe.ViewChanges,a.toString());return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:r,href:n,onClick:this._onClick},e)}if(a){const e=1==a?Pe.ViewChange:(0,o.localeFormat)(Pe.ViewChanges,a.toString());return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:r},e)}return null}))}_initializeRouteValues(e,t){let s="";const a=e.getService("ITfsPageService").getData();a&&!s&&a.project&&(s=a.project.name),s&&(t.project=s),this.props.currentRunId&&(t.currentRunId=this.props.currentRunId.toString())}_onClick(){this.context.pageContext.getService("IVssTelemetryService").publishEvent("WebPlatform","Link",Object.assign({clickedOn:"RunViewChanges"},{source:"RunSummary"}))}}t[e].RunSummaryChangesLink=a}("ComponentsRunSummaryChangesLinkComponent"),function(e){Le=t[e]={};class a extends r.VssComponent{constructor(e,t){super(e,t)}render(){return s.createElement(c.Observer,{traceabilityWorkItemsCountData:this.props.traceabilityWorkItemsCount},(e=>{const t=e.traceabilityWorkItemsCountData;if(t&&t>0){var a="";return a=t>50?(0,o.localeFormat)(Pe.WorkItemsMoreThanThresholdFormat,50..toString()):(0,o.localeFormat)(Pe.WorkItemsFormat,t.toString()),s.createElement(Me.RunSummaryBaseLinkComponent,{currentRunId:this.props.currentRunId,linkClassName:"text-ellipsis flex-row flex-baseline ",iconName:"WorkItem",routeId:"ms.vss-traceability-web.traceability-run-workitems-hub-default-route",urlDisplayText:a,subtle:!0,telemetryProperties:{clickedOn:"RunViewWorkItems"},linkDescribedBy:this.props.linkDescribedBy})}return s.createElement("span",{className:"text-ellipsis secondary-text summary-line-non-link"},s.createElement(n.Icon,{iconName:"WorkItem",className:"pipelines-icon-right-margin"}),(0,o.localeFormat)(Pe.WorkItemsFormat,"0"))}))}}t[e].RunSummaryWorkItemsLink=a}("ComponentsRunSummaryWorkItemsLinkComponent"),Ve=t.Constants={},(mt=t.Constants.Telemetry||(t.Constants.Telemetry={})).Area="Build",mt.RunArtifacts="Pipelines.RunArtifacts",mt.RunDetails="Pipelines.RunDetails",mt.RunLogs="Pipelines.RunLogs",t.Constants.NavTestTabId="ms.vss-test-web.build-test-results-tab",t.Constants.CodeCoverageCiTabId="codecoverage-tab",t.Constants.AuthorizationCheckTypeIdString="E1A1FC6C-C278-4492-AE1C-C42F8697612C",t.Constants.ManualValidationTaskTypeIdString="2003AD3A-104A-451A-9238-60474AB294E6",t.Constants.ApprovalCheckTypeId="8C6F20A7-A545-4486-9777-F762FAFE0D4D",t.Constants.RetentionSettingDataContributionId="ms.vss-build-web.pipelines-retention-data-provider",(ht=t.Constants.LeaseType||(t.Constants.LeaseType={})).Pipeline="Pipeline",ht.Branch="Branch",ht.User="User",ht.ReleaseManagment="RM",function(e){Be=t[e]={};t[e].ChecksCard=e=>{const[t,a]=s.useState([]),[i,r]=s.useState(0),[n,l]=s.useState(0),[c,d]=s.useState(0),[h,m]=s.useState(0),[p,g]=s.useState(0),[_,v]=s.useState(0);s.useEffect((()=>{let t=0,s=0,i=0,n=0,c=0,u=0,h=[];for(const a of e.stages){let e=!1;for(const r of a.checks||[])1===r.permissions&&(t++,(0,o.equals)(r.typeId,Ve.ManualValidationTaskTypeIdString,!0)&&2===r.status&&c++),2===r.status&&(s++,e=!0),(0,o.equals)(r.typeId,"8C6F20A7-A545-4486-9777-F762FAFE0D4D",!0)&&2===r.status&&i++,(0,o.equals)(r.typeId,Ve.ManualValidationTaskTypeIdString,!0)&&2===r.status&&n++,(0,o.equals)(r.typeId,"E1A1FC6C-C278-4492-AE1C-C42F8697612C",!0)&&2===r.status&&u++;e&&h.push(a)}a(h),m(s),g(t),v(u),r(i),l(n),d(c)}),[e.stages]);if(t[0]){const a=()=>{e.onReviewClicked(t)},r=function(e,t,s,a,i,r,n){let l="";const c=1===e.length&&"__default"!==e[0].name;if(s>0)l=s===t?1===s?1===a?c?(0,o.format)(Pe.ChecksCard_Message_SingleApprovalNeedYourReviewStage,e[0].name):Pe.ChecksCard_Message_SingleApprovalNeedYourReview:1===i?c?(0,o.format)(Pe.ChecksCard_Message_SinglePermissionNeedYourReviewStage,e[0].name):Pe.ChecksCard_Message_SinglePermissionNeedYourReview:1===r?Pe.ChecksCard_Message_SingleManualValidationNeedYourReview:c?(0,o.format)(Pe.ChecksCard_Message_SingleNeedYourReviewStage,e[0].name):Pe.ChecksCard_Message_SingleNeedYourReview:a===t?c?(0,o.format)(Pe.ChecksCard_Message_ApprovalNeedYourReviewStage,s.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_ApprovalNeedYourReview,s.toString()):i===t?c?(0,o.format)(Pe.ChecksCard_Message_PermissionNeedYourReviewStage,t.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_PermissionNeedYourReview,t.toString()):r===t?(0,o.format)(Pe.ChecksCard_Message_ManualValidationNeedYourReview,s.toString()):1===n?s-1==1?c?(0,o.format)(Pe.ChecksCard_Message_CheckWithSingleManualValidationNeedYourReviewStage,e[0].name):(0,o.format)(Pe.ChecksCard_Message_CheckWithSingleManualValidationNeedYourReview):c?(0,o.format)(Pe.ChecksCard_Message_ChecksWithSingleManualValidationNeedYourReviewStage,(s-1).toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_ChecksWithSingleManualValidationNeedYourReview,(s-1).toString()):n>1?s-n==1?c?(0,o.format)(Pe.ChecksCard_Message_CheckWithManualValidationNeedYourReviewStage,n.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_CheckWithManualValidationNeedYourReview,n.toString()):c?(0,o.format)(Pe.ChecksCard_Message_ChecksWithManualValidationNeedYourReviewStage,(s-n).toString(),n.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_ChecksWithManualValidationNeedYourReview,(s-n).toString(),n.toString()):c?(0,o.format)(Pe.ChecksCard_Message_NeedYourReviewStage,s.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_NeedYourReview,s.toString()):a===t?c?(0,o.format)(Pe.ChecksCard_Message_SomeApprovalsNeedYourReviewStage,s.toString(),t.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_SomeApprovalsNeedYourReview,s.toString(),t.toString()):i===t?c?(0,o.format)(Pe.ChecksCard_Message_PermissionNeedYourReviewStage,t.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_PermissionNeedYourReview,t.toString()):r===t?(0,o.format)(Pe.ChecksCard_Message_SomeManualValidationsNeedYourReview,s.toString(),t.toString()):1===n?s-1==1?c?(0,o.format)(Pe.ChecksCard_Message_SomeCheckWithSingleManualValidationNeedYourReviewStage,e[0].name):(0,o.format)(Pe.ChecksCard_Message_SomeCheckWithSingleManualValidationNeedYourReview):c?(0,o.format)(Pe.ChecksCard_Message_SomeChecksWithSingleManualValidationNeedYourReviewStage,(s-1).toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_SomeChecksWithSingleManualValidationNeedYourReview,(s-1).toString()):n>1?s-n==1?c?(0,o.format)(Pe.ChecksCard_Message_SomeCheckWithManualValidationsNeedYourReviewStage,n.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_SomeCheckWithManualValidationsNeedYourReview,n.toString()):c?(0,o.format)(Pe.ChecksCard_Message_SomeChecksWithManualValidationsNeedYourReviewStage,(s-n).toString(),n.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_SomeChecksWithManualValidationsNeedYourReview,(s-n).toString(),n.toString()):c?(0,o.format)(Pe.ChecksCard_Message_SomeNeedYourReviewStage,s.toString(),t.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_SomeNeedYourReview,s.toString(),t.toString());else if(1===t)l=1===a?c?(0,o.format)(Pe.ChecksCard_Message_SingleApprovalNeedReviewStage,e[0].name):Pe.ChecksCard_Message_SingleApprovalNeedReview:1===i?c?(0,o.format)(Pe.ChecksCard_Message_SinglePermissionNeedYourReviewStage,e[0].name):Pe.ChecksCard_Message_SinglePermissionNeedYourReview:1===r?Pe.ChecksCard_Message_SingleManualValidationNeedReview:c?(0,o.format)(Pe.ChecksCard_Message_SingleNeedReviewStage,e[0].name):Pe.ChecksCard_Message_SingleNeedReview;else if(a===t)l=c?(0,o.format)(Pe.ChecksCard_Message_ApprovalNeedReviewStage,t.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_ApprovalNeedReview,t.toString());else if(i===t)l=c?(0,o.format)(Pe.ChecksCard_Message_PermissionNeedYourReviewStage,t.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_PermissionNeedYourReview,t.toString());else if(r===t)l=(0,o.format)(Pe.ChecksCard_Message_ManualValidationsNeedReview,t.toString());else{let s=r-n;l=1===s?t-1==1?c?(0,o.format)(Pe.ChecksCard_Message_CheckWithSingleManualValidationNeedReviewStage,e[0].name):(0,o.format)(Pe.ChecksCard_Message_CheckWithSingleManualValidationNeedReview):c?(0,o.format)(Pe.ChecksCard_Message_ChecksWithSingleManualValidationNeedReviewStage,(t-1).toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_ChecksWithSingleManualValidationNeedReview,(t-1).toString()):r-n>1?t-s==1?c?(0,o.format)(Pe.ChecksCard_Message_CheckWithManualValidationsNeedReviewStage,(r-n).toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_CheckWithManualValidationsNeedReview,(r-n).toString()):c?(0,o.format)(Pe.ChecksCard_Message_ChecksWithManualValidationsNeedReviewStage,(t-r).toString(),(r-n).toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_ChecksWithManualValidationsNeedReview,(t-n).toString(),(r-n).toString()):c?(0,o.format)(Pe.ChecksCard_Message_ChecksNeedReviewStage,t.toString(),e[0].name):(0,o.format)(Pe.ChecksCard_Message_ChecksNeedReview,t.toString())}return l}(t,h,p,i,_,n,c),l=[{onClick:a,primary:!!(p>0),text:p>0?Pe.ChecksCard_Review:Pe.ChecksCard_View}];return s.createElement(u.MessageCard,{buttonProps:l,className:"pipelines-run-checks-message",severity:_>0?"Warning":"Info"},r)}return null}}("ComponentsChecksCard"),function(e){je=t[e]={};class a extends s.Component{constructor(e){super(e),this._hasError=new d.ObservableValue(!1),this._inputs={},this._loading=new d.ObservableValue(!0),this._snippetInputs=new d.ObservableArray,this._taskLink=new d.ObservableArray,this._renderPropertyCell=(e,t,s,a)=>this._renderCommon(e,t,s,a.label),this._renderValueCell=(e,t,s,a)=>{const i=this._inputs[a.name];return this._renderCommon(e,t,s,null!=i?i:a.defaultValue)},this._renderCommon=(e,t,a,i)=>s.createElement(p.TableCell,{key:"item"+e+"-"+t,columnIndex:t,className:"issue-task-table-padding task-value-cell"},s.createElement("div",{className:"flex-grow flex-row"},s.createElement("div",{className:"flex-column flex-grow padding-vertical-8"},s.createElement("span",{className:"primary-text"},i)))),this._renderTaskLink=(e,t,a,i)=>s.createElement(p.TableCell,{key:"task-link"+e,columnIndex:t,className:"issue-task-table-padding"},s.createElement("div",{className:"flex-grow flex-row"},s.createElement("div",{className:"flex-column flex-grow padding-vertical-8"},s.createElement(h.Link,{href:i},s.createElement("span",{className:"flex-row"},s.createElement(n.Icon,{className:"padding-right-8",iconName:"Unknown",size:"medium"}),Pe.AboutTask))))),this._contributionService=this.props.pageContext.getService("IVssContributionService")}componentDidMount(){const e=this.props.taskVersion.split(".")[0];this._inputs=JSON.parse(this.props.inputs),this._getTaskSnippet(this.props.taskType,e).then((e=>{e?(e.documentationUrl&&this._taskLink.push(e.documentationUrl),this._snippetInputs.value=e.inputs,this._hasError.value=!1):this._hasError.value=!0,this._loading.value=!1}))}render(){const e=[{id:Pe.Property,className:"padding-horizontal-20",width:-100,name:Pe.Property,renderCell:this._renderPropertyCell},{id:Pe.Value,className:"padding-horizontal-20",width:-100,name:Pe.Value,renderCell:this._renderValueCell}],t=[{id:Pe.HelfpulLinks,className:"padding-horizontal-20",width:-100,name:Pe.HelfpulLinks,renderCell:this._renderTaskLink}];return s.createElement(m.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"no-h-padding",description:this.props.taskName,escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:(0,o.format)(Pe.TaskName,this.props.taskType)}},s.createElement(c.Observer,{hasError:this._hasError,loading:this._loading},(a=>a.hasError||a.loading?a.loading?s.createElement(s.Fragment,null):s.createElement(u.MessageCard,{severity:"Error",className:"flex-grow "},s.createElement("span",{className:"body-l"},Pe.NoTask)):s.createElement("div",{className:"flex-column"},s.createElement(p.Table,{className:"task-table",columns:e,itemProvider:this._snippetInputs,role:"table",scrollable:!0}),this._taskLink.length>0&&s.createElement(m.PanelFooter,{className:"no-padding help-col-panel-footer"},s.createElement(p.Table,{className:"task-table",columns:t,itemProvider:this._taskLink,role:"table"}))))))}async _getTaskSnippet(e,t){return this._contributionService.getDataAsync("ms.vss-build-web.yaml-assistant-data-provider",{taskName:e,taskVersion:t})}}t[e].TaskControllerView=a}("ComponentsTaskControllerView"),function(e){Fe=t[e]={};class a extends s.Component{constructor(e){super(e),this._onLogsClick=e=>{const t={};t[g.NavConstants.job]=this.props.issue.jobId,this.props.issue.taskId&&(t[g.NavConstants.task]=this.props.issue.taskId),this.props.issue.lineNumber&&(t[g.NavConstants.line]=this.props.issue.lineNumber.toString());const s=this.props.pageContext.getService("IBuildLinkingService").getBuildUrl(this.props.run.id,g.NavConstants.logs,void 0,void 0,t);(0,_.onClickFPS)(this.props.pageContext,s,!0,e)},this._onTaskSelected=(e,t)=>{if(t.data.props.taskVersion&&t.data.props.taskType){this.props.pageContext.getService("IVssLayoutManager").renderCallout((e=>s.createElement(je.TaskControllerView,Object.assign(Object.assign({},t.data.props),{onDismiss:e}))))}},this._renderTaskCell=(e,t,a,i)=>s.createElement(p.TableCell,{key:"table-item"+e,columnIndex:t,className:"issue-task-table-padding cursor-pointer"},s.createElement("div",{className:"flex-grow flex-row"},s.createElement("div",{className:"flex-column flex-grow padding-vertical-8"},s.createElement("span",{className:"primary-text"},i.primaryText)),i.props.inputs&&s.createElement(n.Icon,{iconName:"ChevronRightMed",size:"medium"}))),this._renderTaskHeader=(e,t)=>s.createElement(p.TableHeaderCell,{key:"table-header"+e,column:t,columnIndex:e},s.createElement("div",{className:"text-ellipsis body-s"},s.createElement("span",null,t.name))),this._onDismiss=()=>{this.props.onDismiss()},this._taskItemProvider=new d.ObservableArray([{primaryText:(0,o.format)(Pe.TaskName,this.props.issue.taskType),props:{inputs:this.props.issue.inputs,pageContext:this.props.pageContext,taskName:this.props.issue.taskName,taskType:this.props.issue.taskType,taskVersion:this.props.issue.taskVersion,onDismiss:this.props.onDismiss}}]);const t=this.props.pageContext.getService("ITfsPageService").getData();this._agentUrl=c[this.props.issue.imageName],this._agentUrl||(this._agentUrl=c[r[this.props.issue.imageName]]),this._agentUrl&&(this._isHosted=!0),!this._agentUrl&&t&&t.project&&this.props.issue.queueId&&(this._agentUrl=(0,i.routeUrl)(this.props.pageContext,"ms.vss-build-web.run-pools-route",{project:t.project.id,queueId:this.props.issue.queueId.toString()}))}render(){const e=[{id:Pe.ErrorAnalysis,className:"padding-horizontal-20",renderCell:this._renderTaskCell,width:-100,name:Pe.RunTimeDetails,renderHeaderCell:this._renderTaskHeader}],t=this.props.issue.taskName&&this.props.issue.taskType?(0,o.format)("{0} ({1})",this.props.issue.taskName,this.props.issue.taskType):"",a=this.props.issue.message.replace(/\\n/g,"\n");return s.createElement(m.Panel,{contentClassName:"no-padding",titleProps:{text:Pe.ErrorAnalysis,className:"fontWeightSemiBold"},description:t,onDismiss:this._onDismiss},this.props.issue.taskName&&s.createElement("div",{className:"flex-column"},s.createElement("span",{className:"body-m padding-bottom-16 padding-horizontal-20 word-break"},s.createElement("code",null,a)),s.createElement(p.Table,{columns:e,itemProvider:this._taskItemProvider,role:"table",onSelect:this._onTaskSelected}),s.createElement(m.PanelFooter,null,s.createElement("div",{className:"flex-row"},this._isHosted&&s.createElement(h.Link,{href:this._agentUrl},Pe.AboutHostedImage),s.createElement("div",{className:"bolt-panel-footer-buttons flex-grow bolt-button-group flex-row rhythm-horizontal-8 flex-end"},this._agentUrl&&!this._isHosted&&s.createElement(l.Button,{text:Pe.ViewAgent,primary:!1,href:this._agentUrl}),s.createElement(l.Button,{text:Pe.ViewLog,primary:!0,onClick:this._onLogsClick}))))))}}t[e].IssueAnalysisPanel=a;const r={"macos-1013":"macOS-10.13","macos 1013":"macOS-10.13","macos 10.13":"macOS-10.13",macos:"macOS-10.14","macos 10.14":"macOS-10.14",ubuntu16:"ubuntu-16.04","ubuntu 16.04":"ubuntu-16.04",defaulthosted:"vs2015-win2012r2","vs2015 win2012r2":"vs2015-win2012r2",vs2017:"vs2017-win2016","vs2017 win2016":"vs2017-win2016",wincon:"win1803","windows-2019-vs2019":"windows-2019","windows 2019 vs2019":"windows-2019","windows 2019":"windows-2019",mac_int1013:"appcenter-macos-10.13","appcenter macos 10.13":"appcenter-macos-10.13",mac_int:"appcenter-macos-10.14","appcenter macos 10.14":"appcenter-macos-10.14","xcode9-macos1012":"internal-macos-10.12","xcode9 macos1012":"internal-macos-10.12","internal macos 10.12":"internal-macos-10.12",mac_internal:"internal-macos-10.13","internal macos 10.13":"internal-macos-10.13","internal-macos1014":"internal-macos-10.14","internal macos1014":"internal-macos-10.14","internal macos 10.14":"internal-macos-10.14",ubuntu18:"ubuntu-18.04","ubuntu 18.04":"ubuntu-18.04"},c={"windows-latest":"https://github.com/actions/virtual-environments/blob/master/images/win/Windows2019-Readme.md","windows-2019":"https://github.com/actions/virtual-environments/blob/master/images/win/Windows2019-Readme.md","vs2017-win2016":"https://github.com/actions/virtual-environments/blob/master/images/win/Windows2016-Readme.md","ubuntu-latest":"https://github.com/actions/virtual-environments/blob/master/images/linux/Ubuntu1804-README.md","ubuntu-18.04":"https://github.com/actions/virtual-environments/blob/master/images/linux/Ubuntu1804-README.md","ubuntu-16.04":"https://github.com/actions/virtual-environments/blob/master/images/linux/Ubuntu1604-README.md","macOS-10.14":"https://github.com/microsoft/azure-pipelines-image-generation/blob/master/images/macos/macos-10.14-Readme.md","macOS-latest":"https://github.com/actions/virtual-environments/blob/master/images/macos/macos-10.15-Readme.md","macOS-10.15":"https://github.com/actions/virtual-environments/blob/master/images/macos/macos-10.15-Readme.md"}}("ComponentsIssueAnalysisPanel"),function(e){Oe=t[e]={};class a extends r.VssComponent{constructor(e,t){super(e,t),this._authorizeResources=()=>{this.setState({authorizingResources:!0}),this._pipelineResourcesService.autoAuthorizeResources(this.props.pipelineId,this.props.sourceBranch).then((()=>{this._addToast(Pe.AuthorizeResourcesSuccessMessage),this.setState({resourcesAuthorized:!0})}),(e=>{console.warn("Error while auto-authorizing resources: "+e&&e.message),this._addToast(e.message||Pe.AuthorizeResourcesErrorMessage),this.setState({authorizingResources:!1})}))},this._pipelineResourcesService=this.context.pageContext.getService("IPipelineResourcesService"),this._messageService=this.context.pageContext.getService("IGlobalMessagesService"),this.state={authorizingResources:!1,resourcesAuthorized:!1}}render(){const e=this.props.resourceAuthErrorMessages;if(e){const t=[{text:this.state.resourcesAuthorized?Pe.AuthorizedResourcesButtonText:Pe.AuthorizeResourcesButtonText,onClick:this._authorizeResources,disabled:this.state.authorizingResources||this.state.resourcesAuthorized}],a=(0,o.format)(Pe.IssuesMessage,Pe.ResourceAuthIssue,e);return s.createElement(u.MessageCard,{className:"margin-top-16",severity:"Error",buttonProps:t},s.createElement("span",{dangerouslySetInnerHTML:{__html:a}}))}return null}_addToast(e){this._messageService.addToast({message:e,duration:5e3,forceOverrideExisting:!0})}}t[e].PipelinePermissionsErrorCard=a}("ComponentsPipelinePermissionsErrorCard"),function(e){Ue=t[e]={};var a;!function(e){e.Errors="errors",e.Warnings="warnings"}(a||(a={}));class i extends r.VssComponent{constructor(e,t){super(e,t),this._onObservableChanged=e=>{this.setState(this._createNewState(e))},this._getIssueTableForGroup=(e,t)=>{let a=0,i=0;const r=e.reduce(((e,s)=>{const r=(1===t?this.state.maxVisibleErrors:this.state.maxVisibleWarnings)-a;if(!s||!s.issues||r<=0)return e;const n=this._getGroupName(s),l=s.issues.filter((e=>e.type===t)),c=l.slice(0,r).map((e=>Object.assign(Object.assign({},e),{groupName:n})));if(0===c.length)return e;if(a+=c.length,l.length===c.length){const e=1===t?s.additionalErrorCount:s.additionalWarningCount;e>0&&c.push({stageId:s.stageId,stageName:s.stageName,jobId:s.jobId,jobName:s.jobName,taskId:s.taskId,taskName:s.taskName,type:t,message:(0,o.format)(1==t?Pe.ViewLogForMoreErrors:Pe.ViewLogForMoreWarnings,e),renderRow:this._renderAdditionalIssuesRow}),i+=e}return e.concat(c)}),[]),n=1===t?this.state.run.errorCount:this.state.run.warningCount,l=a+i;l<n&&r.push({isShowMoreRow:!0,type:t,message:(0,o.format)(Pe.ShowAdditionalIssues,n-l,1===t?"errors":"warnings"),renderRow:this._renderAdditionalIssuesRow});const c=new d.ObservableArray(r),u=[{id:"issue-column",width:-100,renderCell:this._renderIssue},{id:"analysis-column",width:new d.ObservableValue(2.625),widthStyle:1,className:"pipelines-cell",renderCell:this._renderAnalysisCell,ariaLabel:Pe.Analysis}];return s.createElement(p.Table,{ariaLabel:Pe.Issues,className:"issue-table-border",columns:u,key:t,itemProvider:c,onActivate:this._onActivateRow,showHeader:!1,selectableText:!0})},this._onTabChanged=e=>{this._selectedTabId.value=e},this._renderAdditionalIssuesRow=(e,t,a)=>s.createElement(p.TableRow,{details:a,index:e,className:"view-more-issues-row",key:"row-"+e},s.createElement(p.SimpleTableCell,{columnIndex:0,tableColumn:void 0},s.createElement("div",{className:"view-more-issues-text"+(t.isShowMoreRow?" center":"")},t.message))),this._renderAnalysisCell=(e,t,a,i)=>(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Build2.ErrorAnalysisPanel",!1)&&i.jobId&&i.taskName&&i.taskType?s.createElement(p.TableCell,{className:"bolt-table-cell-side-action run-analysis-cell",columnIndex:t,tableColumn:a,key:"col-"+t},s.createElement("div",{className:(0,r.css)("flex-column","padding-right-4")},s.createElement("div",{className:"right-align flex-row"},s.createElement(l.Button,{className:"bolt-table-cell-side-action bolt-table-cell-content-reveal",primary:!1,subtle:!0,iconProps:{iconName:"Flashlight"},ariaLabel:Pe.Analysis,onClick:e=>{e.preventDefault(),this._renderIssueAnalysisPanel(i)},excludeTabStop:!0})))):s.createElement("div",null),this._renderIssueAnalysisPanel=e=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>{const a={run:this.state.run,issue:e,pageContext:this.context.pageContext,onDismiss:t};return s.createElement(Fe.IssueAnalysisPanel,Object.assign({},a),null)}))},this._renderIssue=(e,t,a,i)=>{let r=i.message;void 0!==r&&0!==r.length||(r=Pe.NoMessageForIssue);const n=(0,v.getTimelineStatusIndicatorData)(2,1===i.type?2:1),o=s.createElement(R.Tooltip,{overflowOnly:!0,text:r},s.createElement("span",{className:"body-m text-ellipsis"},r)),l=s.createElement(f.Status,Object.assign({},n.statusProps,{size:"16",className:"margin-right-8"}));return s.createElement(p.TwoLineTableCell,{columnIndex:t,iconProps:{render:()=>l},key:"col-"+t+" row-"+e,line1:o,line2:s.createElement("span",{className:"body-s secondary-text text-ellipsis"},i.groupName)})},this._onActivateRow=(e,t)=>{if(t.data&&t.data.jobId){const s={};s[g.NavConstants.job]=t.data.jobId,t.data.taskId&&(s[g.NavConstants.task]=t.data.taskId),t.data.lineNumber&&(s[g.NavConstants.line]=t.data.lineNumber.toString());const a=this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(this.state.run.id,g.NavConstants.logs,void 0,void 0,s);(0,_.onClickFPS)(this.context.pageContext,a,!0,e)}else if(t.data.isShowMoreRow&&t.data)1===t.data.type?this.setState({maxVisibleErrors:this.state.maxVisibleErrors+10}):this.setState({maxVisibleWarnings:this.state.maxVisibleWarnings+10});else{this.context.pageContext.getService("IGlobalMessagesService").addToast({duration:2e3,message:Pe.NoLogsToastMessage})}},this._service=this.context.pageContext.getService("IRunDetailsService"),this._observable=this._service.data;const i=this._service.data.value;this._selectedTabId=new d.ObservableValue(a.Errors),this.state=this._createNewState(i)}render(){return this.state.resourceAuthErrors&&this.state.resourceAuthErrors.length>0?s.createElement("div",null,this._getResourceAuthErrorCard(this.state.resourceAuthErrors)):this.state.issues&&this.state.issues.length>0?s.createElement("div",null,this._getGeneralIssueCard(this.state.issues)):null}componentDidMount(){this._observable.subscribe(this._onObservableChanged)}componentWillUnmount(){this._observable.unsubscribe(this._onObservableChanged)}_createNewState(e){const t={run:e,issues:[],resourceAuthErrors:[],maxVisibleWarnings:10,maxVisibleErrors:10};return(e.issues||[]).forEach((e=>{(e.issues||[]).forEach((e=>{1===e.type&&e.message&&e.message.indexOf("https://aka.ms/yamlauthz")>0&&t.resourceAuthErrors.push(e)})),t.issues.push(e)})),t}_getResourceAuthErrorCard(e){return e&&e.length>0?s.createElement(Oe.PipelinePermissionsErrorCard,{resourceAuthErrorMessages:this._getTopIssue(e).message,pipelineId:this.state.run.pipeline.id,sourceBranch:this.state.run.sourceBranch}):null}_getGeneralIssueCard(e){if(e&&e.length>0){const t=this.state.run.errorCount,i=this.state.run.warningCount;return 0===t?this._selectedTabId.value=a.Warnings:0===i&&(this._selectedTabId.value=a.Errors),s.createElement(C.Card,{className:"margin-top-16 flex-grow bolt-table-card"},s.createElement(S.Surface,{background:0},s.createElement(c.Observer,{selectedTab:this._selectedTabId},(r=>s.createElement(y.TabProvider,{selectedTabId:r.selectedTab,providers:new d.ObservableArray([])},s.createElement("div",{className:"issues-card-content flex-column padding-top-16"},s.createElement(y.TabBar,{className:"padding-bottom-16",onSelectedTabChanged:this._onTabChanged,disableSticky:!0,tabSize:"large-link"},t>0&&s.createElement(y.Tab,{id:a.Errors,key:a.Errors,name:Pe.Errors,badgeCount:t}),i>0&&s.createElement(y.Tab,{id:a.Warnings,key:a.Warnings,name:Pe.Warnings,badgeCount:i})),s.createElement(y.TabContent,null,s.createElement("div",{className:"flex-column"},this._getIssueTableForGroup(e,r.selectedTab===a.Errors?1:2),8===this.state.run.result&&s.createElement("div",{className:"flex-row flex-grow justify-end"},s.createElement(h.Link,{className:"margin-16",href:"https://go.microsoft.com/fwlink/?linkid=2101318",target:"_blank"},Pe.Troubleshoot))))))))))}return null}_getGroupName(e){const t=this.state.run.stages.length>1,s=this.state.run.jobs.length>1;let a=this.state.run.number;return e.taskName?a=s?t?(0,o.format)("{0} • {1} • {2}",e.stageName,e.jobName,e.taskName):(0,o.format)("{0} • {1}",e.jobName,e.taskName):e.taskName:e.jobName&&s?a=t?(0,o.format)("{0} • {1}",e.stageName,e.jobName):e.jobName:e.stageName&&t&&(a=e.stageName),a}_getTopIssue(e){let t=0;for(let s=0;s<e.length;s++){const a=e[s];if(1===a.type&&2===a.jobResult){t=s;break}}return e[t]}}t[e].IssuesCard=i}("ComponentsIssuesCard"),He=t[pt="ComponentsBaseStatus"]={},t[pt].BaseStatus=function(e){return e.onData&&e.onData(!!e.text),e.text?s.createElement(a.FPSLink,{className:"body-m font-size",subtle:!0,onClick:e.onClick,href:e.href},s.createElement("span",{className:"flex-row"},!e.warningStatus&&s.createElement(n.Icon,{iconName:e.iconName,className:"icon-margin"}),s.createElement("span",{className:(0,k.css)((e.warningStatus||e.rejectedChecks)&&"rejected-check-base-status")},e.text))):null},function(e){ze=t[e]={},t[e].CheckStatus=function(e){const t=function(e,t){if(e.some((e=>(0,o.equals)(e.typeId,Ve.AuthorizationCheckTypeIdString,!0)&&4!==e.status)))return Pe.PermissionNeeded;const s=e.length===e.filter((e=>(0,o.equals)(e.typeId,Ve.ManualValidationTaskTypeIdString,!0))).length;if(0==e.length||s)return null;const a=e.filter((e=>!(0,o.equals)(e.typeId,Ve.ManualValidationTaskTypeIdString,!0))).length,i=e.filter((e=>4===e.status&&!(0,o.equals)(e.typeId,Ve.ManualValidationTaskTypeIdString,!0))).length;if(1===a&&1===i)return Pe.OneCheckPassed;if(t>0)return(0,o.format)(Pe.ChecksFailedInfo,t===a?a:t+"/"+a);return(0,o.format)(Pe.ChecksStatusInfo,i===a?a:i+"/"+a)}(e.checks,e.rejectedChecks),a=t===Pe.PermissionNeeded;return s.createElement(He.BaseStatus,{text:t,rejectedChecks:e.rejectedChecks>0,onClick:e.onClick,iconName:"WaitlistConfirm",onData:e.onData,warningStatus:a})},t[e].ManualValidationStatus=function(e){const t=function(e,t){if(0==e.length)return null;const s=e.filter((e=>(0,o.equals)(e.typeId,Ve.ManualValidationTaskTypeIdString,!0))).length;if(0===s)return null;const a=e.filter((e=>(0,o.equals)(e.typeId,Ve.ManualValidationTaskTypeIdString,!0)&&4===e.status)).length;if(1===s&&1===a)return Pe.OneManualValidationPassed;if(t>0)return(0,o.format)(Pe.ManualValidationsFailedInfo,t===s?s:t+"/"+s);return(0,o.format)(Pe.ManualValidationsStatusInfo,a===s?s:a+"/"+s)}(e.checks,e.rejectedManualValidations);return s.createElement(He.BaseStatus,{text:t,rejectedChecks:e.rejectedManualValidations>0,onClick:e.onClick,iconName:"WaitlistConfirm",onData:e.onData})}}("ComponentsCheckStatus"),function(e){We=t.ComponentsJobsTable={};class a extends r.VssComponent{constructor(e,t){super(e,t),this._onObservableChanged=e=>{this.setState({run:e})},this._renderNameCell=(e,t,a,i)=>{const r=(0,v.getTimelineStatusIndicatorData)(i.state,i.result,i.stateData?i.stateData.pendingChecks:void 0,i.stateData?!i.stateData.pendingDependencies:void 0);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontWeightSemiBold fontSizeM scroll-hidden"},s.createElement(R.Tooltip,{text:r.label},s.createElement("span",{className:"flex-row"},s.createElement(f.Status,Object.assign({},r.statusProps,{className:"icon-large-margin",size:"16"})))),s.createElement("div",{className:"flex-row scroll-hidden"},s.createElement(R.Tooltip,{overflowOnly:!0,text:i.name},s.createElement("span",{className:"text-ellipsis"},i.name))))},this._renderNameMobileCell=(e,t,a,i)=>{const r=(0,o.format)(Pe.JobsNameMobileFormat,i.stageName,i.name);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontWeightSemiBold fontSizeM scroll-hidden"},s.createElement("div",{className:"flex-row scroll-hidden"},s.createElement(R.Tooltip,{overflowOnly:!0,text:r},s.createElement("span",{className:"text-ellipsis"},r))))},this._renderStatusCell=(e,t,a,i)=>{const r=(0,v.getTimelineStatusIndicatorData)(i.state,i.result,i.stateData?i.stateData.pendingChecks:void 0,i.stateData?!i.stateData.pendingDependencies:void 0);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},s.createElement(R.Tooltip,{overflowOnly:!0,text:r.label},s.createElement("span",{className:"text-ellipsis"},r.label)))},this._renderStatusIconCell=(e,t,a,i)=>{const r=(0,v.getTimelineStatusIndicatorData)(i.state,i.result,i.stateData?i.stateData.pendingChecks:void 0,i.stateData?!i.stateData.pendingDependencies:void 0);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t},s.createElement(R.Tooltip,{text:r.label},s.createElement("span",{className:"flex-row"},s.createElement(f.Status,Object.assign({},r.statusProps,{className:"icon-large-margin",size:"16"})))))},this._renderStageCell=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},s.createElement(R.Tooltip,{overflowOnly:!0,text:i.stageName},s.createElement("span",{className:"text-ellipsis"},i.stageName))),this._renderDurationCell=(e,t,a,i)=>{if(!i.startTime){let e=Pe.JobHasNotStarted;return 2===i.state&&(e=Pe.JobDidNotRun),s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden secondary-text",ariaLabel:e})}return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden secondary-text"},s.createElement(n.Icon,{iconName:"Clock",className:"icon-margin fontSizeML jobs-table-icon"}),s.createElement(w.Duration,{startDate:i.startTime,endDate:i.finishTime}))},this._onJobClick=(e,t)=>{t.data&&(0,_.onClickFPS)(this.context.pageContext,t.data.linkProps.href,!0,e)},this._nameColumn={id:"name",width:new d.ObservableValue(-67),name:Pe.JobColumnName,className:"jobs-cell",renderCell:this._renderNameCell,columnStyle:2,onSize:this._onSize},this._nameMobileColumn={id:"name-mobile",width:new d.ObservableValue(-67),name:Pe.JobColumnName,className:"jobs-cell",renderCell:this._renderNameMobileCell,onSize:this._onSize},this._statusColumn={id:"status",width:new d.ObservableValue(132),name:Pe.StatusColumnName,className:"jobs-cell",renderCell:this._renderStatusCell},this._statusIconColumn={id:"status-icon",width:new d.ObservableValue(30),className:"jobs-cell",renderCell:this._renderStatusIconCell},this._durationColumn={id:"duration",width:new d.ObservableValue(-33),name:Pe.DurationColumnName,className:"jobs-cell",renderCell:this._renderDurationCell},this._stageColumn={id:"stage",width:new d.ObservableValue(132),name:Pe.StageColumnName,className:"jobs-cell",renderCell:this._renderStageCell},this._service=this.context.pageContext.getService("IRunDetailsService"),this._observable=this._service.data;let a=[this._nameColumn,this._statusColumn],i=[];this._service.data.value.stages.length>1?(a.push(this._statusIconColumn),a.push(this._nameMobileColumn),a.push(this._stageColumn),a.push(this._durationColumn),i=[{breakpoint:1,columnWidths:[0,0,30,-100,0,100]},{breakpoint:600,columnWidths:[-67,132,0,0,132,-33]}]):(a.push(this._durationColumn),i=[{breakpoint:1,columnWidths:[-100,0,120]},{breakpoint:600,columnWidths:[-67,132,-33]}]),this.state={run:this._service.data.value,columns:a,breakpoints:i,showApprovalStatus:1==this._service.data.value.stages.length}}render(){let e=new d.ObservableArray(this.state.run.jobs);const t=this.state.run.stages[0];let a=0;t.checks&&(a=t.checks.filter((e=>8===e.status&&!(0,o.equals)(Ve.ManualValidationTaskTypeIdString,e.typeId,!0))).length);let i=0;return t.checks&&(i=t.checks.filter((e=>(0,o.equals)(Ve.ManualValidationTaskTypeIdString,e.typeId,!0)&&8===e.status)).length),s.createElement("div",null,this.state.showApprovalStatus&&s.createElement("div",{className:"flex-row margin-left-16 margin-top-4"},s.createElement(ze.CheckStatus,{checks:t.checks||[],rejectedChecks:a,onClick:e=>{this.props.onReviewStageClicked(t)}}),s.createElement(ze.ManualValidationStatus,{checks:t.checks||[],rejectedManualValidations:i,onClick:e=>{this.props.onReviewManualValidationClicked(t)}})),s.createElement(p.Table,{ariaLabel:Pe.JobsTitle,itemProvider:e,tableBreakpoints:this.state.breakpoints,columns:this.state.columns,onActivate:this._onJobClick}))}componentDidMount(){this._observable.subscribe(this._onObservableChanged)}componentWillUnmount(){this._observable.unsubscribe(this._onObservableChanged)}_onSize(e,t,s,a){a.width.value=s}}t.ComponentsJobsTable.JobsTable=a}(),function(e){Je=t[e]={};function a(e,t){const s=e.filter((e=>-1!==t.indexOf(e))).length;return 1==s?(0,o.format)(Pe.ArtifactCount,s):s>1?(0,o.format)(Pe.ArtifactsCount,s):""}t[e].ArtifactStatus=e=>{const t=(0,r.useComponentContext)(),[i,n]=s.useState([]),{trackPromise:o}=(0,I.usePromise)(),l=t.pageContext.getService("IVssContributionService"),c=t.pageContext.getService("IBuildLinkingService");return s.useEffect((()=>{const t=e.rundata,s={};s[g.NavConstants.buildId]=t.buildId+"",o(l.getDataAsync("ms.vss-build-web.run-details-artifacts-data-provider",s,!0)).then((e=>{e&&n(e.sources)}))}),[e.rundata]),s.createElement(He.BaseStatus,{text:a(i,e.rundata.jobIds),href:c.getBuildUrl(e.rundata.buildId,g.NavConstants.artifacts,void 0,void 0,{pathAsName:"false"}),iconName:"Package",onData:e.onData})}}("ComponentsArtifactStatus"),function(e){Ge=t[e]={};class s{}t[e].Constants=s,s.verticalDisplacement=30,s.svgRightMargin=20,s.svgBottomMargin=20,s.negativeNodeRank=-1,s.graphLeftMargin=80,s.edgeQuadraticBezierScaleDownFactor=2.5}("ComponentsCanvasTypes"),function(e){qe=t[e]={};t[e].PathBuilder=class{constructor(){this._pathBuilder=""}start(e){return this._pathBuilder+=" "+(0,o.format)("M{0},{1}",e.x,e.y),this}line(e){return this._pathBuilder+=" "+(0,o.format)("L{0},{1}",e.x,e.y),this}quadraticBezier(e,t){return this._pathBuilder+=" "+(0,o.format)("Q {0} {1}, {2} {3}",t.x,t.y,e.x,e.y),this}arc(e,t,s,a,i){return this._pathBuilder+=" "+(0,o.format)("A {0} {1} {2} {3} {4} {5} {6}",t,s,0,a,i,e.x,e.y),this}toString(){return this._pathBuilder}}}("ComponentsCanvasPathHelpers"),function(e){Ye=t[e]={};class a extends r.VssComponent{render(){let{from:e,to:t}=this.props,a="",i=this.props.intermediate1,r=this.props.intermediate2;if(e.x>t.x&&console.error("Edge can only be drawn from left to right."),void 0!==i&&void 0!==r){let s=(new qe.PathBuilder).start(e);this._addEdgeSegment(s,e,i),this._addEdgeSegment(s,i,r),this._addEdgeSegment(s,r,t),a=s.toString()}else{let s=(new qe.PathBuilder).start(e);this._addEdgeSegment(s,e,t),a=s.toString()}return s.createElement("path",{className:(0,k.css)("dtc-canvas-path",this.props.cssClass),d:a})}_addEdgeSegment(e,t,s){t.y===s.y||t.x===s.x?e.line(s):t.y>s.y?this._addUpwardCurve(e,t,s):this._addDownwardCurve(e,t,s)}_addUpwardCurve(e,t,s){let a=s.x-t.x,i=t.x+Math.min(a/2,a);e.quadraticBezier({x:i,y:t.y-this._getQuadraticBezierVerticalDisplacement()},{x:i,y:t.y}).line({x:i,y:s.y+this._getQuadraticBezierVerticalDisplacement()}).quadraticBezier({x:s.x,y:s.y},{x:i,y:s.y})}_addDownwardCurve(e,t,s){let a=s.x-t.x,i=t.x+Math.max(a/2,0);e.quadraticBezier({x:i,y:t.y+this._getQuadraticBezierVerticalDisplacement()},{x:i,y:t.y}).line({x:i,y:s.y-this._getQuadraticBezierVerticalDisplacement()}).quadraticBezier({x:s.x,y:s.y},{x:i,y:s.y})}_getQuadraticBezierVerticalDisplacement(){return this.props.quadraticBezierVerticalDisplacement?this.props.quadraticBezierVerticalDisplacement:Ge.Constants.verticalDisplacement}}t[e].Edge=a}("ComponentsCanvasEdge"),function(e){function s(e,t){if(e=t instanceof Array?e||[]:e||{},t)for(var a in t)t.hasOwnProperty(a)&&t[a]&&("object"==typeof t[a]?e[a]=s(e[a],t[a]):e[a]=t[a]);return e}Qe=t[e]={};class a{static validateNodesAndEdges(e,t){let s=this._createNodeKeyToNodeMap(e),a="";for(let e in t)if(t.hasOwnProperty(e)){if(!s[e]&&(a=e,a))break;for(let i in t[e])if(t[e].hasOwnProperty(i)&&!s[i]&&(a=i,a))break}if(a)throw new Error((0,o.format)("Graph does not have node corresponding to edge end {0}. Please ensure that node and edge inputs to graph is proper",a))}static createStagingOrderAndDependencies(e,t){let s=this._createAndInitializeNodesForLayout(e),a=this._createNodeKeyToNodeMap(s),i=this._extractDependencies(s,t,a),{stagingOrder:r,layoutError:n}=this._getStagingOrder(s,i,a);return{stagingOrder:r,dependencies:i,layoutError:n}}static splitGraph(e,t){let s=this._createNodeKeyToNodeMap(e),a=this._extractDependencies(e,t,s),i=this.getDisjointTreeFromEdges(a),r=this._createNodeToGraphIndexMap(i),n=[],o=!1;for(const e of i){const t=this._getMinRankNodeKeyInFirstStage(e,a,s);if(!t){o=!0;break}n.push(t)}if(o)return[{nodes:e,edges:t}];{this._sortNodes(n,s);let e=[];for(const a of n){const n=r[a];e.push(this._createGraph(i[n],s,t))}return e}}static getDependencies(e,t){const s=this._createNodeKeyToNodeMap(e);return this._extractDependencies(e,t,s)}static getIncomingEdgeLayouts(e,t){let s=0,i=[];const r={x:0,y:e.nodeHeight/2},n=a.resolveGraphLeftMargin(e.leftMargin?e.leftMargin:0);for(const e of t){const t=e.getPositionOfIncomingNodes();for(const e of t){const t={x:e.x+n,y:e.y+s};i.push({from:r,to:t,fromDepth:0,key:t.y.toString()})}s+=e.getGraphSize().height}return i}static _getMinRankNodeKeyInFirstStage(e,t,s){let a=1/0,i="";return e.forEach((e=>{if(!t[e]||0===t[e].length){const t=s[e],r=t.nodeRankHint?t.nodeRankHint:0;r<a&&(a=r,i=t.key)}})),i}static _createGraph(e,t,s){return{nodes:e.map((e=>t[e])),edges:this._filterEdges(e,s)}}static _sortNodes(e,t){e.sort(((e,s)=>{const a=t[e],i=t[s];return(a.nodeRankHint?a.nodeRankHint:0)-(i.nodeRankHint?i.nodeRankHint:0)}))}static _createNodeToGraphIndexMap(e){let t={};return e.forEach(((e,s)=>{e.forEach((e=>t[e]=s))})),t}static _filterEdges(e,t){let s={},a={};e.forEach((e=>a[e]=!0));for(let e in t)if(t.hasOwnProperty(e))for(let i in t[e])t[e].hasOwnProperty(i)&&(a[e]||""===e)&&a[i]&&(s[e]||(s[e]={}),s[e][i]=!0);return s}static isFromNodeNotParentButAncestorOfToNode(e,t,s,a){let i=[],r=s[t];return r&&r.length>0&&r.forEach((t=>{t!==e&&(i=i.concat(this._getAncestors(t,s,a)))})),i.filter((t=>t===e)).length>0}static getNodeDataForLayout(e,t,s,a){let i=this._getMaxRowsInStagingOrder(e),r=[],n=0;for(let o=0;o<i;o++){const i=e.length;let l=0;for(let c=0;c<i;c++){let i=e[c][o];i&&((!i.nodeHeightHint||i.nodeHeightHint<0)&&(i.nodeHeightHint=t.nodeHeight),i.topLeftPosition={x:c*(t.nodeWidth+t.horizontalMargin)+s,y:o*t.verticalMargin+n},i.midPoints=this._getNodeMidPoints(i.topLeftPosition,t.nodeHeight,t.nodeWidth),r.push(i),a.x=Math.max(a.x,i.topLeftPosition.x+t.nodeWidth),a.y=Math.max(a.y,i.topLeftPosition.y+i.nodeHeightHint),i.nodeHeightHint>l&&(l=i.nodeHeightHint))}l||(l=t.nodeHeight),n+=l}return r}static _getMaxRowsInStagingOrder(e){let t=0;for(const s of e)s.length>t&&(t=s.length);return t}static getEdgeDataForLayout(e,t,i,r,n,o={}){const l=e.length;let c=[],u={},d=s({},i);for(let t=0;t<l-1;t++){let s=e[t],a=e[t+1],i=0;s.forEach((e=>{u[e.key]=e,a.forEach((t=>{if(u[t.key]=t,d[e.key]&&d[e.key][t.key]){const s={from:e.midPoints.right,to:t.midPoints.left,key:e.key+"."+t.key,fromDepth:i};c.push(s),d[e.key][t.key]=!1}})),i++}))}c.push();const h=e[0];return h&&h.forEach((e=>u[e.key]=e)),this._populateCrossStageEdges(c,d,u,t,r,o,n),a.resolveGraphLeftMargin(r.leftMargin)&&this._populateInputEdgesOfGraph(c,d,u,r),c}static getDisjointTreeFromEdges(e){const t=this._getAdjacencyList(e);let s={},a=[];if(t)for(const e in t)if(t.hasOwnProperty(e)&&!s[e]){const i=this._breadthFirstTraversal(e,t,s);a.push(i)}return a}static resolveGraphLeftMargin(e){return null==e?Ge.Constants.graphLeftMargin:e}static _getAdjacencyList(e){let t=s({},e),a={};if(t)for(const e in t)if(t.hasOwnProperty(e)){const s=t[e];s&&(a[e]?s.forEach((t=>{a[e].push(t)})):a[e]=s,s.forEach((t=>{a[t]?a[t].push(e):a[t]=[e]})))}return a}static _breadthFirstTraversal(e,t,s){let a=[],i=[];for(i.push(e),s[e]=!0;i.length>0;){e=i.shift(),a.push(e);t[e].forEach((e=>{s[e]||(i.push(e),s[e]=!0)}))}return a}static _populateCrossStageEdges(e,t,s,i,r,n,o){let l;for(let o in t)if(o&&t.hasOwnProperty(o)){let c=t[o];for(let u in c)if(c.hasOwnProperty(u)&&c[u]){if(!a.isFromNodeNotParentButAncestorOfToNode(o,u,i,n)&&s[o]&&s[u]){l||(l=this._getDisplacementOffsetMap(s));let t=s[o].midPoints.right,a=s[u].midPoints.left,i=0;const n=this._getMaxHeightOfNodesInPath(t,a,r.nodeHeight,s);n>0&&(i=r.verticalMargin/2+(n-r.nodeHeight/2)+l[o].y);let c={x:Math.max(t.x+r.horizontalMargin-l[o].x,t.x),y:t.y+i};let d={x:Math.min(a.x-r.horizontalMargin+l[o].x,a.x),y:c.y};e.push(this._getCrossStageEdge(o+"."+u,t,c,d,a))}t[o][u]=!1}}}static _populateInputEdgesOfGraph(e,t,s,a){let i=t[""];if(i){let t=a.nodeHeight/2;for(let a in i)if(i.hasOwnProperty(a)){const i=s[a],r={x:0,y:t},n={x:i.midPoints.left.x,y:i.midPoints.left.y};e.push({from:r,to:n,key:"entry."+a,fromDepth:0})}}}static _getMaxHeightOfNodesInPath(e,t,s,a){let i=this._getNodeListFromNodeKeyToNodeNameMap(a).filter((s=>function(t){return t.midPoints.left.y===e.y}(s)&&function(t){return t.midPoints.left.x>e.x}(s)&&function(e){return e.midPoints.left.x<t.x}(s)));if(i&&i.length>0){let e=0;for(let t=0;t<i.length;t++){const s=i[t].nodeHeightHint;void 0!==s&&s>e&&(e=s)}return 0==e?s:e}return 0}static _getDisplacementOffsetMap(e){let t=this._getNodeListFromNodeKeyToNodeNameMap(e);t.sort(((e,t)=>(e.topLeftPosition?e.topLeftPosition.x:0)-(t.topLeftPosition?t.topLeftPosition.x:0)));let s={},a=0,i=-1;return t.forEach((e=>{const t=e.topLeftPosition?e.topLeftPosition.x:0;t!==i&&(i=t),s[e.key]||(s[e.key]={x:0,y:0}),s[e.key].y=a})),a=0,i=-1,t.sort(((e,t)=>(e.topLeftPosition?e.topLeftPosition.y:0)-(t.topLeftPosition?t.topLeftPosition.y:0))),t.forEach((e=>{const t=e.topLeftPosition?e.topLeftPosition.y:0;t!==i&&(i=t),s[e.key].x=a})),s}static _getNodeListFromNodeKeyToNodeNameMap(e){let t=[];for(let s in e)e.hasOwnProperty(s)&&t.push(e[s]);return t}static _getCrossStageEdge(e,...t){return{from:t[0],intermediate1:t[1],intermediate2:t[2],to:t[3],key:e,fromDepth:0}}static _getNodeMidPoints(e,t,s){let a={};return a.left={x:e.x,y:e.y+t/2},a.right={x:e.x+s,y:e.y+t/2},a}static _getAncestors(e,t,s){let a=[],i=t[e];return s[e]?s[e]:(i&&i.length>0&&i.forEach((e=>{a=a.concat(e,this._getAncestors(e,t,s)),a=(0,T.uniqueSort)(a)})),s[e]=a,a)}static _getStagingOrder(e,t,s){let a=[],i={},r=0;for(;e.forEach((e=>{if(!i[e.key]){this._areAllDependenciesStaged(e.key,t,i)&&(a[r]||(a[r]=[]),a[r].push(e))}})),a[r];)if(a[r].forEach((e=>{i[e.key]=!0})),r++,r>this.c_maxIterationCount)throw new Error((0,o.format)("Could not layout graph in {0} iterations. There is a bug in the layout logic",this.c_maxIterationCount));let n=this._getNodesThatAreNotStaged(e,i),l="";return n&&n.length>0&&(l=this._getCyclicDependencyError(n),a[0]||(a[0]=[]),n.forEach((e=>{a[0].push(e)}))),this._sortNodesInStages(a),{stagingOrder:a,layoutError:l}}static _getNodesThatAreNotStaged(e,t){return e.filter((e=>!t[e.key]))}static _getCyclicDependencyError(e){if(e.length>0){e.map((e=>e.friendlyName||e.key));return""}return""}static _sortNodesInStages(e){for(let t=e.length-1;t>=0;t--)e[t].sort(((e,t)=>e.nodeRank-t.nodeRank))}static _areAllDependenciesStaged(e,t,s){let a=!0;return t[e]&&t[e].forEach((e=>{s[e]||(a=!1)})),a}static _createAndInitializeNodesForLayout(e){return e.map((e=>{let t=s({},e);return void 0!==e.nodeRankHint?t.nodeRank=e.nodeRankHint:t.nodeRank=0,t}))}static _createNodeKeyToNodeMap(e){let t={};return e.forEach((e=>{t[e.key]=e})),t}static _extractDependencies(e,t,s){let a={};return e.forEach((s=>{a[s.key]||(a[s.key]=[]),e.forEach((e=>{t[s.key]&&t[s.key][e.key]&&(a[e.key]||(a[e.key]=[]),a[e.key].push(s.key))}))})),a}}t[e].GraphLayoutHelper=a,a.c_maxIterationCount=1e4}("ComponentsCanvasGraphLayoutHelper"),function(e){Ke=t[e]={};class a extends r.VssComponent{constructor(e){super(e),this._disjointGraphs=[],this._graphComponents=[],this.state={incomingEdges:[],incomingEdgesEvaluated:!1}}componentWillMount(){this._disjointGraphs=Qe.GraphLayoutHelper.splitGraph(this.props.nodes,this.props.edges),this._graphComponents=[]}componentWillReceiveProps(e){this._disjointGraphs=Qe.GraphLayoutHelper.splitGraph(e.nodes,e.edges),this.setState({incomingEdgesEvaluated:!1}),this._graphComponents=[]}getGraphComponents(){return this._graphComponents}render(){let e=[];this._disjointGraphs.forEach(((t,a)=>{e.push(s.createElement(i,Object.assign({ref:e=>e&&this._graphComponents.push(e),key:t.nodes[0].key},this.props,{nodes:t.nodes,edges:t.edges,leftMargin:0})))}));const t=this._getGraphLeftMargin(),a=this._getHeight();return s.createElement("div",{className:"dtc-graph-list-parent"},t&&t>0?s.createElement("div",{className:"dtc-incoming-edge-container",style:{width:t,height:a},"aria-hidden":"true"},s.createElement("svg",{className:"dtc-incoming-edge-canvas"},this.state.incomingEdges)):null,s.createElement("div",{className:"dtc-disjoint-graph-container"},e))}componentDidMount(){this._evaluateAndSetIncomingEdges()}componentDidUpdate(){this._evaluateAndSetIncomingEdges()}_evaluateAndSetIncomingEdges(){if(!this.state.incomingEdgesEvaluated){const e=Qe.GraphLayoutHelper.getIncomingEdgeLayouts(this.props,this._graphComponents).map((e=>s.createElement(Ye.Edge,{from:e.from,to:e.to,fromDepth:e.fromDepth,quadraticBezierVerticalDisplacement:this._getQuadraticBezierVerticalDisplacement(),key:e.key})));this.setState({incomingEdgesEvaluated:!0,incomingEdges:e})}}_getQuadraticBezierVerticalDisplacement(){return this.props.nodeHeight/Ge.Constants.edgeQuadraticBezierScaleDownFactor}_getGraphLeftMargin(){return Qe.GraphLayoutHelper.resolveGraphLeftMargin(this.props.leftMargin)}_getHeight(){let e=0;if(this._graphComponents)for(let t of this._graphComponents)e+=t.getGraphSize().height;return e}}t[e].GraphList=a;class i extends r.VssComponent{constructor(){super(...arguments),this._nodesComparer=(e,t)=>e.key===t.key&&e.nodeRankHint===t.nodeRankHint&&e.nodeHeightHint===t.nodeHeightHint&&e.friendlyName===t.friendlyName,this._identifiedAncestors={},this._incomingNodeRelativePositions=[]}componentWillMount(){this._validateNodesAndEdges(this.props.nodes,this.props.edges),this._stagingOrderAndDependencies=Qe.GraphLayoutHelper.createStagingOrderAndDependencies(this.props.nodes,this.props.edges)}componentWillReceiveProps(e){this._validateNodesAndEdges(e.nodes,e.edges),this._stagingOrderAndDependencies=Qe.GraphLayoutHelper.createStagingOrderAndDependencies(e.nodes,e.edges),this._identifiedAncestors={}}getStagingOrder(){return this._stagingOrderAndDependencies?this._stagingOrderAndDependencies.stagingOrder:[]}getGraphSize(){return{height:this._svgHeight,width:this._svgWidth}}getPositionOfIncomingNodes(){return this._incomingNodeRelativePositions}render(){const e=this._stagingOrderAndDependencies,t=e.stagingOrder;let a=e.dependencies,i=e.layoutError,r={x:0,y:0},n=this._getNodeElements(t,r),o=[];i||(o=this._getEdgeElements(t,a));const l=this._getGraphLeftMargin();return this._svgWidth=r.x+this.props.horizontalMargin+l,this._svgHeight=r.y+this.props.verticalMargin,i?this._incomingNodeRelativePositions=[]:this._populateIncomingNodeIndices(t[0]),s.createElement("div",{className:"dtc-canvas-container"},i&&s.createElement("div",null,i),s.createElement("div",{className:"dtc-graph-container"},s.createElement("svg",{className:"svg-surface",height:this._svgHeight+"px",width:this._svgWidth+"px",focusable:"false","aria-hidden":"true"},o),n))}_populateIncomingNodeIndices(e){const t=this.props.edges[""];this._incomingNodeRelativePositions=[],t&&e.forEach(((e,s)=>{t[e.key]&&this._incomingNodeRelativePositions.push({x:e.midPoints.left.x,y:e.midPoints.left.y})}))}_validateNodesAndEdges(e,t){Qe.GraphLayoutHelper.validateNodesAndEdges(e,t)}_getNodeElements(e,t){const s=this._getGraphLeftMargin();return Qe.GraphLayoutHelper.getNodeDataForLayout(e,this.props,s,t).map((e=>this._getNodeElement(e,e.nodeHeightHint||this.props.nodeHeight,this.props.nodeWidth)))}_getEdgeElements(e,t){return Qe.GraphLayoutHelper.getEdgeDataForLayout(e,t,this.props.edges,this.props,this.props.selectedNodeKey,this._identifiedAncestors).map((e=>s.createElement(Ye.Edge,{from:e.from,intermediate1:e.intermediate1,intermediate2:e.intermediate2,to:e.to,key:e.key,fromDepth:e.fromDepth,quadraticBezierVerticalDisplacement:this._getQuadraticBezierVerticalDisplacement()})))}_getNodeElement(e,t,a){const i={position:"absolute",height:t,width:a,top:e.topLeftPosition?e.topLeftPosition.y:0,left:e.topLeftPosition?e.topLeftPosition.x:0};return s.createElement("div",{className:"div-node",style:i,key:e.key},e.getNodeElement&&e.getNodeElement(e.key,e.data))}_getGraphLeftMargin(){return Qe.GraphLayoutHelper.resolveGraphLeftMargin(this.props.leftMargin)}_getQuadraticBezierVerticalDisplacement(){return this.props.nodeHeight/Ge.Constants.edgeQuadraticBezierScaleDownFactor}}t[e].Graph=i,i.s_telemetryKeyTracker={}}("ComponentsCanvasGraph"),function(e){t.RunExternalService={};class s{constructor(e,t){this.testsCount=e,this.testsPassRate=t}}t.RunExternalService.TestResults=s;class a extends x.VssService{_serviceStart(e){super._serviceStart(e);const t=(0,N.getTFSPageData)(e);this._projectId=t&&t.project&&t.project.id||"",this._projectName=t&&t.project?t.project.name:""}getTestTabLink(e){return this.pageContext.getService("IBuildLinkingService").getBuildUrl(e,Ve.NavTestTabId)}async getTestResultsForRun(e,t){await this._loadTcm();const s=(0,D.getTestResultsClient)(this.pageContext),a=await s.getTestPipelineMetrics(this._projectId,e,void 0,void 0,void 0,[2]);if(a){const e=this._getTestResults(a);return 2!==t&&(e.testsCount=-1),e}}async getTestsResultsForJob(e,t){await this._loadTcm();const s=(0,D.getTestResultsClient)(this.pageContext),a=await s.getTestPipelineMetrics(this._projectId,e,t.stageName,t.phaseName,t.jobName,[2]);if(a)return this._getTestResults(a)}async getTestsResultsForStage(e,t){await this._loadTcm();const s=(0,D.getTestResultsClient)(this.pageContext),a=await s.getTestPipelineMetrics(this._projectId,e,t,void 0,void 0,[2]);if(a)return this._getTestResults(a)}_getTestResults(e){let t=-1,a=-1;if(e&&e.resultSummary&&e.resultSummary){let s=E.TestSummaryReportUtils.getPassedTestStatisticsInPipeline(e.resultSummary);s&&s.totalTestCount>0?(t=s.passTestRate,a=s.totalTestCount,Number.isNaN(t)&&(t=0)):s&&0===s.totalTestCount&&s.totalNotReportedTestCount>0&&(t=-2)}return new s(a,t)}async getCodeCoverageSummary(e){await this._loadTcm();const t=(0,D.getTestResultsClient)(this.pageContext),s=await t.getCodeCoverageSummary(this._projectName,e,-10);let a=new Array;if(s&&s.coverageData&&s.coverageData.length>0){s.coverageData.forEach((e=>{const t=e.coverageStats.filter((e=>e.label&&(!o.localeIgnoreCaseComparer(e.label,"Lines")||!o.localeIgnoreCaseComparer(e.label,"Line"))));let s,i=0;t.length&&(i=t[0].covered||0,s=t[0].total||t[0].covered),a.push(s?i/s*100:0)}));return{coverage:(a.reduce(((e,t)=>e+t),0)/a.length).toFixed(2)}}}async _loadTcm(){const e=this.pageContext.getService("IVssContributionService");await e.getContributionAsync("ms.vss-build-web.tcm-service-location")}}t.RunExternalService.RunExternalService=a,x.Services.add("IRunExternalService",{serviceFactory:a})}(),function(e){$e=t[e]={};t[e].TestStatus=e=>{const t=(0,r.useComponentContext)(),[a,i]=s.useState(""),{trackPromise:n}=(0,I.usePromise)(),l=t.pageContext.getService("IRunExternalService");return s.useEffect((()=>{const t=e.stageData;n(l.getTestsResultsForStage(t.buildId,t.stage).then((e=>{e&&e.testsCount>0&&i((0,o.format)(Pe.TestResultPassedFormat,(0,o.format)(Pe.TestResultTestsFormat,P.TestReportDataParser.getCustomizedDecimalValueInCurrentLocale(e.testsPassRate,1))))})))}),[e.stageData]),s.createElement(He.BaseStatus,{text:a,href:l.getTestTabLink(e.stageData.buildId),iconName:"TestBeaker",onData:e.onData})}}("ComponentsTestStatus"),function(e){Xe=t[e]={};const i=e=>s.createElement("span",{className:"primary-message"},s.createElement("span",{className:"message"},e.text));class n extends r.VssComponent{constructor(e,t){super(e,t),this._cancelledStages=[],this._retriedStages=[],this._stageMetadata={},this._canRetry=(e,t)=>{const s=new Map;let a=e=>{for(const i of t)if(i.dependsOn&&-1!=i.dependsOn.indexOf(e.id)){if(s.has(i.id))return s.get(i.id);if(1===i.state||a(i))return s.set(i.id,!0),!0}return s.set(e.id,!1),!1};return 2===e.state&&!a(e)},this._onArtifactsData=(e,t)=>{let s=!1;const a=this._stageMetadata[t];a?a.hasArtifacts!==e&&(a.hasArtifacts=e,s=!0):(this._stageMetadata[t]={hasArtifacts:e,hasChecks:!1,hasTests:!1},s=!0),s&&this.forceUpdate()},this._onChecksData=(e,t)=>{let s=!1;const a=this._stageMetadata[t];a?a.hasChecks!==e&&(a.hasChecks=e,s=!0):(this._stageMetadata[t]={hasArtifacts:!1,hasChecks:e,hasTests:!1},s=!0),s&&this.forceUpdate()},this._onTestsData=(e,t)=>{let s=!1;const a=this._stageMetadata[t];a?a.hasTests!==e&&(a.hasTests=e,s=!0):(this._stageMetadata[t]={hasArtifacts:!1,hasChecks:!1,hasTests:e},s=!0),s&&this.forceUpdate()},this._cancelStage=(e,t)=>{e.preventDefault();const s=(0,o.format)(Pe.ConfirmCancelStage,t);this._confirmAction(Pe.CancelStage,s,(()=>{this._cancelledStages.push(t),this.setState({cancelledStages:this._cancelledStages}),this._service.cancelStage(t)}))},this._retryStage=(e,t,s=h.None)=>{e.preventDefault();const a=(0,o.format)(s==h.FailedJobs?Pe.ConfirmRetryStageFailedJobs:Pe.ConfirmRetryStage,t);this._confirmAction(Pe.RetryStage,a,(()=>{this._retriedStages.push(t),this.setState({retriedStages:this._retriedStages}),this._service.retryStage(t,s==h.AllJobs)}))},this._onObservableChanged=e=>{this._cancelledStages=this._cancelledStages.filter((t=>e.stages.find((e=>e.refName===t&&2===e.state)))),this._retriedStages=this._retriedStages.filter((t=>e.stages.find((e=>e.refName===t&&2!==e.state)))),this.setState({run:e})},this._showStageDetails=e=>{const t=this._minimized.indexOf(e);t>=0&&this._minimized.splice(t,1),this._expanded.push(e),this.setState({expanded:this._expanded.slice(),minimized:this._minimized.slice()})},this._hideStageDetails=e=>{const t=this._expanded.indexOf(e);t>=0&&this._expanded.splice(t,1),this._minimized.push(e),this.setState({expanded:this._expanded.slice(),minimized:this._minimized.slice()})},this._confirmAction=(e,t,a)=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((i=>{const r={title:e,message:t,onClose:i,onConfirm:a};return s.createElement(M.CommandComponent,Object.assign({commandType:"ciDConfirmPipelineComponent"},r),null)}))},this._service=this.context.pageContext.getService("IRunDetailsService"),this._observable=this._service.data,this._expanded=[],this._minimized=[],this.state={run:this._service.data.value,expanded:this._expanded,minimized:this._minimized,cancelledStages:this._cancelledStages,retriedStages:this._retriedStages}}render(){const e=this.state.run.stages,t=this.state.run.jobs,a=[],r={},n=this.context.pageContext.getService("IBuildLinkingService");return e.forEach((m=>{const p=[];let v=0;const b=[];t.forEach((e=>{if(e.stageId===m.id){2===e.state&&v++,p.push(e.id);const t={};t[g.NavConstants.stage]=m.id,t[g.NavConstants.job]=e.id;const a=n.getBuildUrl(this.state.run.id,g.NavConstants.logs,void 0,void 0,t);b.push(s.createElement(c,{job:e,jobUrl:a,key:e.id,status:m.stateData}))}}));const C=this._getStageCardStatus(this.state.run.id,m.refName,m.state,m.result,p,v,m.stateData,m.checks,this.state.cancelledStages,(e=>{e&&(e.stopPropagation(),e.preventDefault()),this.props.onReviewStageClicked(m)}),(e=>{e&&(e.stopPropagation(),e.preventDefault()),this.props.onReviewManualValidationClicked(m)})),S=p.length,y=C.message;let I=C.expanded;const T=C.status;this.state.expanded.indexOf(m.id)>=0&&S>0?I=!0:(this.state.minimized.indexOf(m.id)>=0||0==S)&&(I=!1);const x={};x[g.NavConstants.stage]=m.id;const N=n.getBuildUrl(this.state.run.id,g.NavConstants.logs,void 0,void 0,x),D=this._getMetadataCount(m.refName);let E,P=72+28*D;if(1===m.state){const e=this._cancelledStages.indexOf(m.refName)>=0;E=[{text:Pe.Cancel,disabled:e,onClick:e=>{this._cancelStage(e,m.refName)},className:"update-stage"}]}else if(this._canRetry(m,e)){const e=this._retriedStages.indexOf(m.refName)>=0;0!==m.result&&1!==m.result||!I?2===m.result||3===m.result?E=[{text:Pe.RetryFromFailed,disabled:e,onClick:e=>{this._retryStage(e,m.refName,h.FailedJobs)},className:"update-stage"},{text:Pe.RetryAll,disabled:e,onClick:e=>{this._retryStage(e,m.refName,h.AllJobs)},className:"update-stage-secondary"}]:4===m.result&&this._showRetryStageButton(m.checks)&&(E=[{text:Pe.RetryStage,disabled:e,onClick:e=>{this._retryStage(e,m.refName)},className:"update-stage"}]):E=[{text:Pe.RetrySucceeded,disabled:e,onClick:e=>{this._retryStage(e,m.refName)},className:"update-stage"}]}void 0!==E&&(P+=58*E.length),a.push({data:m,key:m.id,nodeHeightHint:I?P+4+32*b.length+8:P,getNodeElement:()=>{let e=m.name;void 0!==e&&0!==e.length||(e=Pe.UnnamedStage);const t=s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row stage-title-row flex-center"},s.createElement(R.Tooltip,{text:T.label},s.createElement("span",{className:"flex-row"},s.createElement(f.Status,Object.assign({},T.statusProps,{className:"stage-icon-margin",size:"16"})))),s.createElement("div",{className:"flex-row scroll-hidden flex-grow body-m stage-title"},s.createElement(R.Tooltip,{overflowOnly:!0,text:e},s.createElement("span",{className:"text-ellipsis"},e))),s.createElement("div",{className:"flex-self-end fontWeightNormal fontSize stageExpandButton"},S>0&&s.createElement(l.Button,{subtle:!0,id:m.id+"expand",iconProps:{iconName:"ChevronUnfold10"},ariaLabel:I?Pe.CollapseStage:Pe.ExpandStage,onClick:e=>{e&&e.preventDefault(),I?this._hideStageDetails(m.id):this._showStageDetails(m.id)}}),S<=0&&s.createElement("div",{className:"stageExpandButtonPlaceholder"}))),s.createElement("div",{className:"flex-row secondary-text body-s stage-progress-row"},s.createElement("div",{className:"flex-grow"},y.type===d.Plain&&s.createElement("span",null,y.text),y.type===d.Primary&&s.createElement(i,{text:y.text}),y.type===d.Error&&s.createElement("span",{className:"error-text"},y.text)),m.startTime&&s.createElement(w.Duration,{startDate:m.startTime,endDate:m.finishTime})),s.createElement("div",{className:(0,k.css)("flex-row body-s stage-info-row",0===D&&"hidden")},s.createElement("div",{className:"flex-grow"},C.metadata))),a=s.createElement(s.Fragment,null,b);let r=(0,o.format)(Pe.StageDescription,e,T.label,y.text);return m.startTime&&(r=(0,o.format)(Pe.StageDescriptionWithStartTime,e,T.label,y.text,V.tooltipString(m.startTime))),s.createElement(u,{id:m.id,ariaLabel:r,key:m.id+"zone",primaryContent:t,secondaryContent:I?a:void 0,onActivate:e=>{(0,_.onClickFPS)(this.context.pageContext,N,!0,e)},footerButtonProps:E})}}),m.dependsOn&&m.dependsOn.forEach((e=>{r[e]||(r[e]={}),r[e][m.id]=!0}))})),s.createElement("div",{className:"stage-graph"},s.createElement(Ke.GraphList,{nodes:a,edges:r,horizontalMargin:32,verticalMargin:32,nodeWidth:224,nodeHeight:72,leftMargin:32}))}componentDidMount(){this._observable.subscribe(this._onObservableChanged)}componentWillUnmount(){this._observable.unsubscribe(this._onObservableChanged)}_getMetadataCount(e){const t=this._stageMetadata[e]||{};return(t.hasTests?1:0)+(t.hasArtifacts?1:0)+(t.hasChecks?1:0)}_getStageCardStatus(e,t,a,i,r,n,l,c,u,h,p){const g=r.length,_={text:"",type:d.Plain};let b=!1;const C=s.createElement($e.TestStatus,{stageData:{buildId:e,stage:t},onData:e=>this._onTestsData(e,t)}),f=s.createElement(Je.ArtifactStatus,{rundata:{buildId:e,jobIds:r},onData:e=>this._onArtifactsData(e,t)});let S=null;if(u.length>0&&u.indexOf(t)>=0&&2!==a)_.text=Pe.Cancelling,b=!0;else{const e=(c=c||[]).filter((e=>(0,o.equals)(Ve.ManualValidationTaskTypeIdString,e.typeId,!0))).length,r=c.filter((e=>8===e.status&&!(0,o.equals)(Ve.ManualValidationTaskTypeIdString,e.typeId,!0))).length,u=c.filter((e=>(0,o.equals)(Ve.ManualValidationTaskTypeIdString,e.typeId,!0)&&8===e.status)).length;if(c.length>0&&(S=s.createElement("div",null,c.length-e>0&&s.createElement(ze.CheckStatus,{checks:c,rejectedChecks:r,onClick:h,onData:e=>this._onChecksData(e,t)}),e>0&&s.createElement(ze.ManualValidationStatus,{checks:c,rejectedManualValidations:u,onClick:p,onData:e=>this._onChecksData(e,t)}))),0===a)_.text=Pe.NotStarted,(null==l?void 0:l.pendingChecks)&&(_.type=d.Primary,_.text=Pe.WaitingForApproval);else if(1===a)_.text=(0,o.format)(Pe.StageInProgress,n,g),b=!0;else if(2===a)switch(_.text=1===n?Pe.SingleJobCompleted:(0,o.format)(Pe.MultipleJobsCompleted,n),i){case 2:b=!0,_.text=r>0?"":Pe.Failed;break;case 1:b=!0;break;case 4:_.text=Pe.Skipped;break;case 3:_.text=Pe.Canceled}}return{message:_,expanded:b,status:(0,v.getTimelineStatusIndicatorData)(a,i,null==l?void 0:l.pendingChecks,!(null==l?void 0:l.pendingDependencies)),metadata:s.createElement(m,null,C,f,S)}}_showRetryStageButton(e){return(e=e||[]).filter((e=>32===e.status&&(0,o.equals)(Ve.ApprovalCheckTypeId,e.typeId,!0))).length>0}}function c(e){const t=(0,v.getTimelineStatusIndicatorData)(e.job.state,e.job.result,e.status.pendingChecks,!e.status.pendingDependencies);return s.createElement(a.FPSLink,{className:"job-row can-activate-item flex-row fontSize",key:e.job.id,href:e.jobUrl},s.createElement(R.Tooltip,{text:t.label},s.createElement("span",{className:"flex-row"},s.createElement(f.Status,Object.assign({},t.statusProps,{className:"icon-large-margin",size:"16"})))),s.createElement("div",{className:"flex-row scroll-hidden flex-grow"},s.createElement(R.Tooltip,{overflowOnly:!0,text:e.job.name},s.createElement("span",{className:"text-ellipsis"},e.job.name))),e.job.startTime&&s.createElement(w.Duration,{className:"secondary-text",startDate:e.job.startTime,endDate:e.job.finishTime}))}function u(e){const t=t=>{t&&!t.defaultPrevented&&e.onActivate(t)},a=t=>{t&&!t.defaultPrevented&&13===t.which&&e.onActivate(t)};return s.createElement(L.FocusZone,{key:e.id,direction:2,focusGroupProps:{defaultElementId:e.id}},s.createElement("div",null,s.createElement(A.FocusGroupContext.Consumer,null,(i=>s.createElement(L.FocusZoneContext.Consumer,null,(r=>s.createElement("div",{className:"stage-card flex-column cursor-pointer",role:"link","aria-label":e.ariaLabel,"data-focuszone":r.focuszoneId,tabIndex:i.focusedElementId===e.id?0:-1,id:e.id,onFocus:()=>i.onFocus(e.id),onClick:t,onKeyPress:a},s.createElement("div",{className:"stage-card-primary"},e.primaryContent),e.secondaryContent&&s.createElement("div",{className:"stage-card-secondary"},e.secondaryContent),e.footerButtonProps&&s.createElement("div",{className:"stage-card-footer"},e.footerButtonProps.map(((t,a)=>s.createElement(l.Button,Object.assign({key:"stage-card-cancel-button-"+e.id+"-"+a},t))))))))))))}var d,h;function m(e){return s.createElement("div",{className:"flex-column"},e.children)}t[e].StageGraph=n,function(e){e[e.Plain=0]="Plain",e[e.Primary=1]="Primary",e[e.Error=2]="Error"}(d||(d={})),function(e){e[e.None=0]="None",e[e.FailedJobs=1]="FailedJobs",e[e.AllJobs=2]="AllJobs"}(h||(h={}))}("ComponentsStageGraph"),function(e){var a;Ze=t.ComponentsJobsCard={},function(e){e.Jobs="jobs",e.Stages="stages"}(a||(a={}));class i extends r.VssComponent{constructor(e,t){super(e,t),this._tabExplicitlyChanged=!1,this._onTabChanged=e=>{this._tabExplicitlyChanged=!0,this._selectedTabId.value=e};const s=this.context.pageContext.getService("IRunDetailsService");this._run=s.data.value,this._selectedTabId=new d.ObservableValue(a.Stages)}render(){const e=this._run;return 0===e.stages.length&&0===e.jobs.length?null:1===e.stages.length?s.createElement(C.Card,{className:"flex-grow bolt-table-card margin-top-16",contentProps:{contentPadding:!1},titleProps:{text:Pe.JobsTitle,size:0}},s.createElement(We.JobsTable,{onReviewStageClicked:this.props.onReviewStageClicked,onReviewManualValidationClicked:this.props.onReviewManualValidationClicked})):s.createElement(C.Card,{className:"flex-grow bolt-table-card margin-top-16",contentProps:{contentPadding:!1}},s.createElement(S.Surface,{background:0},s.createElement(c.Observer,{selectedTab:this._selectedTabId},(e=>s.createElement(B.ScreenSizeObserver,null,(t=>{const i=this._tabExplicitlyChanged?e.selectedTab:0===t.screenSize?a.Jobs:a.Stages;return s.createElement("div",{className:(0,k.css)("jobs-card-page flex-column",i===a.Stages?"h-scroll-auto":"h-scroll-hidden")},s.createElement(y.TabProvider,{selectedTabId:i,providers:new d.ObservableArray([])},s.createElement(y.TabBar,{onSelectedTabChanged:this._onTabChanged,disableSticky:!0,tabSize:"large-link"},s.createElement(y.Tab,{id:a.Stages,key:a.Stages,name:Pe.StagesTitle}),s.createElement(y.Tab,{id:a.Jobs,key:a.Jobs,name:Pe.JobsTitle})),s.createElement("div",{className:"jobs-card-content margin-top-16"},s.createElement(y.TabContent,null,i===a.Jobs&&s.createElement(We.JobsTable,{onReviewStageClicked:this.props.onReviewStageClicked,onReviewManualValidationClicked:this.props.onReviewManualValidationClicked}),i===a.Stages&&s.createElement(Xe.StageGraph,{onReviewStageClicked:this.props.onReviewStageClicked,onReviewManualValidationClicked:this.props.onReviewManualValidationClicked})))))}))))))}}t.ComponentsJobsCard.JobsCard=i}(),et=t.ComponentsNoData={},t.ComponentsNoData.NoData=function(){return s.createElement(j.Page,{className:"run-no-data"},s.createElement(u.MessageCard,{severity:"Error"},Pe.NoBuildData))},function(e){tt=t[e]={};class i extends r.VssComponent{constructor(e,t){super(e,t),this.getLinkUrl=()=>this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(this.props.run.id,g.NavConstants.artifacts,void 0,void 0,{pathAsName:"false"}),this.renderLink=e=>{if(e&&(e.publishedArtifactsCount>0||e.consumedArtifactsCount>0)){const t=this.getLinkUrl();let i="";i=e.publishedArtifactsCount>0&&e.consumedArtifactsCount>0?(0,o.localeFormat)(Pe.ArtifactsFormat,e.publishedArtifactsCount,e.consumedArtifactsCount):e.publishedArtifactsCount>0?(0,o.localeFormat)(Pe.ArtifactsPublishedFormat,e.publishedArtifactsCount):(0,o.localeFormat)(Pe.ArtifactsConsumedFormat,e.consumedArtifactsCount);const r="flex-row flex-baseline primary-text";return s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,className:r,href:t,subtle:!0,telemetrySource:"RunSummary",telemetryProperties:{clickedOn:"RunViewArtifacts"}},s.createElement(n.Icon,{iconName:"Package",className:"pipelines-icon-right-margin"}),s.createElement("span",{style:{whiteSpace:"nowrap"}}," ",i," "))}return s.createElement("span",{className:"text-ellipsis secondary-text summary-line-non-link"},s.createElement(n.Icon,{iconName:"Package",className:"pipelines-icon-right-margin"}),(0,o.localeFormat)(Pe.ArtifactsCount,"0"))}}render(){return s.createElement(c.Observer,{artifacts:this.props.artifactsData},(e=>this.renderLink(e.artifacts)))}}t[e].ArtifactsLink=i}("ComponentsArtifactsLink"),function(e){st=t[e]={};class i extends s.PureComponent{constructor(e,t){super(e,t),this._renderRow=(e,t,a)=>{const i=this.props.changeLinks[e];return s.createElement(F.ListItem,{key:"list-item"+e,index:e,details:a},this._getChangeElement(t,i?i.commitLink:""))},this._getPrimaryElement=(e,t)=>s.createElement(l,{change:e,repositoryName:this.props.repositoryName,sourceProvider:this.props.sourceProvider,textToDisplay:e.message||e.id,ariaDescribedBy:"build-commit-desc",changeLink:t}),this._itemProvider=new O.ArrayItemProvider(this.props.changes)}render(){return s.createElement(m.Panel,{className:"changes-panel",description:(0,o.format)(Pe.CommitsFormat,this._itemProvider.length),escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:Pe.AssociatedChanges}},s.createElement(F.ScrollableList,{itemProvider:this._itemProvider,outerClassName:"custom-scrollbar flex-column",renderRow:this._renderRow,width:"100%"}))}_getChangeElement(e,t){const a=e.author;let i="",l="";a&&(i=(0,U.getAvatarUrl)(a),l=a.id,l||(l=a.uniqueName)),!i&&a&&(i=(0,H.getIdentityImageUrl)(this.context.pageContext,a));const c=e.id;let u="BranchCommit";this.props.sourceProvider&&(u=this.props.sourceProvider.getCommitIconName());const d=a?a.displayName:"";return s.createElement("div",{className:"changes-row flex-center flex-row"},s.createElement(r,{id:l,imageUrl:i,displayName:d,getPrimaryElement:this._getPrimaryElement,data:e,changeLink:t},s.createElement("span",{id:"build-commit-desc"},s.createElement("span",null,(0,o.format)(Pe.AuthoredFormat,d)," ",s.createElement(n.Icon,{iconName:u})," ",c," "),e.timestamp&&s.createElement(W.Ago,{date:e.timestamp,format:0}))))}}t[e].ChangesPanel=i;class r extends s.PureComponent{render(){const e=this.props.sizeClassName?this.props.sizeClassName:"medium";let t=this.props.imageUrl;return!t&&this.props.id&&(t=(0,H.getIdentityImageUrl)(this.context.pageContext,this.props.id)),s.createElement("div",{className:"flex-grow flex-row rhythm-horizontal-8"},s.createElement(z.BuildPersona,{size:e,displayName:this.props.displayName,imageUrl:t}),s.createElement("div",{className:"flex-column justify-center margin-left-4"},s.createElement("span",{className:"primary-row primary-text"},s.createElement("div",{className:"message"},this.props.getPrimaryElement(this.props.data,this.props.changeLink)),s.createElement("span",null)),s.createElement("span",{className:"font-size padding-left-4 secondary-text"},this.props.children)))}}class l extends s.PureComponent{constructor(e){super(e)}render(){const e=this.props.textToDisplay;return this.props.change.location?s.createElement(a.FPSLink,{ariaDescribedBy:this.props.ariaDescribedBy,className:"bolt-table-link bolt-table-inline-link",href:this.props.changeLink,telemetrySource:"build-changes-panel"},e):s.createElement("span",null,e)}}}("ComponentsChangesPanel"),function(e){at=t[e]={};class i extends r.VssComponent{constructor(e,t){super(e,t),this._updateChanges=e=>{const t=256===this.props.reason;let s=0;e.changes&&(s=e.changes.length,s>1&&!t&&!e.previousSourceVersion&&!this._isTfvc&&(s-=1)),this.setState({changes:e.changes,changeDisplayCount:s}),e.changes&&this._sourceProvider&&(t?this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((e=>this.trackPromise(this._sourceProvider.fetchPRCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,branchName:this.props.branch,repositoryUrl:"",links:{}},e||void 0)).promise)).then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)})):1===s?this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((t=>{this._isTfvc?this.fetchTfvcChangesetLinks(t):this.trackPromise(this._sourceProvider.fetchCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,commitId:e.changes[0].id,displayUri:""},t||void 0)).promise.then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)}))})):s>1&&this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((t=>{if(this._isTfvc)this.fetchTfvcChangesetLinks(t);else{const s=e.changes[e.changes.length-1],a=e.changes[0];this.trackPromise(this._sourceProvider.fetchCommitDiffLink({repositoryName:this.props.repositoryName||this.props.repositoryId,baseCommitId:e.previousSourceVersion||s.id,targetCommitId:a.id,displayUri:""},t||void 0)).promise.then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)}))}})))},this._onActivateChangesPanel=()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>{const t={changes:this.state.changes,changeLinks:this.state.changeLinks,onDismiss:e,repositoryName:this.props.repositoryName,repositoryType:this.props.sourceType,sourceProvider:this._sourceProvider};return s.createElement(st.ChangesPanel,t)}))},this.state={changes:this.props.associatedChangesData.value.changes,changeLinks:[],diffLink:"",changeDisplayCount:0};const a=this.context.pageContext.getService("ISourceProviderService");this._sourceProvider=a.getSourceProvider(e.sourceType||""),this._changeIconName=this._sourceProvider?this._sourceProvider.getCommitIconName():"",this._isTfvc=this._sourceProvider.getKey()===J.RepositoryTypes.TfsVersionControl}render(){const e=this.state.changeDisplayCount;if(e){const t=1==e?Pe.OneChange:(0,o.format)(Pe.ChangesFormat,e),a="text-ellipsis flex-row flex-baseline ";if(this._isTfvc)return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:a,onClick:this._onActivateChangesPanel},t);if(this.state.diffLink){const t=1==e?Pe.ViewChange:(0,o.format)(Pe.ViewChanges,e);return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:a,href:this.state.diffLink},t)}return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:a,disabled:!0,subtle:!0},t)}return null}componentDidMount(){super.componentDidMount(),this.props.associatedChangesData.subscribe(this._updateChanges),this._updateChanges(this.props.associatedChangesData.value)}componentWillUnmount(){super.componentWillUnmount(),this.props.associatedChangesData.unsubscribe(this._updateChanges)}async fetchTfvcChangesetLinks(e){this._sourceProvider.fetchLinks(this.state.changes.map((t=>({branchName:this.props.branch,repositoryName:this.props.repositoryName||this.props.repositoryId,repositoryUrl:this.props.repositoryUrl,commitId:t.id,displayUri:t.displayUri||"",projectName:e||void 0})))).then((e=>{e&&this.setState({changeLinks:e})}))}}t[e].ChangesLink=i;class n extends r.VssComponent{constructor(e,t){super(e,t),this._updateChanges=e=>{const t=256===this.props.reason;let s=0;e.changes&&(s=e.changes.length,s>1&&!t&&!e.previousSourceVersion&&(s-=1)),this.setState({changes:e.changes,changeDisplayCount:s}),e.changes&&this._sourceProvider&&(t?this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((e=>this.trackPromise(this._sourceProvider.fetchPRCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,branchName:this.props.branch,repositoryUrl:"",links:{}},e||void 0)).promise)).then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)})):1===s?this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((t=>this.trackPromise(this._sourceProvider.fetchCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,commitId:e.changes[0].id,displayUri:""},t||void 0)).promise)).then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)})):s>1&&this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((t=>{const s=e.changes[e.changes.length-1],a=e.changes[0];this.trackPromise(this._sourceProvider.fetchCommitDiffLink({repositoryName:this.props.repositoryName||this.props.repositoryId,baseCommitId:e.previousSourceVersion||s.id,targetCommitId:a.id,displayUri:""},t||void 0)).promise.then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)}))})))},this.state={changes:this.props.associatedChangesData.value.changes,changeLinks:[],diffLink:"",changeDisplayCount:0};const s=this.context.pageContext.getService("ISourceProviderService");this._sourceProvider=s.getSourceProvider(e.sourceType||"")}render(){const e=this.state.changeDisplayCount;if(e){const t=1==e?Pe.SourceCardCommitLabel:(0,o.format)(Pe.SourceCardCommitsLabel,e),i="text-ellipsis flex-row flex-baseline ";return s.createElement(a.FPSLink,{className:i,href:this.state.diffLink,subtle:!0},s.createElement("span",{className:"text-ellipsis "},t))}return s.createElement(G.Spinner,{size:"xsmall"})}componentDidMount(){super.componentDidMount(),this.props.associatedChangesData.subscribe(this._updateChanges),this._updateChanges(this.props.associatedChangesData.value)}componentWillUnmount(){super.componentWillUnmount(),this.props.associatedChangesData.unsubscribe(this._updateChanges)}}t[e].SubtleChangesLink=n}("ComponentsChangesLink"),function(e){it=t[e]={};class i extends r.VssComponent{constructor(e,t){super(e,t);const s=this.context.pageContext.getService("IRunDetailsService");this._coverageResult=s.codeCoverageResults,this._testsRunResult=s.testRunResults}render(){return s.createElement(c.Observer,{coverageResult:this._coverageResult,testResults:this._testsRunResult},(e=>{if(e.testResults.testsCount<1)return s.createElement("span",{className:"empty-summary-row"}," ");if(e.coverageResult&&e.coverageResult.coverage){let t=(0,o.format)(Pe.CoverageFormat,e.coverageResult.coverage),i=this.props.coverageTabUrl,r=s.createElement(n.Icon,{iconName:"StackedBarChart",className:"icon-margin"}),l="text-ellipsis flex-row flex-baseline",c=!0;return s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,href:i,className:l,subtle:c},s.createElement("span",{className:"text-ellipsis"},r,t))}return s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,href:"https://docs.microsoft.com/en-us/azure/devops/pipelines/test/review-code-coverage-results?view=azure-devops",className:"text-ellipsis flex-row flex-baseline pipeline-link"},s.createElement("span",{className:"text-ellipsis"},Pe.SetupCoverage))}))}}t[e].CoverageResultsLink=i}("ComponentsCoverageResultsLink"),function(e){rt=t[e]={};const i="https://go.microsoft.com/fwlink/?linkid=2086578";class l extends r.VssComponent{constructor(e,t){super(e,t);const s=this.context.pageContext.getService("IRunDetailsService");this._testsRunResult=s.testRunResults}render(){return s.createElement(c.Observer,{testsResult:this._testsRunResult},(e=>{if(e.testsResult.testsCount>-1){let t=(0,o.format)(Pe.TestResultsFormat,P.TestReportDataParser.getCustomizedDecimalValueInCurrentLocale(e.testsResult.testsPassRate,1)),r=this.props.testsTabUrl,l=s.createElement(n.Icon,{iconName:"Completed",className:"icon-margin"}),c=!0,u="text-ellipsis flex-row flex-baseline";return 0===e.testsResult.testsCount&&(-2===e.testsResult.testsPassRate?t=Pe.EmptyTestTabText:(t=Pe.GetStarted,r=i,l=s.createElement(n.Icon,{iconName:"TestBeaker",className:"icon-margin"}),c=!1,u+=" pipeline-link")),s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,href:r,className:u,subtle:c},s.createElement("span",{className:"text-ellipsis"},l,t))}return s.createElement(a.FPSLink,{ariaDescribedBy:"Get started with tests",href:i,className:"text-ellipsis flex-row flex-baseline pipeline-link"},s.createElement("span",{className:"text-ellipsis"},s.createElement(n.Icon,{iconName:"TestBeaker",className:"icon-margin"}),Pe.GetStarted))}))}}t[e].TestResultsLink=l}("ComponentsTestResultsLink"),function(e){nt=t[e]={};class i extends r.VssComponent{constructor(e,t){super(e,t),this._projectId="",this._createWiql=e=>{let t="";return(e||[]).forEach((e=>{""!==t&&(t+="or "),t+="System.Id = "+e.id+" "})),"SELECT System.Id, System.WorkItemType, System.Title, System.State, System.AssignedTo, System.CreatedDate, Microsoft.VSTS.Common.Priority, System.AreaPath FROM WorkItems where "+t};const s=t.pageContext.getService("ITfsPageService").getData();s&&s.project&&(this._projectId=s.project.id),this._linkService=t.pageContext.getService("IBuildLinkingService")}render(){const e=this.props.sourceType.toLocaleLowerCase(),t=e===J.RepositoryTypes.TfsGit.toLocaleLowerCase()||e===J.RepositoryTypes.TfsVersionControl.toLocaleLowerCase();return s.createElement(c.Observer,{associatedChanges:this.props.associatedChangesData},(e=>{const i=e.associatedChanges.workItems,r=t?this._linkService.getWorkItemQueryUrl(this._createWiql(i),this._projectId):"";if(i&&i.length>0){const e=(0,o.format)(Pe.WorkItemsFormat,i.length.toString());let l="text-ellipsis flex-row flex-baseline";return t?s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,href:r,className:l,subtle:!0},s.createElement("span",{className:"text-ellipsis"},!1!==this.props.showIcon&&s.createElement(n.Icon,{iconName:"WorkItem",className:"pipelines-icon-right-margin"}),e)):(l+=" pipelines-icon-left-margin",s.createElement("div",{className:l},s.createElement("span",{className:"text-ellipsis"},!1!==this.props.showIcon&&s.createElement(n.Icon,{iconName:"WorkItem",className:"pipelines-icon-right-margin"}),e)))}return s.createElement("span",{className:"text-ellipsis secondary-text summary-line-non-link"},!1!==this.props.showIcon&&s.createElement(n.Icon,{iconName:"WorkItem",className:"pipelines-icon-right-margin"}),!1!==this.props.showIcon&&(0,o.format)(Pe.WorkItemsFormat,"0"),!1===this.props.showIcon&&s.createElement("span",{className:"secondary-text"},Pe.None))}))}}t[e].WorkItemsLink=i}("ComponentsWorkItemsLink"),function(e){ot=t[e]={};class a extends r.VssComponent{constructor(e,t){super(e,t),this._renderRepositoryColumn=(e,t,a,i)=>{const r=i.name,o=i.type;return s.createElement(p.TwoLineTableCell,{className:"sources-card-table-cell",key:"col-"+t,columnIndex:t,tableColumn:a,line1:s.createElement("span",{className:"flex-row scroll-hidden sourcecard-repositorylink"},s.createElement(R.Tooltip,{text:r,overflowOnly:!0},s.createElement(Q.RepoLink,{sourceRepositoryId:i.id,sourceRepositoryName:i.name,sourceRepositoryType:i.type,sourceRepositoryUrl:i.url,includeIcon:!1}))),line2:s.createElement(R.Tooltip,{text:o,overflowOnly:!0},s.createElement("span",{className:"fontSize secondary-text sources-card-repotype flex-row flex-center text-ellipsis"},s.createElement("span",{className:"text-ellipsis",key:"release-type-text"},n(o))))})},this._renderBranchColumn=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"sources-card-table-cell fontSizeM scroll-hidden"},s.createElement(q.BranchLink,{excludeTabStop:!1,repositoryType:i.type,repositoryName:i.name,repositoryId:i.id,repositoryUrl:i.connectionId,branch:i.refName,monospace:!1})),this._renderVersionColumn=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"sources-card-table-cell fontSizeM scroll-hidden"},s.createElement(Y.CommitLink,{excludeTabStop:!1,repositoryName:i.name,repositoryId:i.id,repositoryType:i.type,commitId:i.version,monospace:!1,showIcon:!1})),this._renderRelatedColumn=(e,t,a,r)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM size-m scroll-hidden"},s.createElement(i,{repository:r,associatedChanges:this._runDetailsService.associatedChanges})),this._runDetailsService=t.pageContext.getService("IRunDetailsService"),this._columns=[{className:"pipelines-sourcecard-repositorycolumn",id:"repository",name:Pe.SourceCardRepositoryColumnTitle,renderCell:this._renderRepositoryColumn,width:-30},{className:"pipelines-sourcecard-versioncolumn",id:"Version",name:Pe.SourceCardBranchColumnTitle,renderCell:this._renderBranchColumn,width:-30},{className:"pipelines-sourcecard-changescolumn",id:"Changes",name:Pe.SourceCardVersionColumnTitle,renderCell:this._renderVersionColumn,width:-20},{className:"pipelines-sourcecard-relatedcolumn",id:"Version",name:Pe.SourceCardRelatedColumnTitle,renderCell:this._renderRelatedColumn,width:-20}]}render(){return s.createElement(c.Observer,{runData:this._runDetailsService.data},(e=>e.runData.repositoryResources&&e.runData.repositoryResources.length>1?s.createElement("div",{id:"SourceCard"},s.createElement(C.Card,{titleProps:{text:Pe.SourceCardTitle},className:"sources-card flex-grow bolt-table-card margin-top-16",contentProps:{contentPadding:!1}},s.createElement(p.Table,{ariaLabel:Pe.SourceCardTitle,itemProvider:new O.ArrayItemProvider(o(e.runData,this.context)),columns:this._columns}))):null))}}t[e].SourcesCard=a;class i extends s.PureComponent{render(){return"self"===this.props.repository.alias?s.createElement(nt.WorkItemsLink,{associatedChangesData:this.props.associatedChanges,sourceType:this.props.repository.type,showIcon:!1}):null}}function n(e){switch(e.toLowerCase()){case J.RepositoryTypes.TfsGit:return K.TfsGit;case J.RepositoryTypes.Bitbucket:return K.Bitbucket;case J.RepositoryTypes.ExternalGit:return K.ExternalGit;case J.RepositoryTypes.ExternalUnknown:return K.ExternalUnknown;case J.RepositoryTypes.GitHub:return K.GitHub;case J.RepositoryTypes.GitHubEnterprise:return K.GitHubEnterprise;case J.RepositoryTypes.Svn:return K.Svn;case J.RepositoryTypes.TfsVersionControl:return K.TfsVersionControl;default:return e}}function o(e,t){const s={};for(const a of e.repositoryResources||[]){const i=`${a.type}##${a.name}##${a.refName}##${a.version}`;if(!s[i]||"self"===a.alias){const r="self"!==a.alias||(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.SelectTriggeringRepositoriesBasedOnSHA")&&(256!==e.reason||e.triggerInfo["pr.triggerRepository"]!==a.id)?a.refName:e.sourceBranch;s[i]=Object.assign(Object.assign({},a),{refName:r})}}return Object.keys(s).map((e=>s[e]))}t[e].getRepositoryResourceItems=o}("ComponentsSourcesCard"),function(e){var a,u;lt=t[e]={},function(e){e.artifactType="artifactType",e.projectId="projectId",e.source="source",e.pipelineId="pipelineId",e.version="version",e.alias="alias",e.tag="tag",e.pipelineTriggerType="pipelineTriggerType",e.scheduleName="scheduleName"}(a=t[e].TriggerInfo||(t[e].TriggerInfo={})),function(e){e.BuildResourceCompletion="BuildResourceCompletion",e.ContainerImage="ContainerImage",e.ContinuousIntegration="ContinuousIntegration",e.PullRequest="PullRequest",e.PipelineCompletion="PipelineCompletion",e.WebhookTriggeredEvent="WebhookTriggeredEvent"}(u=t[e].PipelineTriggerType||(t[e].PipelineTriggerType={}));const m=e=>s.createElement("div",{className:(0,k.css)("flex-grow",e.compact?"flex-row flex-self-start summary-column-compact":"flex-column summary-column")},s.createElement("div",{className:"flex-row"},s.createElement("div",{className:(0,k.css)("secondary-text summary-line-non-link",e.compact&&"summary-line-compact"),id:(0,k.getSafeId)(e.labelId)},e.label),e.count&&e.count>1&&s.createElement(X.Pill,{className:"margin-horizontal-4",size:0},e.count)),s.createElement("div",{className:(0,k.css)("summary-line flex-column flex-grow")},e.children));class p extends r.VssComponent{constructor(e,t){super(e,t),this._showSummary=new d.ObservableValue(!1),this._onObservableChanged=e=>{this.setState({run:e})},this._renderCard=e=>{const t=e.some((e=>e.compact)),a=this.state.run,i=a.repositoryResources&&a.repositoryResources.length>1;return s.createElement("div",{role:"region","aria-label":Pe.SummaryTitle},s.createElement(C.Card,{className:"flex-grow summary-card",contentProps:{className:"summary-card-content-container"},titleProps:{size:0}},!!a&&s.createElement("div",{className:(0,k.css)("flex-column summary-card-content flex-grow",t&&"scroll-hidden")},s.createElement("div",{className:"flex-row flex-center summary-header  padding-bottom-16"},s.createElement("div",{className:"flex-grow text-ellipsis"},this._getTriggerElement()),s.createElement(B.ScreenSizeConditional,{condition:e=>0===e},s.createElement(l.Button,{iconProps:{iconName:"ChevronUnfold10"},subtle:!0,onClick:this._onShowSummaryClick}))),s.createElement("div",{className:(0,k.css)("flex-center flex-grow body-m",t?"flex-column summary-view-compact":"flex-row summary-view")},s.createElement(m,{compact:t,label:i?Pe.RepositoriesHeader:Pe.RepositoryVersionHeader,labelId:"repo-label",count:i&&a.repositoryResources.length||void 0},this._renderRepoColumn(a)),s.createElement(B.ScreenSizeObserver,null,(e=>{const i=s.createElement(s.Fragment,null,s.createElement(m,{compact:t,label:Pe.TimeElapsedHeader,labelId:"duration-label"},s.createElement("div",{className:"flex-row summary-line summary-line-non-link flex-center"},s.createElement(n.Icon,{iconName:"Calendar",className:"icon-margin summary-card-icon"}),s.createElement(W.Ago,{date:a.queueTime,format:1})),!!a.startTime&&s.createElement("div",{"aria-describedby":"duration-label",className:"summary-line summary-line-non-link flex-center flex-row"},s.createElement(n.Icon,{iconName:"Clock",className:"icon-margin summary-card-icon"}),s.createElement(w.Duration,{startDate:a.startTime,endDate:a.finishTime})),!a.startTime&&s.createElement("div",{className:"summary-line summary-line-non-link flex-row flex-center"},s.createElement("span",{"aria-label":Pe.None}),s.createElement("span",{"aria-hidden":!0},"-"))),s.createElement(m,{compact:t,label:Pe.RelatedHeader,labelId:"work-items-label"},this._getWorkItemsLinkComponent(a),s.createElement(tt.ArtifactsLink,{run:this.state.run,artifactsData:this.state.artifacts,linkDescribedBy:"artifacts-label"})),s.createElement(m,{compact:t,label:Pe.TestsHeader,labelId:"tests-label"},s.createElement(rt.TestResultsLink,{linkDescribedBy:"tests-label",testsTabUrl:this.props.testsTabUrl}),s.createElement(it.CoverageResultsLink,{linkDescribedBy:"coverage-label",coverageTabUrl:this.props.coverageTabUrl})));return s.createElement(c.Observer,{showSummary:this._showSummary},(t=>t.showSummary||e.screenSize>0?i:null))}))))))},this._onShowSummaryClick=()=>{this._showSummary.value=!this._showSummary.value},this._getAvatarUrl=e=>{if(e){if(e.imageUrl)return e.imageUrl;const t=(0,U.getAvatarUrl)(e);if(t)return t;if(e.id)return(0,H.getIdentityImageUrl)(this.context.pageContext,e.id)}return""},this._service=this.context.pageContext.getService("IRunDetailsService"),this._observable=this._service.data,this.state={run:this._service.data.value,associatedChanges:this._service.associatedChanges,artifacts:this._service.artifacts,traceabilityWorkItemsCount:this._service.traceabilityWorkItemsCount,traceabilityChangesCount:this._service.traceabilityChangesCount,fallbackTraceabilityFlag:this._service.fallbackTraceabilityFlag}}render(){return s.createElement(Z.ResponsiveViewport,{breakPoints:[{className:"summary-view-compact",maxWidth:932,compact:!0}],onRenderContent:this._renderCard})}componentDidMount(){this._observable.subscribe(this._onObservableChanged)}componentWillUnmount(){this._observable.unsubscribe(this._onObservableChanged)}_renderRepoColumn(e){const t=(0,ot.getRepositoryResourceItems)(e,this.context);if(t.length>1){const a=t.length-1;return s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row summary-info flex-center"},s.createElement(Q.RepoLink,{sourceRepositoryId:e.sourceRepositoryId,sourceRepositoryName:e.sourceRepositoryName,sourceRepositoryType:e.sourceRepositoryType,sourceRepositoryUrl:e.sourceRepositoryUrl}),", +",a),s.createElement("div",{className:"flex-row summary-info flex-center"},s.createElement(h.Link,{className:"sourcecard-link",href:"#SourceCard"},Pe.SourceCardLink)))}return s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row summary-info flex-center"},s.createElement(Q.RepoLink,{sourceRepositoryId:e.sourceRepositoryId,sourceRepositoryName:e.sourceRepositoryName,sourceRepositoryType:e.sourceRepositoryType,sourceRepositoryUrl:e.sourceRepositoryUrl})),s.createElement("div",{className:"flex-row summary-info flex-center"},s.createElement(q.BranchLink,{excludeTabStop:!1,repositoryType:e.sourceRepositoryType,repositoryName:e.sourceRepositoryName,repositoryId:e.sourceRepositoryId,repositoryUrl:e.sourceRepositoryUrl,branch:e.sourceBranch,monospace:!1}),s.createElement(Y.CommitLink,{excludeTabStop:!1,repositoryName:e.sourceRepositoryName,repositoryId:e.sourceRepositoryId,repositoryType:e.sourceRepositoryType,commitId:e.sourceVersion,monospace:!1})))}_getChangesLinkComponent(e){return s.createElement(c.Observer,{fallbackTraceabilityFlag:this.state.fallbackTraceabilityFlag},(t=>this._isRunSummaryTraceabilityEnabled&&!t.fallbackTraceabilityFlag?s.createElement(Ae.RunSummaryChangesLink,{traceabilityChangesCount:this.state.traceabilityChangesCount,linkDescribedBy:"changes-label",sourceType:e.sourceRepositoryType,currentRunId:e.id}):s.createElement(at.ChangesLink,{linkDescribedBy:"changes-label",associatedChangesData:this.state.associatedChanges,branch:e.sourceBranch,repositoryName:e.sourceRepositoryName,repositoryId:e.sourceRepositoryId,repositoryUrl:e.sourceRepositoryUrl,sourceType:e.sourceRepositoryType,reason:e.reason})))}get _isRunSummaryTraceabilityEnabled(){return this._service&&this._service.isRunSummaryTraceabilityEnabled}_getWorkItemsLinkComponent(e){return s.createElement(c.Observer,{fallbackTraceabilityFlag:this.state.fallbackTraceabilityFlag},(t=>this._isRunSummaryTraceabilityEnabled&&!t.fallbackTraceabilityFlag?s.createElement(Le.RunSummaryWorkItemsLink,{traceabilityWorkItemsCount:this.state.traceabilityWorkItemsCount,linkDescribedBy:"work-items-label",currentRunId:e.id}):s.createElement(nt.WorkItemsLink,{linkDescribedBy:"work-items-label",associatedChangesData:this.state.associatedChanges,sourceType:this.state.run.sourceRepositoryType})))}_getTriggerElement(){const e=this.state.run;if(e){const c=e.requestedFor&&e.requestedFor.displayName,d=this._getAvatarUrl(e.requestedFor),m=e.triggerInfo[a.scheduleName],p="flex-row flex-center",g=c&&s.createElement("span",{className:p}," ",Pe.By," ",s.createElement(z.BuildPersona,{cssClass:"icon-margin",size:"small",displayName:c,imageUrl:d}),c),v=m&&s.createElement("span",{className:p}," ",Pe.By,"  '",m,"'");let b,C="";switch(this.state.run.reason){case 4:b=s.createElement("span",null,Pe.ReasonBatchedCI),C=Pe.ReasonBatchedCI;break;case 512:b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonBuildCompletion),g),C=c?(0,o.format)(Pe.ByFormat,Pe.ReasonBuildCompletion,c):Pe.ReasonBuildCompletion;break;case 128:b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonCheckInShelveset),g),C=c?(0,o.format)(Pe.ByFormat,Pe.ReasonCheckInShelveset,c):Pe.ReasonCheckInShelveset;break;case 2:b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonCI),g),C=c?(0,o.format)(Pe.ByFormat,Pe.ReasonCI,c):Pe.ReasonCI;break;case 1:b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonManual),g),C=c?(0,o.format)(Pe.ByFormat,Pe.ReasonManual,c):Pe.ReasonManual;break;case 256:b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonPullRequest),g),C=c?(0,o.format)(Pe.ByFormat,Pe.ReasonManual,c):Pe.ReasonManual;break;case 8:b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonScheduled),v),C=m?(0,o.format)(Pe.ByFormat,Pe.ReasonScheduled,m):Pe.ReasonScheduled;break;case 64:b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonValidate),g),C=c?(0,o.format)(Pe.ByFormat,Pe.ReasonValidate,c):Pe.ReasonValidate;break;case 1024:switch(e.triggerInfo[a.pipelineTriggerType]){case u.PipelineCompletion:var t=e.triggerInfo[a.alias],r=e.triggerInfo[a.version];const o=this.context.pageContext,c=o.getService("IBuildLinkingService").getBuildUrl(Number(e.triggerInfo[a.pipelineId]),"",e.triggerInfo[a.projectId]);b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonAutomaticTrigger),s.createElement("span",{className:p}," ",Pe.By," ",s.createElement($.Image,{className:"icons-margin",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/pipeline.svg"),alt:Pe.Pipeline}),s.createElement(h.Link,{className:"bolt-table-link bolt-table-inline-link text-ellipsis",href:c,onClick:e=>{e.preventDefault(),(0,_.onClickFPS)(o,c,!0,e)}},t,"/",r)));break;case u.BuildResourceCompletion:t=e.triggerInfo[a.alias];var n=e.triggerInfo[a.source];r=e.triggerInfo[a.version];b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonAutomaticTrigger),s.createElement("span",{className:p}," ",Pe.By," ",s.createElement($.Image,{className:"icons-margin",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/jenkins.svg"),alt:Pe.Jenkins}),t,"/",n,"/",r));break;case u.ContainerImage:t=e.triggerInfo[a.alias];var l=e.triggerInfo[a.tag];b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonAutomaticTrigger),s.createElement("span",{className:p}," ",Pe.By," ",s.createElement($.Image,{className:"icons-margin",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/azure-container-repository.svg"),alt:Pe.AzureContainerRepository}),t,"/",l));break;case u.WebhookTriggeredEvent:t=e.triggerInfo[a.alias];b=s.createElement("span",{className:p},s.createElement("span",null,Pe.ReasonAutomaticTrigger),s.createElement("span",{className:p}," ",Pe.By," ",s.createElement($.Image,{className:"icons-margin",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/pipeline.svg"),alt:Pe.WebHook}),t))}C=c?(0,o.format)(Pe.ByFormat,Pe.ReasonAutomaticTrigger,c):Pe.ReasonAutomaticTrigger}if(b)return s.createElement("div",{"aria-label":C,className:"flex-row"},s.createElement("span",{className:"flex-star flex-grow  body-xl"},b),this._getChangesLinkComponent(e))}return s.createElement("div",null)}}t[e].RunSummary=p}("ComponentsRunSummary"),function(e){ct=t[e]={};t[e].TagsDialog=e=>{const{run:t,showTagsDialog:a,onSaveTags:i,getRemoteTags:r,context:n}=e,o=new d.ObservableArray;o.push(...t.value.tags);let l=!1,u=[];const h=new d.ObservableArray([]),m=new d.ObservableValue(!0),p=new d.ObservableValue(!1),g=(e,t)=>e===t,_=e=>({content:e}),v=e=>{const t=e.toLocaleLowerCase(),s=u.findIndex((e=>e.toLocaleLowerCase()===t));return s>=0?u[s]:e},b=()=>{h.removeAll()},C=()=>{o.value=t.value.tags,h.value=[],a.value=!1},f=async()=>{p.value=!0,await i(o.value),p.value=!1,C()},S=e=>{const t=e.toLocaleLowerCase();h.value=u.filter((e=>e.toLocaleLowerCase().startsWith(t)&&e.toLocaleLowerCase()!==t))},y=()=>{l||(l=!0,r().then((e=>{u=e,m.value=!1})))},R=e=>{o.value.indexOf(e)<0&&o.push(e),u.indexOf(e)<0&&u.push(e)},k=e=>o.splice(o.value.indexOf(e),1),w=e=>s.createElement(s.Fragment,null,e.item);return s.createElement(c.Observer,{showTagsDialog:a,saving:p},(e=>e.showTagsDialog?s.createElement(ee.Dialog,{titleProps:{text:Pe.AddTagsDialogTitle},lightDismiss:!0,onDismiss:C,footerButtonProps:[{disabled:e.saving,text:Pe.Cancel,type:"reset",onClick:C},{disabled:e.saving,primary:!0,text:Pe.Save,type:"submit",onClick:f}]},s.createElement("div",{className:"margin-top-4"},s.createElement(te.TagPicker,{areTagsEqual:g,convertItemToPill:_,createDefaultItem:v,noResultsFoundText:"",onFocus:y,onBlur:b,onEmptyInputFocus:void 0,onSearchChanged:S,onSearchChangedDebounceWait:0,onTagAdded:R,onTagRemoved:k,placeholderText:Pe.TagsDialogPlaceholder,renderSuggestionItem:w,selectedTags:o,shouldBlurClear:()=>!0,suggestions:h,suggestionsLoading:m,suggestionsLoadingText:Pe.Loading}))):null))}}("ComponentsTagsDialog"),function(e){t.SignalRService={};const s=36e5;class a extends x.VssService{_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceEnd(e){super._serviceEnd(e),this._buildHub&&this._buildHub.dispose(),this._poolHub&&this._poolHub.dispose(),this._testHub&&this._testHubStarted&&this._testHubStarted.then((()=>{this._testHub.dispose()}))}watch(e){this._buildHub&&this._buildHub.start().then((()=>{this._buildHub.watch(e)}))}watchTestHub(e,t){1!==t.status&&32!==t.status||this._testHub&&this._testHubInitialize.then((()=>{this._testHubStarted=this._testHub.watchBuild(e)}))}endWatchTestHub(e){this._testHub&&this._testHubStarted&&this._testHubStarted.then((()=>{this._testHub.unwatchBuild(e).then((()=>{this._testHub.dispose()}))}))}watchPool(e){this._watchingPoolId!==e&&this._poolHub&&(this._watchingPoolId&&this.endWatchPool(this._watchingPoolId),this._watchingPoolId=e,this._poolHub.start().then((()=>{this._poolHub.watch(e)})))}endWatch(e){this._buildHub&&this._buildHub.start().then((()=>{this._buildHub.endWatch(e)}))}endWatchPool(e){this._poolHub&&this._poolHub.start().then((()=>{delete this._watchingPoolId,this._poolHub.endWatch(e)}))}_initialize(){const e=this.pageContext.getService("IVssPageService").getData(),t=this.pageContext.getService("ITfsPageService").getData(),s=this.pageContext.getService("IVssHistoryService"),a=new n(this.pageContext);if(e&&t&&t.project){const n={hostInformation:{hostId:e.hostId,hostPath:e.hostPath,isHosted:e.isHosted,projectId:t.project.id},pageContext:this.pageContext,historyService:s};this._buildHub=new i(n),this._poolHub=new r(n),this._testHub=this.pageContext.getService("ITestSignalRHub"),this._testHubInitialize=this._testHub.initialize(this.pageContext,t.project.id,a)}}}t.SignalRService.SignalRService=a,x.Services.add("ISignalRService",{serviceFactory:a});class i extends ie.SingleConnectionSignalRHub{constructor(e){super({name:se.HubNames.buildDetailHub,hostInformation:e.hostInformation,userInactivityTimeoutMs:s,proxyToRegister:se.getBuildProxyToRegister,pageContext:e.pageContext}),this._initializeClient=e=>{e.client.buildUpdated2=(e,t)=>{this._getView()===o.Summary&&this._detailsService.refreshData()},e.client.timelineRecordsUpdated=(e,t,s,a)=>{const i=this._getView();i===o.Summary&&this._detailsService.refreshData(),i===o.Logs&&this._logsService.onLiveTimelineUpdate(s,a)},e.client.logConsoleLines=e=>{this._getView()===o.Logs&&this._logsService.onLiveContent({content:e.lines.join("\n"),jobId:e.timelineRecordId,taskId:e.stepRecordId,timelineId:e.timelineId})},e.client.buildArtifactAdded=(e,t)=>{const s=this._getView();s===o.Artifacts&&this._artifactsService.refreshData(),s===o.Summary&&this._detailsService.refreshArtifactsData()}},this._options=e,this.initializeProxyClient(se.HubNames.buildDetailHub,this._initializeClient)}start(){return super.start()}watch(e){const t=this._hub;t&&t.server.watchBuild(this._options.hostInformation.projectId,e)}endWatch(e){const t=this._hub;t&&t.server.stopWatchingBuild(this._options.hostInformation.projectId,e)}dispose(){super.dispose()}get _hub(){return this.getHub(se.HubNames.buildDetailHub)}_getView(){const e=this._options.historyService.getState();switch((e&&e.view||"").toLowerCase()){case"logs":return o.Logs;case"artifacts":return o.Artifacts;default:return o.Summary}}get _logsService(){return this._options.pageContext.getService("IRunLogsService")}get _detailsService(){return this._options.pageContext.getService("IRunDetailsService")}get _artifactsService(){return this._options.pageContext.getService("pipelines-run-published-artifacts-tab-provider-service")}}t.SignalRService.BuildHub=i;class r extends ie.SingleConnectionSignalRHub{constructor(e){super({name:ae.HubNames.taskAgentPoolHub,hostInformation:e.hostInformation,userInactivityTimeoutMs:s,proxyToRegister:ae.getDTProxyToRegister,pageContext:e.pageContext}),this._initializeClient=e=>{e.client.notifyAgentConnected=(e,t)=>{this._logsService.onLiveAgentStatusUpdate(e,t)},e.client.notifyAgentDisconnected=(e,t)=>{this._logsService.onLiveAgentStatusUpdate(e,t)},e.client.notifyAgentRequestAssigned=(e,t)=>{this._logsService.onLiveRequestUpdate(e,t)},e.client.notifyAgentRequestQueued=(e,t)=>{this._logsService.onLiveRequestUpdate(e,t,!0)},e.client.notifyAgentRequestStarted=(e,t)=>{this._logsService.onLiveRequestUpdate(e,t)},e.client.notifyAgentRequestCompleted=(e,t)=>{this._logsService.onLiveRequestUpdate(e,t)}},this._options=e,this.initializeProxyClient(ae.HubNames.taskAgentPoolHub,this._initializeClient)}start(){return super.start()}watch(e){const t=this._hub;t&&t.server.subscribe(e)}endWatch(e){const t=this._hub;t&&t.server.unsubscribe(e)}dispose(){super.dispose()}get _hub(){return this.getHub(ae.HubNames.taskAgentPoolHub)}get _logsService(){return this._options.pageContext.getService("IRunLogsService")}}t.SignalRService.PoolHub=r;class n{constructor(e){this._runDetailsService=e.getService("IRunDetailsService")}testRunStatsChangedForBuild(e){this._runDetailsService.updateTestPassRate(),this._runDetailsService.updateCodeCoverageSummary()}testRunStatsChangedForRelease(e,t){}}var o;!function(e){e[e.Summary=0]="Summary",e[e.Logs=1]="Logs",e[e.Artifacts=2]="Artifacts"}(o||(o={}))}(),function(e){ut=t.RunDetailsService={};const s="User";class a extends x.VssService{constructor(){super(...arguments),this._refreshData=()=>{if(this._runDetails&&this._runDetails.value){this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.run-details-data-provider",{buildId:this._runDetails.value.id.toString()},!0).then((e=>{if(e){2===e.status&&this._liveCheckTimer&&(this._timerManagement.clearInterval(this._liveCheckTimer),this._liveCheckTimer=void 0);const t=this._runDetails.value;this._runDetails.value=this._standardizeData(e),this._retentionLeases.value=this._runDetails.value.retentionLeases,2===this._runDetails.value.status&&(this.updateTestPassRate(),this.updateCodeCoverageSummary(),this._signalR&&this._signalR.endWatchTestHub(this._runDetails.value.id)),!e.sourceVersion||t&&t.sourceVersion||this._fetchChangeData()}}))}},this._updateData=()=>{this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?(this._tempTraceabilityWorkItemsCount&&(this._traceabilityWorkItemsCount.value=this._tempTraceabilityWorkItemsCount),this._tempTraceabilityChangesCount&&(this._traceabilityChangesCount.value=this._tempTraceabilityChangesCount)):this._tempAssociatedChanges&&(this._associatedChanges.value=this._tempAssociatedChanges),this._tempTestResults&&(this._testResults.value=this._tempTestResults),this._tempArtifactsData&&(this._artifacts.value=this._tempArtifactsData),this._codeCoverageResults&&(this._codeCoverageResults.value=this._tempCodeCoverageResults)},this._refreshArtifactsData=()=>{this._getArtifactsData()},this._fetchTraceabilityChangesCount=(e,t,s=0)=>{this._contributionService.getDataAsync("ms.vss-build-web.traceability-run-changes-count-data-provider",e,!0).then((a=>{const i=a&&null!=a.changesCount?a.changesCount:-1;if(i>-1){this._tempTraceabilityChangesCount=i;const e=this._shouldUpdateData();e?(this._traceabilityChangesCount.value=i,1===e&&(this._testResults.value=this._tempTestResults,this._artifacts.value=this._tempArtifactsData,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData()}if(-1===i)s<2?setTimeout((()=>this._fetchTraceabilityChangesCount(e,t,s+1)),2e3):(this._fallbackTraceabilityFlag.value=!0,this._getChangeData());else{const a=(0,V.duration)(t,new Date);this._publishTraceabilityProviderTelemetry(e.currentRunId,this._runDetails.value.sourceRepositoryType,a,s,i)}}))},this._fetchTraceabilityWorkItemsCount=(e,t,s=0)=>{this._contributionService.getDataAsync("ms.vss-build-web.traceability-run-workitems-count-data-provider",e,!0).then((a=>{const i=a&&null!=a.workItemsCount?a.workItemsCount:-1;if(i>-1){this._tempTraceabilityWorkItemsCount=i;const e=this._shouldUpdateData();e?(this._traceabilityWorkItemsCount.value=i,1===e&&(this._testResults.value=this._tempTestResults,this._artifacts.value=this._tempArtifactsData,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData()}if(-1===i)s<2?setTimeout((()=>this._fetchTraceabilityWorkItemsCount(e,t,s+1)),2e3):(this._fallbackTraceabilityFlag.value=!0,this._getChangeData());else{const a=(0,V.duration)(t,new Date);this._publishTraceabilityProviderTelemetry(e.currentRunId,this._runDetails.value.sourceRepositoryType,a,s,void 0,i)}}))}}get data(){return this._runDetails}get associatedChanges(){return this._associatedChanges}get fallbackTraceabilityFlag(){return this._fallbackTraceabilityFlag}get traceabilityChangesCount(){return this._traceabilityChangesCount}get traceabilityWorkItemsCount(){return this._traceabilityWorkItemsCount}get artifacts(){return this._artifacts}get isDeleted(){return this._isDeleted}get testRunResults(){return this._testResults}get codeCoverageResults(){return this._codeCoverageResults}get retentionLeases(){return this._retentionLeases}refreshData(e=!1){this._liveCheckTimer&&(this._timerManagement.clearInterval(this._liveCheckTimer),this._liveCheckTimer=this._timerManagement.setInterval(this._refreshData,9e4)),e?this._refreshData():this._refreshDataDebounced()}refreshArtifactsData(){this._refreshArtifactsDataDebounced()}getPermissions(){const e=this._runDetails.value;let t=!1,s=!1,a=!1,i=!1,r=!1,n=!1;return this._runDetails&&(t=this._security.canQueueBuildById(e.pipeline.id.toString(),e.pipeline.path),s=this._security.canRetainBuildByDefinitionId(e.pipeline.id.toString(),e.pipeline.path),a=this._security.canCancelBuildByUserId(this._userId,e.pipeline.id.toString(),e.pipeline.path,e.requestedForId,e.requestedById),i=this._security.canDeleteBuildByDefinitionId(e.pipeline.id.toString(),e.pipeline.path),r=this._security.canEditDefinition({id:e.pipeline.id,path:e.pipeline.path}),n=this._security.canEditTagsByUserId(this._userId,e.pipeline.id.toString(),e.pipeline.path,e.requestedForId,e.requestedById)),{canRunBuild:t,canRetainBuild:s,canCancelBuild:a,canDeleteBuild:i,canEditPipeline:r,canEditTags:n}}getTags(){return this._client.getTags(this._projectId)}cancelRun(){const e=this._runDetails.value;this._client.updateBuild({status:4},this._projectId,e.id).then((e=>{this.refreshData()})).catch(oe.handleError)}deleteRun(){const e=this._runDetails.value;this._client.deleteBuild(this._projectId,e.id).then((()=>{this._isDeleted.value=!0,this.refreshData()})).catch(oe.handleError)}cancelStage(e){this._client.updateStage({state:0},this._runDetails.value.id,e,this._projectId).then((()=>{this.refreshData()})).catch(oe.handleError)}retryStage(e,t=!1){const s={state:1,forceRetryAllJobs:t};this._client.updateStage(s,this._runDetails.value.id,e,this._projectId).then((()=>{this.refreshData()})).catch(oe.handleError)}retryPipeline(){this._client.updateBuild({},this._projectId,this._runDetails.value.id,!0).then((()=>{this.refreshData()})).catch(oe.handleError)}retainBuild(){if(this._userId){const e=this._runDetails.value,t=this._retentionLeases.value.filter((e=>this._matchUserLease(e)));if(!t||0===t.length){const t={daysValid:365e3,definitionId:e.pipeline.id,ownerId:`User:${this._userId}`,protectPipeline:!1,runId:e.id};this._client.addRetentionLeases([t],this._projectId).then((e=>{this._refreshData()}),oe.handleError)}}}stopRetainingBuild(){if(this._userId){const e=this._retentionLeases.value.filter((e=>this._matchUserLease(e)));if(e&&e.length>0){const t=e.map((e=>e.id));this.deleteRetentionLeases(t)}}}updateApprovals(e){return(0,re.getApprovalClient)(this.pageContext).updateApprovals(e,this._projectId)}updatePermissions(e,t,s){return(0,ne.getPipelinePermissionsClient)(this.pageContext).updatePipelinePermisionsForResource(e,this._projectId,t,s).catch(oe.handleError)}async updateTags(e){const t=this._runDetails.value,s=t.tags,a=e.filter((e=>s.indexOf(e)<0)),i=s.filter((t=>e.indexOf(t)<0));try{const e={tagsToAdd:a,tagsToRemove:i};t.tags=await this._client.updateBuildTags(e,this._projectId,t.id)}catch(e){(0,oe.handleError)(e)}this._runDetails.value=t}startListening(){this._runDetails&&this._runDetails.value&&(this._signalR=this.pageContext.getService("ISignalRService"),this._signalR.watch(this._runDetails.value.id),this._signalR.watchTestHub(this._runDetails.value.id,this._runDetails.value))}stopListening(){this._signalR&&(this._signalR.endWatch(this._runDetails.value.id),this._signalR=void 0)}_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceRestart(e){super._serviceRestart(e),this._initialize()}_serviceEnd(e){super._serviceEnd(e),this._timerManagement.clearAllTimers()}async updateTestPassRate(){if(this._runDetails){const e=await this._externalService.getTestResultsForRun(this._runDetails.value.id,this._runDetails.value.status);if(e){this._tempTestResults=e;const t=this._shouldUpdateData();t?(this._testResults.value=e,1===t&&(this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?(this._traceabilityWorkItemsCount.value=this._tempTraceabilityWorkItemsCount,this._traceabilityChangesCount.value=this._tempTraceabilityChangesCount):this._associatedChanges.value=this._tempAssociatedChanges,this._artifacts.value=this._tempArtifactsData,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData()}}}async updateCodeCoverageSummary(){if(this._runDetails){const e=await this._externalService.getCodeCoverageSummary(this._runDetails.value.id,this._runDetails.value.status);if(e){this._tempCodeCoverageResults=e;const t=this._shouldUpdateData();t?(this._codeCoverageResults.value=e,1===t&&(this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?(this._traceabilityWorkItemsCount.value=this._tempTraceabilityWorkItemsCount,this._traceabilityChangesCount.value=this._tempTraceabilityChangesCount):this._associatedChanges.value=this._tempAssociatedChanges,this._artifacts.value=this._tempArtifactsData,this._testResults.value=this._tempTestResults)):this._updateData()}}}get isRunSummaryTraceabilityEnabled(){return this._isRunViewTraceabilityFeatureFlagEnabled&&this._runDetails&&this._runDetails.value&&256!=this._runDetails.value.reason&&(o.equals(this._runDetails.value.sourceRepositoryType,J.RepositoryTypes.TfsGit,!0)||o.equals(this._runDetails.value.sourceRepositoryType,J.RepositoryTypes.GitHub,!0))}deleteRetentionLeases(e){this._client.deleteRetentionLeasesById(this._projectId,e).then((()=>{this.refreshData()})).catch(oe.handleError)}_shouldUpdateData(){if(this._tempArtifactsData&&this._tempTestResults&&-1!=this._tempTestResults.testsCount)if(this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value){if(this._tempTraceabilityWorkItemsCount&&this._tempTraceabilityChangesCount)return 1}else if(this._tempAssociatedChanges)return 1;return!this._runDetails||1!==this._runDetails.value.status&&32!==this._runDetails.value.status&&8!==this._runDetails.value.status?0:2}_publishTraceabilityProviderTelemetry(e,t,s,a,i,r){const n={};n.currentRunId=e,n.sourceType=t,n.timeTaken=s,n.retryCount=a;let o="RunViewChangesCount";null!=i?n.commitsCount=i:(n.workItemsCount=r,o="RunViewWorkItemsCount"),this._telemetryService.publishEvent("Traceability",o,n)}_publishGetChangesTelemetry(e,t,s){const a={};a.sourceType=e,a.commitsCount=t,a.timeTaken=s,this._telemetryService.publishEvent("Pipelines","GetChanges",a)}_initialize(){const e=this.pageContext.getService("ITfsPageService").getData();e&&e.project&&(this._projectId=e.project.id);const t=this.pageContext.getService("IVssPageService").getData();t&&t.user&&(this._userId=t.user.id),this._isRunViewTraceabilityFeatureFlagEnabled=(0,b.isFeatureFlagEnabled)(this.pageContext,"Pipelines.Traceability.EnableTraceabilityForRunView",!1),this._externalService=this.pageContext.getService("IRunExternalService"),this._contributionService=this.pageContext.getService("IVssContributionService");const s=this._contributionService.getData("ms.vss-build-web.run-details-data-provider");this._testResults=new d.ObservableValue({testsPassRate:-1,testsCount:-1}),this._codeCoverageResults=new d.ObservableValue({coverage:""}),this._traceabilityChangesCount=new d.ObservableValue(0),this._traceabilityWorkItemsCount=new d.ObservableValue(0),this._fallbackTraceabilityFlag=new d.ObservableValue(!1),this._associatedChanges=new d.ObservableValue({changes:[],workItems:[],previousSourceVersion:""}),this._artifacts=new d.ObservableValue({publishedArtifactsCount:0,sources:[],consumedArtifactsCount:0}),this._isDeleted=new d.ObservableValue(!1),s&&(this._runDetails=new d.ObservableValue(this._standardizeData(s)),this._retentionLeases=new d.ObservableArray(s.retentionLeases),this._permissionsStore=new ce.PermissionsStore({pageContext:this.pageContext}),this._security=new le.Security({projectId:this._projectId,store:this._permissionsStore}),this._fetchChangeData(),this._getArtifactsData(),this.updateTestPassRate(),this.updateCodeCoverageSummary()),this._client=this.pageContext.getRestClient("IBuildRestClient"),this._timerManagement=new ue.TimerManagement,this._refreshDataDebounced=this._timerManagement.debounce(this._refreshData,3e3),this._refreshArtifactsDataDebounced=this._timerManagement.debounce(this._refreshArtifactsData,3e3),this._updateData=this._timerManagement.debounce(this._updateData,700),this._telemetryService=this.pageContext.getService("IVssTelemetryService"),this._runDetails&&this._runDetails.value&&2!==this._runDetails.value.status&&(this._liveCheckTimer=this._timerManagement.setInterval(this._refreshData,9e4))}_fetchChangeData(){this._runDetails&&this._runDetails.value&&(this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?this._getRunViewTraceabilityData():this._getChangeData())}_getRunViewTraceabilityData(){var e={currentRunId:this._runDetails.value.id.toString()};const t=new Date;this._fetchTraceabilityChangesCount(e,t);const s=new Date;this._fetchTraceabilityWorkItemsCount(e,s)}_getChangeData(){const e=new Date,t={repositoryId:this._runDetails.value.sourceRepositoryId,repositoryType:this._runDetails.value.sourceRepositoryType,buildId:this._runDetails.value.id.toString(),serviceEndpointId:this._runDetails.value.sourceEndpointId,includeSourceChanges:!1};this._contributionService.getDataAsync("ms.vss-build-web.run-details-changes-data-provider",t,!0).then((t=>{if(t){this._tempAssociatedChanges=t;const s=this._shouldUpdateData();s?(this._associatedChanges.value=t,1===s&&(this._testResults.value=this._tempTestResults,this._artifacts.value=this._tempArtifactsData,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData();const a=t&&t.changes?t.changes.length:0,i=(0,V.duration)(e,new Date);this._publishGetChangesTelemetry(this._runDetails.value.sourceRepositoryType,a,i)}}))}_getArtifactsData(){if(this._runDetails&&this._runDetails.value){const e={buildId:this._runDetails.value.id.toString()};this._contributionService.getDataAsync("ms.vss-build-web.run-details-artifacts-data-provider",e,!0).then((e=>{if(e){this._tempArtifactsData=e;const t=this._shouldUpdateData();t?(this._artifacts.value=e,1===t&&(this._testResults.value=this._tempTestResults,this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?(this._traceabilityWorkItemsCount.value=this._tempTraceabilityWorkItemsCount,this._traceabilityChangesCount.value=this._tempTraceabilityChangesCount):this._associatedChanges.value=this._tempAssociatedChanges,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData()}}))}}_standardizeData(e){return e.jobs||(e.jobs=[]),e.stages||(e.stages=[]),e.tags||(e.tags=[]),e.issues||(e.issues=[]),e}_matchUserLease(e){return e&&e.leaseType===s&&e.leaseOwnerIdentityRef&&e.leaseOwnerIdentityRef.id===this._userId}}t.RunDetailsService.RunDetailsService=a,t.RunDetailsService.getRunDetailsService=function(e){return e.getService("IRunDetailsService")},x.Services.add("IRunDetailsService",{serviceFactory:a})}(),function(e){t[e]={};class s extends x.VssService{constructor(){super(...arguments),this.items=new d.ObservableArray}getBreadcrumbItems(e){return this.items}setBreadcrumbs(e,t,s,a){this.items.removeAll(),this.items.push({key:"pipeline-breadcrumb",text:e,href:t,onClick:e=>{(0,_.onClickFPS)(this.pageContext,t,!0,e,{telemetrySource:"pipeline-breadcrumb"})}}),this.items.push({key:"run-breadcrumb",text:s,href:a,onClick:e=>{(0,_.onClickFPS)(this.pageContext,a,!0,e,{telemetrySource:"run-breadcrumb"})}})}clearBreadcrumbs(){this.items.removeAll()}}t[e].RunHeaderBreadcrumbService=s,x.Services.add("run-header-breadcrumb-service",{serviceFactory:s})}("RunHeaderBreadcrumbService"),function(e){dt=t.RunView={};const a="ms.vss-test-web.unified-test-results-tab";var i,n;!function(e){e.Results="results"}(i||(i={})),function(e){e.Container="Container".toLowerCase(),e.FilePath="FilePath".toLowerCase()}(n||(n={}));t.RunView.legacyNoop=e=>{console.error("Not supported")};class l extends r.VssComponent{constructor(e,t){super(e,t),this._tabProviders=new d.ObservableCollection,this._projectId="",this._headerActions=new d.ObservableArray,this._staticActions=new d.ObservableArray,this._contributedActions=new d.ObservableCollection,this._extCallbacks=[],this._showChecksPanel=new d.ObservableValue(!1),this._checkListItemType=new d.ObservableValue(3),this._stagesToReview=new d.ObservableArray,this._reviewMode=new d.ObservableValue(0),this._getRetentionMessage=(e,t,s)=>{let a=e.retainedFor;const i=this._getMaxLease(t,e.retainedFor);if(i&&(a=this._getDaysUntilExpiration(i)),a>=36500)switch(i.leaseType){case Ve.LeaseType.Pipeline:return(0,o.format)(Pe.RetainedByPipelineRecentRuns,s);case Ve.LeaseType.Branch:return(0,o.format)(Pe.RetainedByProtectBranchRecentRuns,s,i.ownerDisplayName);case Ve.LeaseType.User:case Ve.LeaseType.ReleaseManagment:default:return(0,o.format)(Pe.RetainedByLeaseForever,i.ownerDisplayName,i.leaseType)}const r=a>=365?Math.floor(a/365):0;a-=365*r;const n=Math.floor(a/30);a-=365*n,a<0&&(a=0);let l=function(e){switch(e){case 0:return"";case 1:return Pe.RetainedByLeaseForOneYear;default:return(0,o.format)(Pe.RetainedByLeaseForYears,e)}}(r);if(r<2){const e=function(e){switch(e){case 0:return"";case 1:return Pe.RetainedByLeaseForOneMonth;default:return(0,o.format)(Pe.RetainedByLeaseForMonths,e)}}(n);if(1===r&&n>0&&(l+=", "),n>0&&(l+=e),0===r&&n<6){const e=function(e){switch(e){case 0:return"";case 1:return Pe.RetainedByLeaseForOneDay;default:return(0,o.format)(Pe.RetainedByLeaseForDays,e)}}(a);n>0&&a>0&&(l+=", "),a>0&&(l+=e)}}return i?function(e,t){return e>0||t>=6?Pe.RetainedByLeaseBegin_MoreThan:Pe.RetainedByLeaseBegin_Exact}(r,n)+l+(0,o.format)(Pe.RetainedByLeaseEnd,i.ownerDisplayName,i.leaseType):e.retainedFor>1?(0,o.format)(Pe.RetainedByNobody,l):Pe.RetainedByNobodyNextRun},this._getMaxLease=(e,t)=>{if(e.length>0){let s=e[0],a=this._getDaysUntilExpiration(s);for(let t=1;t!==e.length;++t){const i=this._getDaysUntilExpiration(e[t]);i>a&&(s=e[t],a=i)}if(a>=t)return s}},this._getDaysUntilExpiration=e=>Math.floor((e.validUntil.getTime()-Date.now())/864e5),this._getMaxDaysUntilExpiration=(e,t)=>{if(t.length>0){const e=t.reduce(((e,t)=>Math.max(t.validUntil.getTime(),e)),0);return Math.floor((e-Date.now())/864e5)}return e.retainedFor},this._updateTab=e=>{if(e.id===a)e.url=this._navigationService.getLinkingService().getBuildUrl(this._run.value.id,Ve.NavTestTabId),e.id=Ve.NavTestTabId;else{const t=this.context.pageContext.getService("IVssHistoryService");e.url=t.generateUrl({view:e.id})}},this._getHeaderIconProps=e=>{const t=(0,v.getBuildStatusIndicatorData)(e.status,e.result);return{render:()=>s.createElement(R.Tooltip,{text:t.label},s.createElement("span",null,s.createElement(f.Status,Object.assign({ariaLabel:t.label,size:"24"},t.statusProps))))}},this._onActionsUpdate=()=>{const e=this._contributedActions?this._contributedActions.value:[];e.length>0&&e.unshift({id:"contributed-divider",important:!1,itemType:1}),e.forEach((e=>e.important=!1)),this._headerActions.value=this._staticActions.value.concat(e)},this._confirmAction=(e,t,a)=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((i=>{const r={title:e,message:t,onClose:i,onConfirm:a};return s.createElement(M.CommandComponent,Object.assign({commandType:"ciDConfirmPipelineComponent"},r),null)}))},this._getTags=()=>this._service.getTags(),this._onClickHeaderBack=()=>{const e=this.context.pageContext.getService("IBuildLinkingService").getPipelinesUrl(this._run.value.pipeline.id);(0,_.onClickFPS)(this.context.pageContext,e,!0)},this._onTabChanged=e=>{this._pivot.value=e,e===Ve.NavTestTabId?this._performanceService.startScenario(a,!1,void 0,{isTabChangeScenario:!0}):e===Ve.CodeCoverageCiTabId&&this._performanceService.startScenario("Pipelines.CodeCoverage",!1,void 0,{isTabChangeScenario:!0})},this._onViewStateChanged=e=>{this.setState({selectedTab:e})},this._onRunDeleted=e=>{if(e){const e=this._navigationService.getLinkingService().getDefinitionUrl(this._run.value.pipeline.id);(0,_.onClickFPS)(this.context.pageContext,e,!0)}},this._onSubmitBulkApproval=e=>{this._service.updateApprovals(e).then((e=>{e&&(this._service.refreshData(!0),this._showChecksPanel.value=!1)})).catch(oe.handleError)},this._onReassignApprovals=e=>this._service.updateApprovals(e).then((e=>{if(e)return this._service.refreshData(!0),this._showChecksPanel.value=!1,this._globalMessageService.addToast({message:Pe.ApprovalReassigned,duration:5e3,forceOverrideExisting:!0}),Promise.resolve()}),(e=>Promise.reject(e))),this._onPermitResource=(e,t,s)=>{this._service.updatePermissions(e,t,s).then((e=>{e&&(this._globalMessageService.addToast({message:Pe.PermissionGranted,duration:5e3,forceOverrideExisting:!0}),this._service.refreshData(!0))}))},this._shouldHideChecksPanel=e=>{if(1===this._reviewMode.value&&this._stagesToReview.value&&1===this._stagesToReview.value.length){const t=e.find((e=>e.id===this._stagesToReview.value[0].id));t&&t.checks&&t.checks.some((e=>2===e.status))||(this._showChecksPanel.value=!1)}else e.some((e=>e.checks&&e.checks.some((e=>2===e.status))))||(this._showChecksPanel.value=!1)},this._onActivateRetentionPanel=e=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>{const a=this._service.retentionLeases,i={canDeleteLeases:e,onDelete:e=>{this._service.deleteRetentionLeases(e),e.forEach((e=>{const t=a.value.findIndex((t=>t.id===e));a.splice(t,1)}))},onDismiss:t,retentionLeases:a};return s.createElement(de.RetentionPanel,i)}))},this._onReviewStageClicked=e=>{this._stagesToReview.value=[e],this._reviewMode.value=1,this._showChecksPanel.value=!0,this._checkListItemType.value=1,this._activeElement=document.activeElement},this._onReviewManualValidationClicked=e=>{this._stagesToReview.value=[e],this._reviewMode.value=1,this._showChecksPanel.value=!0,this._checkListItemType.value=2,this._activeElement=document.activeElement},this._onReviewClicked=e=>{this._stagesToReview.value=e,this._reviewMode.value=0,this._showChecksPanel.value=!0,this._checkListItemType.value=3,this._activeElement=document.activeElement},this._onPanelDismiss=()=>{this._showChecksPanel.value=!1,this._activeElement&&(this._activeElement.focus(),this._activeElement=void 0)},this._onRunUpdated=()=>{let e=!1;const t=this._run.value;let s=!1;if(this._initializeActions(),t.id!=this._contributedTabProps.runId.value&&(this._contributedTabProps.runId.value=t.id,e=!0,s=!0),t.number!=this._contributedTabProps.runNumber.value&&(this._contributedTabProps.runNumber.value=t.number,e=!0),t.status!=this._contributedTabProps.status.value&&(this._contributedTabProps.status.value=t.status,s=!0),t.sourceBranch!=this._contributedTabProps.sourceBranch.value&&(this._contributedTabProps.sourceBranch.value=t.sourceBranch),t.sourceRepositoryId!=this._contributedTabProps.sourceRepositoryId.value&&(this._contributedTabProps.sourceRepositoryId.value=t.sourceRepositoryId),t.sourceRepositoryType!=this._contributedTabProps.sourceRepositoryType.value&&(this._contributedTabProps.sourceRepositoryType.value=t.sourceRepositoryType),t.pipeline.id!=this._contributedTabProps.pipelineId.value&&(this._contributedTabProps.pipelineId.value=t.pipeline.id),t.sourceVersion!=this._contributedTabProps.sourceVersion.value&&(this._contributedTabProps.sourceVersion.value=t.sourceVersion),t.finishTime!=this._contributedTabProps.finishTime.value&&(this._contributedTabProps.finishTime.value=t.finishTime),this._contributedTabProps.notifyUpdated.value++,e&&this._updateHeaderBreadcrumb(),s){const e=this._getBuild();e&&e.then((e=>{this._extCallbacks.forEach((t=>{t(e)}))}))}this._shouldHideChecksPanel(this._run.value.stages)},this._onSaveTags=async e=>{await this._service.updateTags(e)},this._service=(0,ut.getRunDetailsService)(this.context.pageContext),this._navigationService=this.context.pageContext.getService("IBuildNavigationService"),this._globalMessageService=this.context.pageContext.getService("IGlobalMessagesService"),this._pageHistoryService=this.context.pageContext.getService("IPageStateHistoryService");const r=this.context.pageContext.getService("IVssHistoryService");this._resultsUrl=r.generateUrl({view:i.Results});const n=r.getState();this._pivot=new d.ObservableValue(n&&n.view||i.Results),this._run=this._service.data;const l=t.pageContext.getService("ITfsPageService").getData();l&&l.project&&(this._projectId=l.project.id),this._run&&(this._contributedTabProps={runId:new d.ObservableValue(this._run.value.id),runNumber:new d.ObservableValue(this._run.value.number),pipelineId:new d.ObservableValue(this._run.value.pipeline.id),projectId:new d.ObservableValue(this._projectId),sourceBranch:new d.ObservableValue(this._run.value.sourceBranch),sourceRepositoryId:new d.ObservableValue(this._run.value.sourceRepositoryId),sourceRepositoryType:new d.ObservableValue(this._run.value.sourceRepositoryType),status:new d.ObservableValue(this._run.value.status),stages:new d.ObservableArray,notifyUpdated:new d.ObservableValue(1),sourceVersion:new d.ObservableValue(this._run.value.sourceVersion),finishTime:new d.ObservableValue(this._run.value.finishTime)},this._run.value.stages.forEach((e=>{this._contributedTabProps.stages.push({name:e.name,refName:e.refName})}))),this._tabProviders.push((0,_e.getTabs)(t.pageContext,"ms.vss-build-web.run-details-view-tabs",{contextualData:this._contributedTabProps,props:this._contributedTabProps,preProcessTabContribution:this._updateTab})),this.state={selectedTab:this._pivot.value,cancelClicked:!1,showTagsDialog:new d.ObservableValue(!1),runsToRetainPerProtectedBranch:""},this._performanceService=this.context.pageContext.getService("IVssPerformanceService"),this._initializeActions()}render(){return this._run?s.createElement(S.Surface,{background:1},s.createElement(j.Page,{className:"run-details-page",selectedTabId:this._pivot.value,tabProviders:this._tabProviders},s.createElement(c.Observer,{run:this._run,leases:this._service.retentionLeases},(e=>{const t=(0,me.formatPipelineRunName)(e.run.number,e.run.sourceVersionMessage,e.run.appendCommitMessageToRunName),a=e.run.pipeline.name;return s.createElement(s.Fragment,null,s.createElement(ve.CustomHeader,{className:"run-view-header"},s.createElement(B.ScreenSizeConditional,{condition:e=>0===e},s.createElement(ve.HeaderBackButton,{buttonProps:{onClick:this._onClickHeaderBack,text:e.run.pipeline.name}})),s.createElement("div",{className:"flex-row flex-self-stretch"},s.createElement(ve.HeaderIcon,{iconProps:this._getHeaderIconProps(e.run),titleSize:2}),s.createElement(ve.HeaderTitleArea,{className:"padding-bottom-4"},s.createElement(ve.HeaderTitleRow,null,s.createElement("div",{className:"flex-row flex-baseline scroll-hidden"},s.createElement(ve.HeaderTitle,{titleSize:1,className:"text-ellipsis"},t))),s.createElement(B.ScreenSizeConditional,{condition:e=>e>0},s.createElement("div",{className:"flex-row summary-line summary-line-non-link flex-center"},s.createElement(fe.ContributedIcon,{alt:"",contributionId:"ms.vss-build-web.pipelines-hub",iconName:"Build",iconSize:"small",pageContext:this.context.pageContext,className:"pipelines-icon-right-margin"}),s.createElement(ve.HeaderDescription,null,a)))),s.createElement(c.UncheckedObserver,{items:this._headerActions},s.createElement(be.HeaderCommandBar,{className:"flex-self-start",items:[]}))),s.createElement(B.ScreenSizeConditional,{condition:e=>e>0},e.run.tags.length>0&&s.createElement(Ce.PillGroup,{overflow:1,className:"margin-top-4 flex-self-stretch margin-left-32"},e.run.tags.map((e=>s.createElement(X.Pill,{className:"margin-right-4",key:e,size:0,excludeTabStop:!0,excludeFocusZone:!0},e)))))),(e.run.finishTime||e.leases.length>0)&&s.createElement("div",{className:"page-content page-content-top"},s.createElement(u.MessageCard,{severity:this._getMaxDaysUntilExpiration(e.run,e.leases)>7?"Info":"Warning",buttonProps:e.leases.length?[{onClick:()=>{this._onActivateRetentionPanel(!0)},text:Pe.ViewRetentionLeasesMenuItem}]:[]},this._getRetentionMessage(e.run,e.leases,this.state.runsToRetainPerProtectedBranch))))})),s.createElement(y.TabBar,{tabSize:"tall",onSelectedTabChanged:this._onTabChanged},s.createElement(y.Tab,{name:Pe.PipelineTabName,id:i.Results,key:i.Results,url:this._resultsUrl})),s.createElement("div",{className:(0,k.css)("run-details-tab-content page-content page-content-top",this.state.selectedTab===Ve.NavTestTabId&&"unified-testtab-extension-tab-content",this.state.selectedTab!==i.Results&&"run-details-extension-tab-content")},s.createElement(y.TabContent,null,this.state.selectedTab===i.Results&&s.createElement(c.Observer,{providers:this._tabProviders,run:this._run},(e=>s.createElement("div",{className:"flex-column"},s.createElement(c.Observer,{stages:this._stagesToReview,shouldShowChecksPanel:this._showChecksPanel,reviewMode:this._reviewMode},(t=>{const a={stages:t.stages,runId:e.run.id,pipelineId:e.run.pipeline.id,checkListItemType:this._checkListItemType.value,reviewMode:t.reviewMode,onSubmitBulkApproval:this._onSubmitBulkApproval,onReassignApprovals:this._onReassignApprovals,onPermitResource:this._onPermitResource,onDismiss:this._onPanelDismiss};return s.createElement("div",null,!!t.stages&&t.shouldShowChecksPanel&&s.createElement(r.WrappedComponent,Object.assign({dependencies:["ms.vss-build-web.approvals-panel"],wrappedType:"ms.tfs-build.approvals-list-panel"},a)))})),s.createElement(lt.RunSummary,{testsTabUrl:this._getTestsTabUrl(e.providers),coverageTabUrl:this._getCoverageTabUrl(e.providers)}),s.createElement(Ue.IssuesCard,null),s.createElement(Be.ChecksCard,{stages:e.run.stages,onReviewClicked:this._onReviewClicked}),s.createElement(Ze.JobsCard,{onReviewStageClicked:this._onReviewStageClicked,onReviewManualValidationClicked:this._onReviewManualValidationClicked}),s.createElement(ot.SourcesCard,null))))))),s.createElement(ct.TagsDialog,{getRemoteTags:this._getTags,onSaveTags:this._onSaveTags,run:this._run,showTagsDialog:this.state.showTagsDialog,context:this.context})):s.createElement(et.NoData,null)}async componentWillMount(){const e=new Se.ContributionSource({pageContext:this.context.pageContext}),t=await e.getDataAsync(Ve.RetentionSettingDataContributionId,void 0,!0);t&&t.runsToRetainPerProtectedBranch&&this.setState({runsToRetainPerProtectedBranch:t.runsToRetainPerProtectedBranch.value.toString()})}componentDidMount(){(0,M.prefetch)(this.context.pageContext),this._run&&(this._pivot.subscribe(this._onViewStateChanged),this._service.isDeleted.subscribe(this._onRunDeleted),this._run.subscribe(this._onRunUpdated),(0,oe.registerErrorHandler)((e=>{e&&this._globalMessageService.addBanner({message:e.message,level:2})})),this._service.startListening(),this._updateHeaderBreadcrumb(),this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(Ve.Telemetry.Area,Ve.Telemetry.RunDetails),document.title=(0,o.format)(Pe.TitleSummary,this._run.value.number),this._pageHistoryService.registerObservable(this._pivot,"view",1),this._staticActions.subscribe(this._onActionsUpdate))}componentWillUnmount(){this._pivot.unsubscribe(this._onViewStateChanged),this._service.isDeleted.unsubscribe(this._onRunDeleted),this._run.unsubscribe(this._onRunUpdated),(0,oe.registerErrorHandler)((e=>{})),this._service.stopListening();this.context.pageContext.getService("run-header-breadcrumb-service").clearBreadcrumbs(),this._staticActions.unsubscribe(this._onActionsUpdate),this._contributedActions&&this._contributedActions.unsubscribe(this._onActionsUpdate),(0,pe.clearTreeStateOnUnmount)(this.context.pageContext),this._pageHistoryService.unregisterObservable("view")}_getLegacyConfig(){return{onBuildChanged:e=>{this._extCallbacks.push(e);const t=this._getBuild();t&&t.then((t=>e(t)))},onViewDisplayed:t.RunView.legacyNoop,selectTab:t.RunView.legacyNoop,setSectionVisibility:t.RunView.legacyNoop}}_getCoverageTabUrl(e){if(e&&e.length>0){const t=e.filter((e=>e.id===Ve.CodeCoverageCiTabId));if(t&&t.length>0&&t[0].id)return this._navigationService.getLinkingService().getBuildUrl(this._run.value.id,t[0].id)}return""}_getTestsTabUrl(e){if(e&&e.length>0){const t=e.filter((e=>e.id===Ve.NavTestTabId));if(t&&t.length>0&&t[0].id)return this._navigationService.getLinkingService().getBuildUrl(this._run.value.id,t[0].id)}return""}_getBuild(){if(this._run){return this.context.pageContext.getRestClient("IBuildRestClient").getBuild(this._projectId,this._run.value.id)}}async _initializeActions(){const e=[],t=this._run&&this._run.value;if(t){const s=this._service.getPermissions();this._addRetryActionItems(e,t,s),this._addRunActionItems(e,t,s),this._addCancelActionItems(e,t,s),this._addLogsActionItems(e,t),this._addTagsActionItems(e,t,s),this._addEditActionItems(e,t,s),this._addRetainActionItems(e,t,s),this._addDeleteActionItems(e,t,s)}if(this._staticActions.value=e,t){if(this._contributedActions&&(this._contributedActions.unsubscribe(this._onActionsUpdate),this._contributedActions=new d.ObservableCollection),this._contributedActions.push((0,ge.getMenuItems)(this.context.pageContext,"ms.vss-build-web.run-actions",{runId:t.id,result:t.result,pipelineId:t.pipeline.id,status:t.status,projectId:this._projectId})),2==t.status){const e=await this._getBuild();this._contributedActions.push((0,ge.getMenuItems)(this.context.pageContext,"ms.vss-build-web.build-result-completed-actions-menu",e))}this._contributedActions.push((0,ge.getMenuItems)(this.context.pageContext,"ms.vss-build-web.build-result-actions-menu",this._getLegacyConfig())),this._contributedActions.subscribe(this._onActionsUpdate)}this._onActionsUpdate()}_addRunActionItems(e,t,a){const i=2===t.pipeline.queueStatus,r=this.context.pageContext.getRestClient("IBuildRestClient");t&&a.canRunBuild&&!i&&1!==t.status&&32!==t.status&&e.push({id:"run-pipeline-command",text:Pe.RunPipeline,important:!0,isPrimary:!0,onActivate:(e,a)=>{r.getDefinition(this._projectId,t.pipeline.id).then((e=>{const a=this.context.pageContext.getService("IVssLayoutManager");let i=!(e.repository&&e.repository.type&&e.repository.type.toLowerCase()===J.RepositoryTypes.TfsVersionControl.toLowerCase())&&this._run&&this._run.value&&this._run.value.sourceBranch?this._run.value.sourceBranch:void 0;void 0===i&&(i=e.repository?e.repository.defaultBranch:void 0),a.renderCallout((a=>{const r={definition:e,repository:e.repository,processType:e.process.type,pageContext:this.context.pageContext,project:e.project.id,source:"runs",onSuccess:e=>{this.context.pageContext.getService("IGlobalMessagesService").addBanner({message:(0,o.format)(Pe.RunQueued,e.buildNumber),level:3})},definitionVariables:e.variables,previousRunVariables:this._deserializeVariableData(t.parameters),previousTemplateParameters:t.templateParameters,queue:e.queue,defaultSourceBranch:i,onDismiss:a};return s.createElement(M.CommandComponent,Object.assign({commandType:"ciQueueBuildComponent"},r),null)}))}),oe.handleError)}})}_addRetryActionItems(e,t,s){const a=!t.pipeline||2===t.pipeline.queueStatus;t&&s.canRunBuild&&!a&&1!==t.status&&32!==t.status&&2!=t.result&&4!=t.result&&e.push({id:"retry-pipeline-command",text:Pe.RetryFromFailed,important:!0,isPrimary:!1,onActivate:(e,t)=>{this._confirmAction(Pe.RetryFromFailed,Pe.ConfirmRetryPipeline,(()=>{this._service.retryPipeline()}))}})}_addCancelActionItems(e,t,s){if(s.canCancelBuild&&(1===t.status||32===t.status)){let s="";s=this.state.cancelClicked?Pe.CancelingBuild:Pe.CancelBuild,e.push({id:"nbr-cancel",text:s,disabled:this.state.cancelClicked,important:!0,onActivate:()=>{const e=(0,o.format)(Pe.ConfirmCancelBuild,t.number);this._confirmAction(Pe.CancelBuild,e,(()=>{this.setState({cancelClicked:!0}),this._service.cancelRun()}))}})}}_addLogsActionItems(e,t){if(2===t.status){const s=t.logs&&t.logs.type.toLowerCase()===n.Container;e.push({id:"download-logs-command",text:s||!t.logs?Pe.DownloadAllLogs:Pe.CopyLogsLocation,important:!1,onActivate:()=>{if(t.logs)if(s)(0,he.openLinkSecurely)(t.logs.url+"?$format=zip");else if(document.queryCommandSupported("copy")){const e=document.createElement("textarea");e.value=t.logs.url,document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}else console.error("Browser doesn't allow to copy URL "+t.logs.url);else{this.context.pageContext.getService("IGlobalMessagesService").addToast({duration:2e3,message:Pe.NoLogsToastMessage})}}}),e.push({id:"download-command-divider",important:!1,itemType:1})}}_addTagsActionItems(e,t,s){s.canEditTags&&e.push({id:"nbr-tag",text:0===t.tags.length?Pe.AddTags:Pe.EditTags,important:!1,onActivate:()=>{this.state.showTagsDialog.value=!0}})}_addEditActionItems(e,t,s){const a=this._navigationService.getLinkingService();if(a&&t.pipeline){const i=t.processType===g.ProcessType.Yaml;let r="";if(!(256===t.reason)&&i){const e=this.context.pageContext.getService("ISourceProviderService").getSourceProvider(t.sourceRepositoryType);r=e?e.getBranchText(t.sourceBranch):""}const n=i?a.getYamlPipelineEditUrl(t.pipeline.id,r):a.getDefinitionEditUrl(t.pipeline.id);e.push({id:"edit-pipeline-command",text:s.canEditPipeline?Pe.EditPipeline:Pe.ViewPipeline,important:!1,href:n,onActivate:(e,t)=>{(0,_.onClickFPS)(this.context.pageContext,n,!0,t)}})}}_addRetainActionItems(e,t,s){if(!t.deleted&&(e.push({id:"retain-command-divider",important:!1,itemType:1}),e.push({id:"open-retention-panel-command",important:!1,onActivate:()=>this._onActivateRetentionPanel(s.canRetainBuild),text:Pe.ViewRetentionLeasesMenuItem}),s.canRetainBuild)){const s=this.context.pageContext.getService("IVssPageService").getData();if(s){t.retentionLeases.some((e=>e.leaseOwnerIdentityRef&&e.leaseOwnerIdentityRef.id===s.user.id))?e.push({text:Pe.StopRetainingBuild,id:"run-action-retain",important:!1,onActivate:()=>{this._service.stopRetainingBuild()}}):e.push({text:Pe.RetainBuild,id:"run-action-retain",important:!1,onActivate:()=>{this._service.retainBuild()}})}}}_addDeleteActionItems(e,t,s){0===t.retentionLeases.length&&t.pipeline&&!t.deleted&&s.canDeleteBuild&&e.push({id:"nbr-delete",text:Pe.DeleteRunActionName,important:!1,onActivate:()=>{const e=(0,o.format)(Pe.ConfirmDeleteRun,t.number);this._confirmAction(Pe.DeleteRun,e,(()=>{this._service.deleteRun()}))}})}_updateHeaderBreadcrumb(){const e=this.context.pageContext.getService("IBuildLinkingService"),t=this._run.value.pipeline.name,s=e.getDefinitionUrl(this._run.value.pipeline.id),a=this._run.value.number,i=e.getBuildUrl(this._run.value.id);this.context.pageContext.getService("run-header-breadcrumb-service").setBreadcrumbs(t,s,a,i)}_deserializeVariableData(e){let t;try{t=JSON.parse(e)}catch(e){t={}}return t}}r.Components.add("run-view-content",l)}(),function(e){t[e]={};class s extends x.VssService{constructor(){super(...arguments),this._tabs=new d.ObservableArray,this._tabMap={},this._tabSupportsTasks={},this._extCallbacks=[],this._initialize=async()=>{if(this._data){const e=(0,ye.getContributedItems)(this.pageContext,"ms.vss-build-web.build-results-view",void 0,"ms.vss-build-web.build-results-tab"),t=[];e.forEach((e=>{const s=e.contribution;s.supportsTasks&&s.supportsTasks.length>0&&(this._tabSupportsTasks[e.id]=s.supportsTasks.map((e=>e.toLowerCase()))),t.push((0,_e.processTabContribution)(this.pageContext,{contextualData:this._getLegacyConfig(),props:this._getLegacyConfig(),preProcessTabContribution:this._updateLegacyTab},Object.assign({id:e.id},e.contribution),e.id))}));const s=[];if(Object.keys(this._tabSupportsTasks).length>0){const e=await this._client.getBuildTimeline(this._data.projectId.value,this._data.runId.value);(e&&e.records||[]).filter((e=>"Task"===e.type)).forEach((e=>{let t=e.task&&e.task.id;t||(t=e.id),s.push(t.toLowerCase())}))}const a=[],i=[];t.forEach((e=>{const t=this._tabSupportsTasks[e.id];let r=!0;if(t){r=!1;for(let e=0;e<t.length;e++){const a=t[e];if(s.indexOf(a)>-1){r=!0;break}}}r&&!this._tabMap[e.id]&&(this._tabMap[e.id]=!0,a.push(e)),!r&&this._tabMap[e.id]&&(delete this._tabMap[e.id],i.push(e.id))})),a.length>0&&this._tabs.push(...a),i.length>0&&this._tabs.removeAll((e=>i.indexOf(e.id)>-1))}},this._updateLegacyTab=e=>{const t=this.pageContext.getService("IVssHistoryService");e.url=t.generateUrl({view:e.id}),void 0!==e.order&&(e.order=100+e.order)}}getTabs(e,t){return this._data=t,this._data&&(this._initialize(),this._data.status.subscribe(this._initialize)),this._tabs}_serviceStart(e){super._serviceStart(e),this._client=e.getRestClient("IBuildRestClient")}_serviceEnd(e){super._serviceEnd(e),this._data&&this._data.status.unsubscribe(this._initialize)}_getLegacyConfig(){const e={onBuildChanged:e=>{this._extCallbacks.push(e);const t=this._getBuild();t&&t.then((t=>e(t)))},onViewDisplayed:dt.legacyNoop,selectTab:dt.legacyNoop,setSectionVisibility:dt.legacyNoop};return(0,x.setRemoteSerializationSettings)(e,{proxyFunctions:!0}),e}_getBuild(){return this._client.getBuild(this._data.projectId.value,this._data.runId.value)}}t[e].LegacyRunTabProviderService=s,x.Services.add("legacy-run-tab-provider-service",{serviceFactory:s})}("LegacyRunTabProviderService"),function(e){t.RunLogsService={};const s=e=>`##[${e}]`,a=(e,t)=>"<a class='is-link' href='"+e+"'>"+t+"</a>",r=e=>`##[icon]${e} `,n=s("error"),l=s("warning"),c=s("group"),u=s("endgroup"),h="\n",m=1e4,p="00000000-0000-0000-0000-000000000000";class _ extends x.VssService{constructor(){super(...arguments),this._content={},this._liveContent={},this._jobStatus={},this._phaseLog={},this._jobTestData={},this._jobArtifactData={},this._skipTestCall={},this._skipArtifactsCall={},this._jobCompletedCalls={},this._url={},this._followTail=!0,this._expandedStages={},this._resiliency={},this._lastUpdate=new Date,this._refreshWhenCompleted={},this._expanded={},this._linesFetching={},this._previousTimelines=[],this._previousTimelinesMap={},this.updatedSelection=!1,this._provider="ms.vss-build-web.run-logs-data-provider",this._poolPermissionProvider="ms.vss-build-web.task-agent-pool-security-data-provider",this._parallelismTagKey="ParallelismTag",this._queuePositionKey="QueuePosition",this._private="Private",this._updateNavigation=()=>{this._updateSelection()},this._noLiveCheck=()=>{if(this._isDone())return void this._timer.clearInterval(this._liveCheckTimer);if(this._isCurrentTaskDone()||this._isCurrentStageDone())return;const e=new Date;new Date(e.getTime()-this._lastUpdate.getTime()).getMinutes()>=1&&(console.info("#resiliency3"),this._initialize(!0))},this._liveLogCheck=e=>{const t=this._getCurrentJob();if(!t||t.id!==e.jobId)return;const s=this._rawData.jobs[this._rawData.jobMap[e.jobId]];let a="";if(s&&s.startTime||(a="1"),e.taskId!==e.jobId){const t=this._rawData.tasks[this._rawData.taskMap[e.taskId]];t&&t.startTime||(a="2")}a&&(this._resiliency[a]||(console.info(`#resiliency${a}`,e,this._rawData.jobs,this._rawData.tasks),this._resiliency[a]=!0,this.onLiveTimelineUpdate(this._rawData.timelineId,0,(()=>{delete this._resiliency[a]}))))},this._onSelectionChange=e=>{const t=this._getCurrentJob(e.jobId);if(t){this._updateLogsData(this._rawData.buildId,e.jobId,e.taskId,this._getTasks(t));const s=this._rawData.jobQueueData[t.id];s&&this._signalR.watchPool(s.poolId);const a=this._getRunningSteps(t);this._followTail&&a.length>0&&a.forEach((e=>{this._fetchLinesForStep(t,e)}))}},this._sortRecords=(e,t)=>e.order>t.order?1:e.order<t.order?-1:0,this._getData=e=>(!this._content[e]&&this._url[e]&&(this._content[e]=(0,we.issueRequest)(this._url[e]).then((e=>e.text()))),this._content[e]),this._getLiveData=e=>this._liveContent[e],this._updateSelection=e=>{const t=null!=e?e:this._historyService.getState();let s=t[g.NavConstants.job]||t.jobId;const a=t[g.NavConstants.stage];if(!s){const e=t[g.NavConstants.stage]||"";if(e){const t=this._rawData.phases.find((t=>t.parentId===e));if(t){const e=this._rawData.jobs.find((e=>e.parentId===t.id));s=e&&e.id}}}let i;if(s){const e=this._getJobById(s);if(e){const t=this._getRunningSteps(e);this._followTail&&t&&t.length>0&&t.forEach((e=>{i=e.id}))}}const r=t[g.NavConstants.task]||t.taskId||i;let n=parseInt(t[g.NavConstants.line]||t.line);const o=(e=!1)=>{let t,a;if(r&&(a=this._getTaskById(r)),s&&(t=this._getJobById(s)),!t)return t=this._rawData.jobs[0],void(t&&this.selectJob(t.id));e&&(a?this.selectTask(a.id):this.selectJob(t.id));const i={jobId:t.id,taskId:a?a.id:""};a&&2===a.state&&!n&&a.issues&&a.issues.length&&(n=parseInt(a.issues[0].data&&a.issues[0].data.logFileLineNumber)),r&&(i.taskSelection={key:r,lineToScroll:isNaN(n)?void 0:n}),this._selection=this._notifyData(this._selection,i)},l=s&&this._getJobById(s);if(l||!a)l&&l.stageId&&!this.updatedSelection?(this.updatedSelection=!0,o(!0),this._updateTreeData()):o();else{const e=this._rawData.jobs[0];e&&this.selectJob(e.id);const t=this._rawData.stages[this._rawData.stageMap[a]];t&&Promise.resolve(this._loadAndUpdateAttempts(t)).then((()=>{this.updatedSelection=!0,o(!0),this._updateTreeData()}))}}}get liveContent(){return this._liveContentData}get logsData(){return this._logsData}get treeData(){return this._treeData}get partialData(){return this._partialData}get selection(){return this._selection}get rawData(){return this._rawData}get followTail(){return this._followTail}getLogUrl(e){return this._url[e]}updateApprovals(e){return(0,re.getApprovalClient)(this.pageContext).updateApprovals(e,this._rawData.projectId)}updatePermissions(e,t,s){return(0,ne.getPipelinePermissionsClient)(this.pageContext).updatePipelinePermisionsForResource(e,this._rawData.projectId,t,s).catch(oe.handleError)}refresh(){this._initialize(!0)}createRecord(e,t,s){const a=(0,v.getTimelineStatusIndicatorData)(e.state,e.result,e.stateData&&e.stateData.pendingChecks,e.stateData&&!e.stateData.pendingDependencies),i=a.statusProps;let r;return i.ariaLabel=a.label,(!e.refName||e.refName&&e.refName.indexOf("JobExtension")>-1&&"success"===i.color)&&(r=Object.assign(Object.assign({},i),{color:"system-task"})),{name:e.name,id:e.id,statusProps:r||i,start:e.startTime,end:e.finishTime,isJob:t,isTask:s,issues:e.issues,workerName:e.workerName,state:e.state,result:e.result,percentComplete:e.percentComplete}}createAttemptRecord(e,t,s,a){return{name:t,id:e+t,statusProps:void 0,isJob:s,isTask:a}}createActionRecord(e,t,s,a){return{name:e,id:(0,o.newGuid)(),statusProps:void 0,isJob:t,isTask:s,onClick:a}}createTask(e,t){const s=t.id;this._updateUrl(e,s,t.logId);const a=this.createRecord(t,!1,!0),i=!!this.getLogUrl(s)||!!this._liveContent[s]||4===t.result&&!!t.message;return null!=this._expanded[s]&&this._expanded[s]||(this._expanded[s]=1===t.state),{key:s,title:t.name,isExpanded:this._expanded[s],getData:()=>{if(2!==t.state){const e=this._getData(s);return e?(this._refreshWhenCompleted[s]=!0,new Promise((async(t,a)=>{t(await e+this._getLiveData(s))}))):this._getLiveData(s)}return 4===t.result?t.message:(delete this._liveContent[s],this._refreshWhenCompleted[s]&&(delete this._refreshWhenCompleted[s],delete this._content[s]),this._getData(s))},statusProps:(0,v.getTimelineStatusIndicatorData)(t.state,t.result).statusProps,hasData:i,payload:Object.assign({jobId:t.parentId,stageId:t.stageId},a),hidden:!0}}selectJob(e){const t=this._historyService.getState();delete t[g.NavConstants.line],delete t[g.NavConstants.task],delete t[g.NavConstants.stage],t[g.NavConstants.job]=e;const s=this._getJobById(e);s&&s.stageId&&(t[g.NavConstants.stage]=s.stageId+""),this._historyService.replaceState(t),this._updateSelection()}selectTask(e){const t=this._historyService.getState();delete t[g.NavConstants.line],delete t[g.NavConstants.task],delete t[g.NavConstants.stage];const s=this._getTaskById(e);if(s){if(this._getJobById(s.parentId))t[g.NavConstants.job]=s.parentId;else{const e=this._getTaskById(s.parentId);e&&(t[g.NavConstants.job]=e.parentId)}}t[g.NavConstants.task]=e,s&&s.stageId&&(t[g.NavConstants.stage]=s.stageId+""),this._historyService.replaceState(t),this._updateSelection()}setFollowTail(e){this._followTail=e}expandStage(e){this._expandedStages[e.data.id]=!!e.expanded}onLiveContent(e){if(e.timelineId!==this._rawData.timelineId)return;const t=this._selection.value&&this._selection.value.jobId,s=this._selection.value&&this._selection.value.taskId;if(this._lastUpdate=new Date,e.taskId===p&&t)for(let s=0;s<this._rawData.tasks.length;s++){const a=this._rawData.tasks[s];if(a.parentId===t&&1===a.state){e.taskId=a.id;break}}if(e.taskId!==p){t===e.jobId&&this._initJobPendingReason(this._getCurrentJob()),this._liveLogCheck(e);let a=this._liveContent[e.taskId]||"";a=a.length>0?a+"\n":"",this._liveContent[e.taskId]=a+e.content,this._followTail&&t===e.jobId&&s!=e.taskId&&this.selectTask(e.taskId),t===e.jobId&&(this._liveContentData.value=e)}}onLiveTimelineUpdate(e,t,s){e===this._rawData.timelineId&&(this._marker||(this._marker=t),this._marker<t&&(this._marker=t),this._lastUpdate=new Date,this._initNoLiveCheck(),this._fetchTimeline(this._marker).then((e=>{if(e){this._marker<e.changeId&&(this._marker=e.changeId);const t=[],a=[],i=[],r=[],n=[],o=[],l=[],c=[];this._merge(e.stages,this._rawData.stages,this._rawData.stageMap,t,n),this._merge(e.phases,this._rawData.phases,this._rawData.phaseMap,a,o,(e=>{this._updateOrder(e,m,this._rawData.stageMap,this._rawData.stages)})),this._merge(e.jobs,this._rawData.jobs,this._rawData.jobMap,i,l,(e=>{if(this._updateOrder(e,1e5,this._rawData.phaseMap,this._rawData.phases),"Job"===e.name){const t=this._rawData.phases[this._rawData.phaseMap[e.parentId]];t&&t.name&&t.name!==e.name&&t.name.length>0&&(e.name=t.name)}})),this._merge(e.tasks,this._rawData.tasks,this._rawData.taskMap,r,c,(e=>{this._updateOrder(e,1e6,this._rawData.jobMap,this._rawData.jobs)})),this._normalizeRawData(),this._updateTreeData(),this._ensureSelection();const u=this._getCurrentJob(),d=this._getCurrentTask();let h,p;d&&(h=d&&(r.indexOf(d.id)>-1||c.indexOf(d.id)>-1)),u&&(p=i.indexOf(u.id)>-1||l.indexOf(u.id)>-1),u&&(p&&this._followTail||h)&&(this._updateLogsData(this._rawData.buildId,u.id,d?d.id:"",this._getTasks()),2!==u.state||this._jobCompletedCalls[u.id]||(this._jobCompletedCalls[u.id]=!0,this._updateArtifacts(u,!0),this._updateTestData(u,this._rawData.phases[this._rawData.phaseMap[u.parentId]],!0))),s&&s()}})))}onLiveRequestUpdate(e,t,s){const a=this._getCurrentJob(t.jobId);if(a){const e=this._jobStatus[a.id];let i=!1;if(e)e.poolId===t.poolId&&e.requestId===t.requestId&&(i=!0);else if(s){const e=this._rawData.jobQueueData[a.id];if(e)t.poolId===e.poolId&&(i=!0);else{const e={};e[g.NavConstants.buildId]=this._rawData.buildId+"",e[g.NavConstants.update]=g.NavConstants.jobQueueData,this._contributionService.getDataAsync(this._provider,e,!0).then((e=>{if(e){const s=e;this._rawData.jobQueueData=s.jobQueueData||this._rawData.jobQueueData||{};const i=this._rawData.jobQueueData[a.id];i&&t.poolId===i.poolId&&this._initJobPendingReason(a)}}))}}i&&this._initJobPendingReason()}}onLiveAgentStatusUpdate(e,t){const s=this._getCurrentJob();if(s){const e=this._jobStatus[s.id];e&&e.matchedAgents.indexOf(t)>-1&&this._initJobPendingReason()}}_serviceStart(e){super._serviceStart(e),this._timer=new ue.TimerManagement,this._liveLogCheck=this._timer.throttle(this._liveLogCheck,600),this._partialData=new d.ObservableValue(void 0),this._selection=new d.ObservableValue(void 0),this._liveContentData=new d.ObservableValue(void 0),this._selection.subscribe(this._onSelectionChange),this._contributionService=this.pageContext.getService("IVssContributionService"),this._historyService=this.pageContext.getService("IVssHistoryService"),this._signalR=this.pageContext.getService("ISignalRService"),this._extService=this.pageContext.getService("IRunExternalService"),this._linking=this.pageContext.getService("IBuildLinkingService"),this._historyService.subscribe(this._updateNavigation),this._dtClient=(0,Re.getTaskAgentClient)(this.pageContext),this._initialize()}_serviceEnd(e){super._serviceEnd(e),this._selection.unsubscribe(this._onSelectionChange),this._historyService.unsubscribe(this._updateNavigation),this._timer.dispose()}getCurrentJobId(){const e=this._getCurrentJob();if(e)return e.refName}getCurrentPhaseId(){const e=this._getCurrentJob(),t=e&&this._rawData.phases[this._rawData.phaseMap[e.parentId]];if(t)return t.refName}_getCurrentStage(){const e=this._getCurrentJob();if(e)return this._getStageRecord(e)}getCurrentStageId(){const e=this._getCurrentStage();if(e)return e.refName}getCurrentStageName(){const e=this._getCurrentStage();if(e)return e.originalName}bumpJobPriority(e){const t=this._jobStatus[e].poolId,s=this._jobStatus[e].requestId;this._dtClient.updateAgentRequest({requestId:s},t,s,p,1).then((e=>{this._initJobPendingReason()}))}canPriorityBeBumped(e){const t=this._jobStatus[e];return(0,b.isFeatureFlagEnabled)(this.pageContext,"DistributedTask.BumpAgentRequestPriority",!1)&&t&&this._security.hasManageAgentPoolPermission(t.poolId)&&void 0!==t.data[this._queuePositionKey]&&parseInt(t.data[this._queuePositionKey])>1}_ensureSelection(){if(this._resetPhaseSelection){const e=(this._rawData.jobs||[]).find((e=>e.parentId===this._resetPhaseSelection));e&&(this.selectJob(e.id),this._resetPhaseSelection=void 0)}}_initialize(e=!1){const t=e?void 0:this._contributionService.getData(this._provider);if(t)this._permissionsStore=new ce.PermissionsStore({pageContext:this.pageContext}),this._security=new le.Security({projectId:t.projectId,store:this._permissionsStore}),this._initializeData(t);else if(this._rawData){const e={};e[g.NavConstants.buildId]=this._rawData.buildId+"",this._contributionService.getDataAsync(this._provider,e,!0).then((e=>{e&&this._initializeData(e)}))}}_initializeData(e){this._rawData=e;const t=this._historyService.getState();this._rawData.jobs.map((async e=>{var s;await(null===(s=e.previousAttempts)||void 0===s?void 0:s.forEach((async e=>{await this._loadAndUpdateAttempts({},null==e?void 0:e.timelineId),t[g.NavConstants.job]===e.recordId&&this._previousTimelines&&this._updateSelection(t)})))})),this._normalizeRawData(),console.log(this._rawData),this._initNoLiveCheck(),this._updateSelection(t),this._updateSelection(),this._updateTreeData()}_fetchTimeline(e,t,s){const a={};return a[g.NavConstants.buildId]=this._rawData.buildId+"",a[g.NavConstants.timelineId]=t||this._rawData.timelineId,a[g.NavConstants.changeId]=e+"",a[g.NavConstants.fullTimeline]=!!s+"",this._contributionService.getDataAsync("ms.vss-build-web.run-timeline-data-provider",a)}async _loadAndUpdateAttempts(e,t){const s={};s[g.NavConstants.buildId]=this._rawData.buildId.toString(),e.refName&&(s[g.NavConstants.stageName]=e.refName),t&&(s.timelineId=t);const a=await this._contributionService.getDataAsync("ms.vss-build-web.run-attempts-data-provider",s);a&&(e.id?a.forEach((t=>{t&&this._addPreviousTimeline(t,e)})):a&&a.forEach((e=>{e.stages.forEach((t=>this._addPreviousTimeline(e,t)))})))}_fetchLines(e,t,s){const a={};return a[g.NavConstants.planId]=this._rawData.planId,a[g.NavConstants.timelineId]=this._rawData.timelineId,a[g.NavConstants.jobId]=e,a[g.NavConstants.stepId]=t,s&&(a[g.NavConstants.continuationToken]=s),this._contributionService.getDataAsync("ms.vss-build-web.run-lines-data-provider",a)}_normalizeRawData(){let e=!1;this._rawData.stages=(this._rawData.stages||[]).sort(this._sortRecords),this._rawData.phases=(this._rawData.phases||[]).sort(this._sortRecords),this._rawData.jobs=(this._rawData.jobs||[]).sort(this._sortRecords),this._rawData.tasks=(this._rawData.tasks||[]).sort(this._sortRecords),this._rawData.stageMap=this._rawData.stageMap||{},this._rawData.phaseMap=this._rawData.phaseMap||{},this._rawData.jobMap=this._rawData.jobMap||{},this._rawData.taskMap=this._rawData.taskMap||{},this._rawData.jobQueueData=this._rawData.jobQueueData||{},this._updateMaps(),this._rawData.stages.forEach((e=>{e.previousAttempts=e.previousAttempts.sort(((e,t)=>t.attempt-e.attempt))}));const t=new Set;this._rawData.jobs.forEach((e=>{e.id!==e.parentId&&t.add(e.parentId)}));const s=this._rawData.jobs.slice();t.forEach((t=>{const a=this._rawData.jobMap[t],i=s[a];i&&i.id===i.parentId&&(this._selection.value&&this._selection.value.jobId===i.id&&(this._resetPhaseSelection=i.id),delete this._rawData.jobMap[t],s.splice(a,1),e=!0,s.forEach(((e,t)=>{this._rawData.jobMap[e.id]=t})))})),e&&(this._rawData.jobs=s.sort(this._sortRecords),this._updateMaps())}_updateMaps(){this._rawData.stages.forEach(((e,t)=>{this._rawData.stageMap[e.id]=t})),this._rawData.phases.forEach(((e,t)=>{this._rawData.phaseMap[e.id]=t})),this._rawData.jobs.forEach(((e,t)=>{this._rawData.jobMap[e.id]=t})),this._rawData.tasks.forEach(((e,t)=>{this._rawData.taskMap[e.id]=t}))}_merge(e,t,s,a,i,r){(e||[]).forEach((e=>{r&&r(e);const n=s[e.id];void 0!==n?(t[n]=e,a.push(e.id),s[e.id]=n):(t.push(e),i.push(e.id))}))}_initNoLiveCheck(){this._isDone()?this._liveCheckTimer&&this._timer.clearInterval(this._liveCheckTimer):this._liveCheckTimer||(this._liveCheckTimer=this._timer.setInterval(this._noLiveCheck,6e4))}_isDone(){let e=!0;for(let t=0;t<this._rawData.stages.length;t++){if(2!==this._rawData.stages[t].state){e=!1;break}}return e}_isCurrentTaskDone(){const e=this._getCurrentTask();return 2===(null==e?void 0:e.state)}_isCurrentStageDone(){const e=this._getCurrentStage();return 2===(null==e?void 0:e.state)}_updateOrder(e,t,s,a){const i=s&&s[e.parentId];return void 0!==i&&(e.order=e.originalOrder+t*a[i].originalOrder),e}_getCurrentJob(e){const t=e||this._selection.value&&this._selection.value.jobId;if(t)return this._getJobById(t)}_getCurrentTask(e){const t=e||this._selection.value&&this._selection.value.taskId;if(t)return this._getTaskById(t)}_getJobSection(e){const t=this.createRecord(e,!0,!1);let s="";s+=(t.issues||[]).map((e=>{const t=(0,ke.escape)(e.message);let s="";return 1===e.type&&(s+=n+t),2===e.type&&(s+=l+t),s+h}));let i=t.start;if(!i&&0!==e.state){const t=this._rawData.phases[this._rawData.phaseMap[e.parentId]];if(t&&(i=t.startTime,!i)){const e=this._rawData.stages[this._rawData.stageMap[t.parentId]];e&&(i=e.startTime)}}const d=this._rawData.jobQueueData[e.id];if(d){const e=this._getPoolUrl(d.id),t=d.poolName||d.name||d.poolId+"";s+=(0,o.format)(Pe.JobInfoPool,a(e,(0,ke.escape)(t))),s+=h,d.imageName&&(s+=(0,o.format)(Pe.JobInfoImage,(0,ke.escape)(d.imageName)),s+=h)}const m=this._jobStatus[e.id];if(d&&m){const e=this.pageContext.getService("IVssPageService").getData();if(void 0===e||e.isHosted){const e=m.data[this._parallelismTagKey]||this._private,t=this._getParallelJobsUrl(d.isHosted,e);s+=(0,o.format)(Pe.JobInfoQueued,(0,V.ago)(m.queueTime,1),a(t,Pe.ParallelJobsLinkText)),s+=h}else s+=(0,o.format)(Pe.JobInfoQueuedOnPrem,(0,V.ago)(m.queueTime,1)),s+=h}t.workerName&&(s+=(0,o.format)(Pe.JobInfoAgent,(0,ke.escape)(t.workerName)),s+=h),i&&(s+=(0,o.format)(Pe.JobInfoStart,(0,V.ago)(i,1)),s+=h,2===t.state&&(s+=(0,o.format)(Pe.JobInfoDuration,(0,V.duration)(i,t.end)),s+=h)),m&&(s+=h+m.statusMessage);const p=this._rawData.phases[this._rawData.phaseMap[e.parentId]];if(p&&p.logId&&(this._phaseLog[p.id]?s+=h+c+Pe.PrepareJob+h+this._phaseLog[p.id]+h+u:s+=h,p.logId&&this._updatePhaseLog(e,p)),this._rawData.parameters)try{const e=/\,(?!\s*?[\{\[\"\'\w])/g,t=JSON.parse((this._rawData.parameters||"").replace(e,"")),a=Object.keys(t).length;if(this._rawData.queueStatus>0)s+=Pe.PipelinePaused;else if(a>0){const e=a>1?Pe.QueueTimeVariablesGroup:Pe.QueueTimeVariableGroup,i=(0,o.format)(e,a)+h,n=Object.keys(t).reduce(((e,s)=>e+s+" : "+(t[s]||"undefined")+h),"");s+=h+c+r("Variable")+i+n+h+u}}catch(e){}if(this._rawData.templateParameters)try{const e=this._rawData.templateParameters,t=Object.keys(e).length;if(t>0){const a=(0,o.format)(Pe.RuntimeParameterGroup,t)+h,i=Object.keys(e).reduce(((t,s)=>t+s+" : "+(JSON.stringify(e[s])||"undefined")+h),"");s+=h+c+r("Variable")+a+i+h+u}}catch(e){}this._updateArtifacts(e);const _=this._jobArtifactData[e.id];if(_&&_.publishedArtifactsCount>0){const t=this._jobArtifactData[e.id].publishedArtifactsCount,i=t>1?Pe.ArtifactsCount:Pe.ArtifactCount,n=this._linking.getBuildUrl(this._rawData.buildId,g.NavConstants.artifacts,void 0,void 0,{pathAsName:"false"}),l=a(n,(0,o.format)(i,t)),c=(0,o.format)(Pe.ArtifactsCountFormat,l);s+=h+r("Package")+c}this._updateTestData(e,p);const v=this._jobTestData[e.id];if(v&&v.testsCount>0){const t=a(this._extService.getTestTabLink(this._rawData.buildId),(0,o.format)(Pe.TestResultTestsFormat,P.TestReportDataParser.getCustomizedDecimalValueInCurrentLocale(this._jobTestData[e.id].testsPassRate,1))),i=(0,o.format)(Pe.TestResultPassedFormat,t);s+=h+r("TestBeaker")+i}return e.message&&(s+=e.message),this._liveContent[e.id]&&(s+=h+Pe.JobLiveData+h+this._liveContent[e.id]+h),s?{key:e.id,title:Pe.JobInformation,iconProps:{iconName:"Processing"},hasData:!0,isExpanded:!0,getData:()=>s,showHtml:!0,noAutoScroll:!0,hidden:!0}:null}_getPoolUrl(e){return(0,i.routeUrl)(this.pageContext,"ms.vss-build-web.run-pools-route",{project:this._rawData.projectId,queueId:e+""})}_getParallelJobsUrl(e,t){return(0,i.routeUrl)(this.pageContext,"ms.vss-build-web.build-queue-route",{project:this._rawData.projectId,isHosted:e+"",parallelismTag:t})}_fetchLinesForStep(e,t,s){this._fetchLines(e.id,t.id,s).then((s=>{if(s){const a=this._getRunningSteps(e).find((e=>e.id===s.stepId));if(a&&s.timelineId===this._rawData.timelineId&&s.stepId===a.id){let i,r=s.content||"";if(1===s.startLine&&this._liveContent[s.stepId]&&r.length<this._liveContent[s.stepId].length?r=this._liveContent[s.stepId]:this._liveContent[s.stepId]=1===s.startLine?r:r+(this._liveContent[s.stepId]||""),this._liveContentData.value={content:r,jobId:e.id,taskId:s.stepId,timelineId:s.timelineId},s.continuationToken?(i=this.createTask(this._rawData.buildId,a),i.asyncInfo={getMore:s=>{this._linesFetching[s]||(this._linesFetching[s]=!0,this._fetchLinesForStep(e,t,s))},hasMore:!0,payload:s.continuationToken}):(i=this.createTask(this._rawData.buildId,a),i.asyncInfo=void 0),this._selection.value&&(this._selection.value.taskId===s.stepId||this._selection.value.jobId===e.id&&""===this._selection.value.taskId)){const e={updatedSections:[i]};this._partialData=this._notifyData(this._partialData,e)}}}}))}_getRunningSteps(e){return this._getTasks(e,(e=>1===e.state))}_updateUrl(e,t,s){s&&(this._url[t]=this._getUrl(e,t,s))}_getUrl(e,t,s){return(0,i.routeUrl)(this.pageContext,"ms.vss-build-web.run-build-logsapi-route",{project:this._rawData.projectId,buildId:e+"",logId:s+""})}async _updateTestData(e,t,s){if(t&&(s||!this._jobTestData[e.id]&&!this._skipTestCall[e.id])){const s=this._rawData.stages[this._rawData.stageMap[t.parentId]];try{const a=await this._extService.getTestsResultsForJob(this._rawData.buildId,{jobName:e.refName,phaseName:t.refName,stageName:s.refName});a&&this._selection.value&&(this._jobTestData[e.id]=a,this._selection.value.jobId===e.id&&""===this._selection.value.taskId&&this._updateJobSection(e)),2===e.state&&(this._skipTestCall[e.id]=!0)}catch(t){this._skipTestCall[e.id]=!0}}}async _updatePhaseLog(e,t){if(!this._phaseLog[t.id]&&t&&t.logId){const s=await(0,we.issueRequest)(this._getUrl(this._rawData.buildId,t.id,t.logId));let a=(0,ke.escape)(await s.text()).split("\n");a=a.splice(1,a.length),a=a.splice(0,a.length-2),this._phaseLog[t.id]=a.join("\n"),this._selection.value&&this._selection.value.jobId===e.id&&""===this._selection.value.taskId&&this._updateJobSection(e)}}async _updateArtifacts(e,t){if(t||!this._jobArtifactData[e.id]&&!this._skipArtifactsCall[e.id]){const t={};t[g.NavConstants.buildId]=this._rawData.buildId+"",t.source=e.id,2===e.state&&(this._skipArtifactsCall[e.id]=!0);const s=await this._contributionService.getDataAsync("ms.vss-build-web.run-details-artifacts-data-provider",t,!0);s&&this._selection.value&&(this._jobArtifactData[e.id]=s,this._selection.value.jobId===e.id&&""===this._selection.value.taskId&&this._updateJobSection(e))}}_updateJobSection(e){const t=this._getJobSection(e);if(t){const e={buildId:this._logsData.value.buildId,job:this._logsData.value.job,stage:this._logsData.value.stage,message:this._logsData.value.message,sections:[t]};this._logsData=this._notifyData(this._logsData,e)}}_getStageRecord(e){const t=this._rawData.phases[this._rawData.phaseMap[e.parentId]],s=e.stageRef,a=e.timelineId;if(t)return this._rawData.stages[this._rawData.stageMap[t.parentId]];if(s&&a){return this._previousTimelines[this._previousTimelinesMap[s][a]].stages.find((e=>e.refName=s))}}_updateLogsData(e,t,s,a){const i=this._getCurrentJob(t);if(!i)return;this._rawData.phases[this._rawData.phaseMap[i.parentId]];let r=[];const n=this._getTaskById(s);if(n)r.push(this.createTask(e,n));else{const e=this._getJobSection(i);e&&r.unshift(e)}0==r.length&&(r=[{key:"",title:"",hasData:!0,isExpanded:!0,hidden:!0,className:"empty-sec",noAutoScroll:!0,getData:()=>4==i.result?Pe.SkippedJobLogs:this._rawData.queueStatus?Pe.PipelinePaused:Pe.NoLogs}]);const o=this._getStageRecord(i);let l;o&&(l=Object.assign(Object.assign({},this.createRecord(o,!1,!1)),{checks:o.checks||[]}));const c=n?{buildId:e,job:this.createRecord(n,!1,!0),stage:l,sections:r}:{buildId:e,job:this.createRecord(i,!0,!1),stage:l,sections:r},u=this._getPhaseById(i.parentId);o&&u&&(o.attempt>u.attempt||o.attempt>i.attempt)&&o.startTime&&i.startTime&&o.startTime>i.startTime&&(c.message=Pe.OldJobAttempt),this._logsData=this._notifyData(this._logsData,c),this._initJobPendingReason(i)}_updateTreeData(){const e=this._rawData.jobs,t=this._rawData.phases,s=this._rawData.stages,a=this._rawData.tasks,i={items:[]},r={},n={};1==s.length&&"__default"===s[0].refName&&(s[0].name=Pe.JobsTitle),s.forEach(((e,t)=>{const s={data:this.createRecord(e,!1,!1)};e.previousAttempts.length>0&&(n[e.id]=n[e.id]||{},s.childItems=[],s.childItems.push({data:this.createAttemptRecord(e.refName,(0,o.format)(Pe.AttemptNumber,e.attempt),!1,!1)}),n[e.id][e.attempt]=0,this._previousTimelinesMap[e.refName]?e.previousAttempts.forEach(((t,a)=>{s.childItems=s.childItems||[],s.childItems.push({data:this.createAttemptRecord(e.refName,(0,o.format)(Pe.AttemptNumber,t.attempt),!1,!1)}),n[e.id][t.attempt]=a+1})):s.childItems.push({data:this.createActionRecord(Pe.ShowPreviousAttempts,!1,!1,(()=>{Promise.resolve(this._loadAndUpdateAttempts(e)).then((()=>{this._updateTreeData()}))}))})),i.items.push(s),r[e.id]=t}));const l={};t.forEach((e=>{l[e.id]=e.parentId}));const c=this._selection&&this._selection.value&&this._selection.value.jobId;e.forEach((e=>{this._updateUrl(this._rawData.buildId,e.id,e.logId);const t=c===e.id,s=l[e.parentId],o=r[s],u={data:this.createRecord(e,!0,!1),expanded:t};if(a.filter((e=>e.parentId===u.data.id)).forEach((e=>{void 0===u.childItems&&(u.childItems=[]);const t={data:this.createRecord(e,!1,!0),expanded:!1};u.childItems.push(t),a.forEach((e=>{e.parentId===t.data.id&&(void 0===t.childItems&&(t.childItems=[]),t.childItems.push({data:this.createRecord(e,!1,!0),expanded:!1}))}))})),void 0!==o){let e=i.items[o];(t||this._expandedStages[s])&&(e.expanded=!0,this._expandedStages[e.data.id]=!0),s in n&&(e.childItems=e.childItems||[],e=e.childItems[0],(t||this._expandedStages[e.data.id])&&(e.expanded=!0,this._expandedStages[e.data.id]=!0)),e.childItems=e.childItems||[],e.childItems.push(u)}else i.items.push(u)})),s.forEach((e=>{if(e.refName in this._previousTimelinesMap)for(const t of e.previousAttempts){const s=this._previousTimelinesMap[e.refName][t.timelineId],o=this._previousTimelines[s];void 0!==o&&o.jobs.forEach((s=>{const l=c===s.id,u=r[e.id],d=i.items[u],h=n[e.id][t.attempt];d.childItems=d.childItems||[];const m=d.childItems[h],p={data:this.createRecord(s,!0,!1),expanded:l};(l||this._expandedStages[m.data.id])&&(m.expanded=!0,this._expandedStages[m.data.id]=!0);o.tasks.filter((e=>e.parentId===p.data.id)).forEach((e=>{void 0===p.childItems&&(p.childItems=[]);const t={data:this.createRecord(e,!1,!0),expanded:!1};p.childItems.push(t),a.forEach((e=>{e.parentId===t.data.id&&(void 0===t.childItems&&(t.childItems=[]),t.childItems.push({data:this.createRecord(e,!1,!0),expanded:!1}))}))})),m.childItems=m.childItems||[],m.childItems.push(p)}))}})),this._treeData=this._notifyData(this._treeData,i)}_initJobPendingReason(e){if(!(e=e||this._getCurrentJob()))return;const t=this._rawData.jobQueueData[e.id];if(t&&2!==e.state&&1!==e.state){const s=this._jobStatus[e.id];s?this._dtClient.getAgentRequest(t.poolId,s.requestId,!0).then((t=>{e&&this._updateJobPendingReason(e,t)})):this._dtClient.getAgentRequestsForPlan(t.poolId,this._rawData.planId).then((s=>{const a=s.find((t=>t.jobId===e.id));a&&this._dtClient.getAgentRequest(t.poolId,a.requestId,!0).then((s=>{const a={};a[g.NavConstants.poolId]=t.poolId+"",this._contributionService.getDataAsync(this._poolPermissionProvider,a).then((()=>{e&&this._updateJobPendingReason(e,s)}))}))}))}}_updateJobPendingReason(e,t){const s=this._selection.value&&this._selection.value.jobId;e.id===s&&(this._jobStatus[e.id]={poolId:t.poolId,requestId:t.requestId,matchedAgents:(t.matchedAgents||[]).map((e=>e.id)),statusMessage:t.statusMessage,data:t.data,queueTime:t.queueTime,priority:t.priority},this._selection.value&&this._selection.value.jobId===e.id&&""===this._selection.value.taskId&&this._updateJobSection(e))}_getTasks(e,t){const s=[];e&&!(e.id in this._rawData.jobMap)||s.push(...this._rawData.tasks),e&&e.id in this._rawData.jobMap||this._previousTimelines.forEach((e=>{s.push(...e.tasks)}));const a=[],i=[];return s.forEach((s=>{t&&!t(s)||e&&s.parentId!==e.id?i.push(s):a.push(s)})),a.forEach((e=>{const t=i.find((t=>e.id===t.parentId));t&&a.push(t)})),a}_getPhaseById(e,t=!0){return e in this._rawData.phaseMap?this._rawData.phases[this._rawData.phaseMap[e]]:t?this._getRecordFromPreviousTimeline(e,(e=>e.phases)):void 0}_getJobById(e,t=!0){return e in this._rawData.jobMap?this._rawData.jobs[this._rawData.jobMap[e]]:t?this._getRecordFromPreviousTimeline(e,(e=>e.jobs)):void 0}_getTaskById(e,t=!0){return e in this._rawData.taskMap?this._rawData.tasks[this._rawData.taskMap[e]]:t?this._getRecordFromPreviousTimeline(e,(e=>e.tasks)):void 0}_getRecordFromPreviousTimeline(e,t){for(const s of this._previousTimelines){const a=t(s).find((t=>t.id===e));if(a)return a}}_addPreviousTimeline(e,t){e.timelineId!=this._rawData.timelineId&&(t=t||e.stages[0],e.jobs.forEach((s=>{const a=s;a.timelineId=e.timelineId,a.stageId=t?t.id:void 0,a.stageRef=t?t.refName:void 0})),e.tasks.forEach((s=>{const a=s;a.timelineId=e.timelineId,a.stageId=t?t.id:void 0,a.stageRef=t?t.refName:void 0})),e.jobs=e.jobs.sort(this._sortRecords),e.tasks=e.tasks.sort(this._sortRecords),this._previousTimelinesMap[t.refName]=this._previousTimelinesMap[t.refName]||{},this._previousTimelinesMap[t.refName][e.timelineId]=this._previousTimelines.push(e)-1)}_notifyData(e,t){return e&&(e.value=t),e||new d.ObservableValue(t)}}t.RunLogsService.RunLogsService=_,x.Services.add("IRunLogsService",{serviceFactory:_})}(),function(e){t.ComponentsLogsView={};const a=(e,t,a,i)=>{const r=i.underlyingItem.data,n=r,l=r,c=n.percentComplete&&!n.end?s.createElement("span",null,(0,o.format)(Pe.PercentComplete,n.percentComplete)):void 0,u=n.start?s.createElement(w.Duration,{startDate:n.start,endDate:n.end}):void 0,d=s.createElement("div",{className:"job-detail text-ellipsis flex body-m flex-row flex-grow "+(r.isJob||r.isTask?"is-job":"")},s.createElement(R.Tooltip,{text:r.name},s.createElement("div",{className:"flex flex-center flex-grow text-ellipsis job-name-area"},(r.isJob||r.isTask)&&s.createElement(f.Status,Object.assign({},r.statusProps,{className:"icon-large-margin",size:"16"})),s.createElement(h.Link,{className:"text-ellipsis",subtle:!l.onClick,onClick:l.onClick},s.createElement("span",null,r.name)))),s.createElement("div",{className:"job-duration flex flex-self-end"},c||u));return(0,De.ExpandableTreeCell)({children:d,columnIndex:t,treeColumn:a,treeItem:i,className:"run-tree-cell "+(r.isJob?"run-job-cell":"")})},i=(e,t)=>s.createElement("th",{"aria-colindex":e,"aria-readonly":"true",className:"body-m bolt-table-header-cell col-header-0","data-column-index":"0","data-focuszone":"false",tabIndex:-1,key:t.id},s.createElement("div",{className:"bolt-table-header-cell-content flex-row"},s.createElement("div",{className:"bolt-table-header-cell-text text-ellipsis body-m"},t.name)));class n extends r.VssComponent{constructor(e,t){super(e,t),this._reader=s.createRef(),this._commandsUpdate=new d.ObservableValue(!1),this._searchActive=!1,this._searchText=new d.ObservableValue(""),this._search=s.createRef(),this._showTimestamps=new d.ObservableValue(!1),this._showChecksPanel=new d.ObservableValue(!1),this._checkListItemType=new d.ObservableValue(3),this._showMasterPanelXSmallScreen=new d.ObservableValue(!0),this._onReviewClick=e=>{this._showChecksPanel.value=!0,this._checkListItemType.value=3,this._activeElement=document.activeElement},this._onChecksPanelDismiss=()=>{this._showChecksPanel.value=!1,this._activeElement&&(this._activeElement.focus(),this._activeElement=void 0)},this._onSubmitBulkApproval=e=>{this._service.updateApprovals(e).then((e=>{e&&(this._service.refresh(),this._onChecksPanelDismiss())})).catch(oe.handleError)},this._onReassignApprovals=e=>this._service.updateApprovals(e).then((e=>{if(e)return this._service.refresh(),this._onChecksPanelDismiss(),this._globalMessageService.addToast({message:Pe.ApprovalReassigned,duration:5e3,forceOverrideExisting:!0}),Promise.resolve()}),(e=>Promise.reject(e))),this._onPermitResource=(e,t,s)=>{this._service.updatePermissions(e,t,s).then((e=>{e&&(this._globalMessageService.addToast({message:Pe.PermissionGranted,duration:5e3,forceOverrideExisting:!0}),this._service.refresh())}))},this._onDown=()=>{this._reader.current&&this._reader.current.toEnd()},this._onUp=()=>{this._reader.current&&this._reader.current.toHome()},this._onSearch=(e,t)=>{this._reader.current&&(this._searchText.value=t,this._reader.current.find(t))},this._onKeyDown=e=>{const t=e.key.toLowerCase();(e.metaKey||e.ctrlKey)&&"f"===t&&(this._showFind(),e.preventDefault())},this._onSearchKeyDown=e=>{const t=e.key.toLowerCase(),s=this._reader.current;"escape"===t?this._hideFind():e.shiftKey&&"enter"===t?s&&s.findPrev():"enter"===t?s&&s.findNext():"tab"==t&&requestAnimationFrame((()=>{const e=document.getElementById("__bolt-log-up");e&&e.focus()}))},this._getFarRight=e=>{const t=e.payload;return t&&t.start?s.createElement(w.Duration,{startDate:t.start,endDate:t.end}):null},this._getLeftHeader=()=>{const e=this._service.rawData;return s.createElement(xe.SingleLayerMasterPanelHeader,{title:(0,o.format)(Pe.JobsInRun,e.buildNumber),subTitle:e.definitionName,onBackButtonClick:this._onBackClick})},this._getLeftContent=()=>{let e=[];return this._service.treeData.value.items.forEach(((t,r)=>{this._selection.push(new F.ListSelection(!1)),e.push(s.createElement(c.Observer,{data:this._service.treeData,key:t.data.id},(e=>{const n=new Ee.TreeItemProvider(e.data.items[r].childItems||[]);return s.createElement(De.Tree,{key:t.data.id,showHeader:!0,columns:[{hierarchical:!0,id:t.data.id,renderCell:a,name:t.data.name,renderHeaderCell:i,headerClassName:"body-m",width:-100}],itemProvider:n,selection:this._selection[r],onToggle:(e,t)=>{const s=t.underlyingItem;!e.currentTarget.className.includes("expand-button")&&s.expanded||n.toggle(s),s.data.isJob?this._service.selectJob(s.data.id):s.data.isTask&&this._service.selectTask(s.data.id)},onSelect:(e,t)=>{const s=t.data.underlyingItem.data,a=this._service.selection.value&&this._service.selection.value.jobId;1===s.state&&a!==s.id||0===s.state?this._service.setFollowTail(!0):this._service.setFollowTail(!1),s.isJob?this._service.selectJob(s.id):s.isTask&&this._service.selectTask(s.id),this._showMasterPanelXSmallScreen.value=!1},scrollable:!0})})))})),s.createElement("div",{className:"run-logs-tree flex-grow flex-"},e)},this._onLogsDataChange=e=>(this._normalize(e.sections),this._sections?this._sections.value=e.sections:this._sections=new d.ObservableArray(e.sections),this._currentSelection?this._currentSelection.value=e.job:this._currentSelection=new d.ObservableValue(e.job),!0),this._onPartialData=()=>{const e=this._service.partialData.value;if(e){if(e.updatedSections){this._normalize(e.updatedSections);const t=e.updatedSections[0],s=this._sections.value.findIndex((e=>e.key===t.key));s>-1?(this._sections.change(s,t),this._sections.value.splice(s+1,this._sections.value.length-s),this._sections.value.splice(0,s)):this._sections.value.splice(0,this._sections.length,...e.updatedSections)}e.currentJob&&(this._currentSelection.value=e.currentJob)}},this._onBackClick=()=>{const e=this.context.pageContext,t=e.getService("IBuildLinkingService").getBuildUrl(this._service.rawData.buildId);(0,_.onClickFPS)(e,t,!0)},this._onLogsBackClick=()=>{this._showMasterPanelXSmallScreen.value=!0},this._getLineLink=(e,t)=>{const s=this.context.pageContext.getService("IBuildLinkingService"),a={};e.payload&&(a[g.NavConstants.job]=e.payload.jobId+"",e.payload.stageId&&(a[g.NavConstants.stage]=e.payload.stageId+"")),a[g.NavConstants.task]=e.key+"",a[g.NavConstants.line]=t+"";const i=s.getBuildUrl(this._service.logsData.value.buildId,g.NavConstants.logs,void 0,void 0,a);return s.getAbsoluteUrl(i)},this._onLiveData=()=>{const e=this._service.liveContent.value;e&&this._reader.current&&this._reader.current.updateContent(e.taskId)},this._onSelectionChanged=()=>{const e=this._service.selection.value;e&&e.taskSelection&&this._reader.current&&this._reader.current.select(e.taskSelection.key,e.taskSelection.lineToScroll),this._selectInTree()},this._service=this.context.pageContext.getService("IRunLogsService");const r=this.context.pageContext.getService("IVssThemeService");r.createThemedSelector(".dark-run-logs",(e=>e.isDark?e:r.getTheme("ms.vss-web.vsts-theme-dark"))),this._selection=[],this._signalR=this.context.pageContext.getService("ISignalRService"),this._service.logsData&&this._onLogsDataChange(this._service.logsData.value),this._globalMessageService=this.context.pageContext.getService("IGlobalMessagesService")}render(){return this._service.logsData&&this._service.rawData?s.createElement(S.Surface,{background:1},s.createElement("div",{className:"flex flex-row run-logs-view",ref:e=>this._view=e},s.createElement(B.ScreenSizeConditional,{condition:e=>0===e},s.createElement(c.UncheckedObserver,{showOnSmallScreens:this._showMasterPanelXSmallScreen},s.createElement(xe.SingleLayerMasterPanel,{renderContent:this._getLeftContent,renderHeader:this._getLeftHeader,className:this._showMasterPanelXSmallScreen?"xs-master-panel-full":""}))),s.createElement(B.ScreenSizeConditional,{condition:e=>e>0},s.createElement(xe.SingleLayerMasterPanel,{renderContent:this._getLeftContent,renderHeader:this._getLeftHeader,showOnSmallScreens:!0})),s.createElement(j.Page,{className:"logs-view right themed dark-run-logs"},s.createElement(c.Observer,{data:{observableValue:this._service.logsData,filter:this._onLogsDataChange}},(e=>{const t=e.data;if(t){const e=this._service.getCurrentStageName();return s.createElement("div",{className:"flex flex-grow flex-column v-scroll-hidden",onKeyDown:this._onKeyDown},s.createElement(c.Observer,{element:this._currentSelection,y:this._commandsUpdate},(e=>s.createElement(ve.CustomHeader,{className:"log-header"},s.createElement(B.ScreenSizeConditional,{condition:e=>0===e},s.createElement(ve.HeaderBackButton,{buttonProps:{onClick:this._onLogsBackClick,text:(0,o.format)(Pe.JobsInRun,this._service.rawData.buildNumber)}})),s.createElement("div",{className:"flex-row flex-grow flex-self-stretch"},s.createElement(B.ScreenSizeConditional,{condition:e=>e>0||!this._searchActive},s.createElement(ve.HeaderTitleArea,null,s.createElement(ve.HeaderTitle,{className:"text-ellipsis"},s.createElement("div",{className:"flex flex-row flex-center job-header"},s.createElement("div",{className:"flex status"},s.createElement(f.Status,Object.assign({},e.element.statusProps,{size:"24"}))),s.createElement("div",{className:"text-ellipsis title-m"},e.element.name))))),this._reader.current&&s.createElement(c.Observer,{result:this._reader.current.getFindResult()},(e=>{const t=e.result,a=!(!this._searchText.value||t&&0!=t.lines.length);return s.createElement(B.ScreenSizeObserver,null,(e=>{const i=e.screenSize>0;return this._searchText.value&&(0,Te.announce)(this._getFindResultText(t)),s.createElement("div",{className:(0,r.css)("find-area",i?"flex-row":"flex-column flex-grow",this._searchActive&&"active",a&&"error")},s.createElement(Ne.TextField,{ref:this._search,className:"find-box",prefixIconProps:{iconName:"Search"},style:1,width:i?"bolt-textfield-default-width":"auto",placeholder:Pe.SearchLabel,onChange:this._onSearch,value:this._searchText,onKeyDown:this._onSearchKeyDown}),this._searchActive&&s.createElement("span",{className:"find-result body-s"},this._getFindResultText(t)))}))})),s.createElement(B.ScreenSizeObserver,null,(t=>{const a=t.screenSize<=0;return s.createElement(be.HeaderCommandBar,{className:"reader-actions flex-start",overflowClassName:"themed dark-run-logs",items:this._getJobCommands(e.element,a&&this._searchActive)})})))))),s.createElement(c.Observer,{showChecksPanel:this._showChecksPanel},(e=>{const a=t.stage;if(a&&a.checks&&a.checks.some((e=>2===e.status))){const t={stages:[{id:a.id,name:a.name,checks:a.checks}],runId:this._service.rawData.buildId,pipelineId:this._service.rawData.definitionId,checkListItemType:this._checkListItemType.value,reviewMode:1,onSubmitBulkApproval:this._onSubmitBulkApproval,onReassignApprovals:this._onReassignApprovals,onPermitResource:this._onPermitResource,onDismiss:this._onChecksPanelDismiss};return e.showChecksPanel&&s.createElement("div",null,s.createElement(r.WrappedComponent,Object.assign({dependencies:["ms.vss-build-web.approvals-panel"],wrappedType:"ms.tfs-build.approvals-list-panel"},t)))}return s.createElement("div",null)})),t.stage&&s.createElement(Be.ChecksCard,{className:"logs-checks-card body-m",stages:[{id:t.stage.id,name:e||t.stage.name,checks:t.stage.checks}],onReviewClicked:this._onReviewClick}),t.message&&s.createElement(u.MessageCard,{className:"pipelines-run-checks-message attempt-message",severity:"Info"},t.message),s.createElement(c.UncheckedObserver,{showTimestamps:this._showTimestamps},s.createElement(Ie.LogViewer,{ref:this._reader,className:"log-reader custom-scrollbar v-scroll-auto h-scroll-auto flex-grow",sections:this._sections})),null!=this._sections&&null!=this._sections.value&&null!=this._sections.value[0]&&s.createElement(r.RegionComponent,{componentRegion:"logs-view-insights",childComponentProperties:{pipelineId:this._service.rawData.definitionId,pipelineRunId:this._service.rawData.buildId,taskStatus:this._sections.value[0].statusProps,taskName:this._sections.value[0].title,jobId:this._service.getCurrentJobId(),phaseId:this._service.getCurrentPhaseId(),stageId:this._service.getCurrentStageId()}}))}return s.createElement("div",null,"...")}))))):s.createElement(et.NoData,null)}componentDidMount(){const e=this._service.rawData;if(!e)return;this._service.selection.subscribe(this._onSelectionChanged),this._service.liveContent.subscribe(this._onLiveData),this._service.partialData.subscribe(this._onPartialData),this._onSelectionChanged(),this._onLiveData(),this._selectInTree();const t=this.context.pageContext.getService("IBuildLinkingService"),s=e.definitionName,a=t.getDefinitionUrl(e.definitionId),i=e.buildNumber,r=t.getBuildUrl(e.buildId);this.context.pageContext.getService("run-header-breadcrumb-service").setBreadcrumbs(s,a,i,r),this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(Ve.Telemetry.Area,Ve.Telemetry.RunLogs),this._signalR.watch(this._service.rawData.buildId);const n=document.querySelector(".logs-view");n&&this._reader.current&&this._reader.current.initializeScrollable(n),document.title=(0,o.format)(Pe.TitleLogs,e.buildNumber)}componentWillUnmount(){this._service.selection.unsubscribe(this._onSelectionChanged),this._service.liveContent.unsubscribe(this._onLiveData),this._service.partialData.unsubscribe(this._onPartialData);this.context.pageContext.getService("run-header-breadcrumb-service").clearBreadcrumbs(),this._signalR.endWatch(this._service.rawData.buildId)}_getFindResultText(e){return e?(0,o.format)(Pe.SearchMatch,e.toScrollIndex+1,e.scrollCount):Pe.SearchNone}_selectInTree(e){const t=this._service.selection.value;if(t&&this._view){const s=this._view.querySelector(`[data-element="${t.taskId?t.taskId:t.jobId}"]`);if(s){const t=s.id,a=s.attributes.getNamedItem("data-elementrow");if(a){e=0;const s=this._service.treeData.value.items.findIndex((e=>t===e.data.id));s&&(e=s);const i=parseInt(a.value);isNaN(i)||(this._selection[e].select(i),this._selection.forEach(((t,s)=>{s!=e&&t.clear()})))}}}}_normalize(e){e.forEach((e=>{e.getFarRight=this._getFarRight,e.payload&&2===e.payload.state&&(e.getLineLink=this._getLineLink)}))}_getJobCommands(e,t){const s=[];t||this._service.liveContent.value||s.push({id:"timestamp",ariaLabel:Pe.ToggleTimestamps,text:Pe.ToggleTimestamps,important:!1,className:"subtle",onActivate:(e,t)=>{this._toggleTimestamp()}}),this._searchActive?(s.push({ariaLabel:Pe.SearchPrev,className:"subtle",id:"log-up",important:!0,iconProps:{iconName:"ChevronUp"},onActivate:(e,t)=>{this._reader.current&&this._reader.current.findPrev()},tooltipProps:{text:Pe.SearchPrev}}),s.push({ariaLabel:Pe.SearchNext,className:"subtle",id:"down",important:!0,iconProps:{iconName:"ChevronDown"},onActivate:(e,t)=>{this._reader.current&&this._reader.current.findNext()},tooltipProps:{text:Pe.SearchNext}}),s.push({ariaLabel:Pe.SearchClose,className:"subtle",id:"close",important:!0,iconProps:{iconName:"ChromeClose"},onActivate:(e,t)=>{this._hideFind()},tooltipProps:{text:Pe.SearchClose}})):s.push({ariaLabel:Pe.SearchLabel,className:"subtle",id:"log-search",important:!0,iconProps:{iconName:"Search"},onActivate:(e,t)=>{this._showFind()},tooltipProps:{text:Pe.SearchLabel}});0===e.state&&this._service.canPriorityBeBumped(e.id)&&s.push({id:"priority",ariaLabel:Pe.RunNext,text:Pe.RunNext,important:!0,className:"log-header-button",onActivate:(t,s)=>{this._service.bumpJobPriority(e.id),this._commandsUpdate.value=!this._commandsUpdate.value},tooltipProps:{text:Pe.RunNextTooltip}});const a=this._service.getLogUrl(e.id);return a&&s.push({id:"download",ariaLabel:Pe.AriaDownloadLog,text:Pe.AriaDownloadLog,important:!0,className:"log-header-button",onActivate:(e,t)=>{t&&t.preventDefault();const s=window.open(a,"_blank");s&&(s.opener=null)},href:a}),s}_showFind(){this._searchActive=!0,this._commandsUpdate.value=!this._commandsUpdate.value,requestAnimationFrame((()=>{this._search.current&&this._search.current.focus()}))}_toggleTimestamp(){this._showTimestamps.value=!this._showTimestamps.value;const e={},t=this._sections.value.slice();t.forEach(((t,s)=>{e[t.key]=s})),t.forEach((t=>{const s=e[t.key];this._sections.change(s,t)}))}_hideFind(){this._reader.current&&this._reader.current.clearFind(),this._searchActive=!1,this._searchText.value="",this._commandsUpdate.value=!this._commandsUpdate.value,requestAnimationFrame((()=>{const e=document.getElementById("__bolt-log-search");e&&e.focus()}))}}t.ComponentsLogsView.LogsView=n,r.Components.add("run-logs-content",n)}()}),["Resources","Components/RunSummaryBaseLinkComponent","Components/RunSummaryChangesLinkComponent","Components/RunSummaryWorkItemsLinkComponent","Constants","Components/ChecksCard","Components/TaskControllerView","Components/IssueAnalysisPanel","Components/PipelinePermissionsErrorCard","Components/IssuesCard","Components/BaseStatus","Components/CheckStatus","Components/JobsTable","Components/ArtifactStatus","Components/Canvas/Types","Components/Canvas/PathHelpers","Components/Canvas/Edge","Components/Canvas/GraphLayoutHelper","Components/Canvas/Graph","RunExternalService","Components/TestStatus","Components/StageGraph","Components/JobsCard","Components/NoData","Components/ArtifactsLink","Components/ChangesPanel","Components/ChangesLink","Components/CoverageResultsLink","Components/TestResultsLink","Components/WorkItemsLink","Components/SourcesCard","Components/RunSummary","Components/TagsDialog","SignalRService","RunDetailsService","RunHeaderBreadcrumbService","RunView","LegacyRunTabProviderService","RunLogsService","Components/LogsView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.run"}}));